function eraseCookie(name){setCookie(name,"",-1)}function setCookie(name,value,days){if(days){var date=new Date;date.setTime(date.getTime()+24*days*60*60*1e3);var expires="; expires="+date.toGMTString()}else expires="";document.cookie=name+"="+value+expires+"; path=/"}function getCookie(name){for(var nameEQ=name+"=",ca=document.cookie.split(";"),i=0;i<ca.length;i++){for(var c=ca[i];" "==c.charAt(0);)c=c.substring(1,c.length);if(0==c.indexOf(nameEQ))return c.substring(nameEQ.length,c.length)}return null}function facebookConnected(){window.fbConnectWindow.close(),angular.element("#loginModal").scope().logUserIn()}function registrationStarted(){fbRegistrationWindow.close(),angular.element("#postRegistrationModal").scope().displayModal()}function fbLoggedIn(){fbLoginWindow&&(fbLoginWindow.close(),angular.element("#loginModal").scope().logUserIn()),fbRegistrationWindow&&(fbRegistrationWindow.close(),angular.element("#loginModal").scope().logUserIn()),fbConnectWindow&&(fbConnectWindow.close(),angular.element("#loginModal").scope().connectWithFB())}function alreadyRegistered(){fbLoggedIn()}!function(){"olderIE"==document.documentElement.className.match(/olderIE/i)&&(document.body.innerHTML='<div id="browserModal" class="modal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="false"><div class="oldBrowserMsg"><img src="/application/views/dist/images/sprites/internet_explorer_broken.png" alt="Internet Explorer 8 broken icon"><h4>You are using an older version of <em>Internet Explorer.</em></h4><p>At BuynBrag, we use the latest web technology on our website. But that also means that older browsers (IE 8 and below) are not able to give an optimal user experience.</p><p>Please upgrade to one of the browsers below to enjoy BuynBrag in it\'s full glory.</p></div><div class="newBrowsers"><a class="inlineBlock browserLink" target="_blank" href="http://windows.microsoft.com/en-in/internet-explorer/ie-10-worldwide-languages"><img src="/application/views/dist/images/sprites/Internet_Explorer_9.png" alt="Internet Explorer 10 icon"><div>Internet Explorer 10</div></a> <a class="inlineBlock browserLink" target="_blank" href="https://www.google.com/intl/en/chrome/browser/"><img src="/application/views/dist/images/sprites/Google_Chrome.png" alt="Google Chrome icon"><div>Google Chrome</div></a> <a class="inlineBlock browserLink" target="_blank" href="http://www.mozilla.org/en-US/firefox/new/"><img src="/application/views/dist/images/sprites/firefox.png" alt="Mozilla Firefox icon"><div>Mozilla Firefox</div></a> <a class="inlineBlock browserLink" target="_blank" href="http://support.apple.com/downloads/#safari"><img src="/application/views/dist/images/sprites/Apple_Safari.png" alt="Apple Safari icon"><div>Apple Safari</div></a> <a class="inlineBlock browserLink" target="_blank" href="http://www.opera.com/"><img src="/application/views/dist/images/sprites/Opera.png" alt="Opera icon"><div>Opera</div></a></div></div>');var monitorId;$("#loginModal").on("show",function(){monitorId=window.setInterval(function(){$("#loginModal input").trigger("input")},250)}),$("#loginModal").on("hide",function(){window.clearInterval(monitorId)}),(void 0!==document.body.style.webkitPerspective||void 0!==document.body.style.MozPerspective)&&(console.log("3D transforms"),document.documentElement.className+=" supports3DTransforms"),$("footer").click(function(){"0px"!=$("footer").css("bottom")?$("footer").css("bottom",0):$("footer").css("bottom","-38px")}),$(".searchBoxContainer").click(function(e){$(this).addClass("searchActive"),setTimeout(function(){$(".searchBoxContainer").children(".searchInput").focus()},300),e.stopPropagation()}),$("html").click(function(){$(".searchActive").removeClass("searchActive")}),$(".closeSearch").click(function(e){$(this).parent().parent().removeClass("searchActive"),e.stopPropagation()});var personCurativeScore=function(){$(".personCurativeScore").easyPieChart({animate:1e3,trackColor:"#000",barColor:"#C41F1F",scaleColor:!1,lineWidth:3,size:170})};setTimeout(function(){personCurativeScore()},1e3)}(),angular.module("filters.beautify",[]).filter("beautify",[function(){return function(text){return text&&text.replace(/\W/g," ").trim().replace(/\s+/g,"-")}}]);var compress=angular.module("filters.compress",[]);compress.filter("compress",[function(){return function(text){return text&&text.replace(/\W/g," ").trim().replace(/\s+/g,"")}}]);var api=angular.module("services.api",[]);api.factory("api",["$http","$rootScope","$cacheFactory","$q",function($http,$rootScope,$cacheFactory,$q){var xhrData,header={"Content-Type":"application/x-www-form-urlencoded",Accept:"application/json; charset=utf-8"},httpCache=$cacheFactory.get("$http");return{ctaActivatedClass:"btn-selected",get:function(url,cacheFlag,ignoreLoadingBar){return ignoreLoadingBar?$http({method:"GET",url:"/index.php/"+url,ignoreLoadingBar:!0,cache:cacheFlag||!1}).then(function(response){return response.data}):$http({method:"GET",url:"/index.php/"+url,cache:cacheFlag||!1}).then(function(response){return response.data})},http:function(url){return $http({method:"GET",url:url}).then(function(response){return response.data})},post:function(u,d){return $http({method:"POST",url:"/index.php/"+u,data:$.param(d),headers:header}).then(function(response){return response.data})},httpRequestsFinished:function(){var intervalId,defer=$q.defer();return intervalId=window.setInterval(function(){0===$http.pendingRequests.length&&(clearInterval(intervalId),defer.resolve())},200),defer.promise},getHttpCacheObject:function(url){return xhrData=httpCache.get(url),xhrData?JSON.parse(xhrData[1]):null},updateHttpCache:function(url,data){httpCache.remove(url),xhrData[1]=JSON.stringify(data),httpCache.put(url,xhrData)},productImage:function(sid,pid){return $rootScope.s3baseUrl+sid+"/"+pid+"/"},userImageFb:function(id,dimension){return"https://graph.facebook.com/"+id+"/picture?width="+dimension+"&height="+dimension},userImageBnb:function(gender){return"female"===gender?"/assets/images/default/female.png":"/assets/images/default/male.png"}}}]),angular.module("services.user",[]).factory("user",["$rootScope",function($rootScope){var userCoupons;return{setCoupons:function(coupons){userCoupons=coupons},getUserCoupons:function(){return userCoupons||null},getBadgeData:function(){return $rootScope.user.badgesData},getcartcount:function(){return $rootScope.user.userdata.cartcount},getCity:function(){return $rootScope.user.userdata.city&&0!=$rootScope.user.userdata.city?$rootScope.user.userdata.city:!1},getEmail:function(){return $rootScope.user.userdata.email},getfbID:function(){return $rootScope.user.userdata.fbid},getloginstatus:function(){return $rootScope.user.userdata.loggedin},getName:function(){return $rootScope.user.userdata.name},getuser:function(){return $rootScope.user.userid},updatefancycount:function(){$rootScope.user.userdata.fancy+=1}}}]),angular.module("services.seo",[]).factory("seo",[function(){var seoMetaTags={};return seoMetaTags.title="Home Furniture Store: Buy Furniture Online, Home Decor, Arts in India",seoMetaTags.description="Online Furniture Store â€“ Buy furniture, Home decor, Furnishing, Lighting, Arts online to suit every class, budget at BuynBrag.com. We deliver everything on your wish list.",seoMetaTags.ogType="website",seoMetaTags.image="http://buynbrag.com/application/views/dist/images/bnb_logo_200.png",seoMetaTags.imageType="image/png",seoMetaTags.imageWidth="512",seoMetaTags.imageHeight="200",seoMetaTags}]),angular.module("services.hoverTimestamp",[]).factory("hoverTimestamp",[function(){var timestamp;return{generateTimestamp:function(){timestamp=Date.now()},timestampDiff:function(){return Date.now()-timestamp}}}]),angular.module("services.eventThrottler",[]).factory("eventThrottler",["$timeout","$q",function(){return{debounce:function(func,wait,immediate){var timeout;return function(){var context=this,args=arguments,later=function(){timeout=null,immediate||func.apply(context,args)},callNow=immediate&&!timeout;clearTimeout(timeout),timeout=setTimeout(later,wait),callNow&&func.apply(context,args)}}}}]),angular.module("facebookService",[]).factory("facebookFriends",["$q","$timeout",function($q,$timeout){var friends=[];return{get:function(){var defer=$q.defer();return friends.length>0?defer.resolve(friends):FB.api("/me/friends?fields=installed,name,gender",function(response){response&&response.data&&0!==response.data.length&&(friends=response.data,$timeout(function(){defer.resolve(friends)},0))}),defer.promise},isFBConnected:function(){var defer=$q.defer();return FB.getLoginStatus(function(response){"connected"===response.status?$timeout(function(){defer.resolve(!0)},0):$timeout(function(){defer.resolve(!1)},0)}),defer.promise},openFBLoginDialog:function(){var defer=$q.defer();return FB.login(function(response){response.authResponse?$timeout(function(){defer.resolve(!0)},0):$timeout(function(){defer.resolve(!1)},0)}),defer.promise}}}]),angular.module("directives.dmClick",["services.hoverTimestamp"]).directive("dmClick",["$parse","hoverTimestamp",function($parse,hoverTimestamp){return{restrict:"A",link:function(scope,element,attrs){var startX,startY,startTime,tapElement,tapping=!1,className="hoverActive",fn=attrs.dmClick?$parse(attrs.dmClick):null;if("ontouchstart"in document.documentElement){var hiddenContainer=!1;element.bind("touchstart",function(event){if(element.hasClass("fancyItem")&&element.hasClass(className))return void event.stopPropagation();if(!element.hasClass("fancyItem")){for(var elemRef=element;!elemRef.parent().hasClass("fancyItem");)elemRef=elemRef.parent();hiddenContainer=elemRef.parent()}if(hiddenContainer&&!hiddenContainer.hasClass(className))return void event.preventDefault();tapping=!0,tapElement=event.target?event.target:event.srcElement,startTime=Date.now();var touches=event.touches&&event.touches.length?event.touches:[event],e=touches[0].originalEvent||touches[0];startX=e.clientX,startY=e.clientY}),element.bind("touchmove",function(){tapping=!1}),element.bind("touchend",function(event){var touches=event.changedTouches&&event.changedTouches.length?event.changedTouches:event.touches&&event.touches.length?event.touches:[event],e=touches[0].originalEvent||touches[0],stopX=e.clientX,stopY=e.clientY,stopTime=Date.now(),distValid=stopX-startX>10||stopY-startY>10?!1:!0,timeValid=stopTime-startTime>750?!1:!0;tapping&&distValid&&timeValid&&tapElement&&(element.addClass("hoverActive"),hoverTimestamp.generateTimestamp(),fn&&scope.$apply(function(){fn(scope,{$event:event})})),tapping=!1})}else!fn&&element.hasClass("fancyItem")?(element.bind("mouseenter",function(){!element.hasClass(className)&&element.addClass(className)}),element.bind("mouseleave",function(){element.hasClass(className)&&element.removeClass(className)})):element.bind("click",function(event){fn&&scope.$apply(function(){fn(scope,{$event:event})})})}}}]),angular.module("directives.stabiliseHover",["services.hoverTimestamp"]).directive("stabiliseHover",[function(){return{restrict:"A",link:function(scope,element){"ontouchstart"in document.documentElement&&element.bind("touchstart",function(){alert(hoverTimestamp.timestampDiff()),hoverTimestamp.timestampDiff()<750&&element[0].preventDefault()})}}}]),angular.module("directives.share",[]).directive("shareBtns",["user","socialMessages",function(){return{restrict:"E",replace:!0,scope:{urltoshare:"@",productname:"@"},template:'<div id="toolbox" class="shareBtn"></div>',link:function(scope,element,attrs){attrs.$observe("urltoshare",function(url){url&&(element.attr("addthis:url",url),element.attr("addthis:title",scope.productname),element.append('<a class="addthis_button_compact"><img src="/assets/images/shareIcon.png" width="20" height="20"/></a>'),addthis.toolbox(element[0]))})}}}]).factory("socialMessages",["$filter",function($filter){return{fancyOnFacebook:function(userName,productName,storeId,productId){var params={};params.message=userName+" has added "+productName.substring(0,42)+" to their fancy list!",params.name="Discover more on BuynBrag.com",params.description="You can also curate your own fancy list and share it with friends.",params.link="http://www.buynbrag.com/#/product/"+$filter("beautify")(productName)+"/"+productId,params.picture="http://buynbragstores.s3.amazonaws.com/assets/images/stores/"+storeId+"/"+productId+"/img1_171x171.jpg",params.caption="Bringing back the FUN in shopping.",window.FB.getLoginStatus(function(logResponse){if("connected"===logResponse.status){{logResponse.authResponse.accessToken}window.FB.api("/me/feed","post",params,function(response){!response||response.error?console.log("Could not brag",response):console.log("Bragged")})}})}}}]),angular.module("directives.clearImage",[]).directive("clearImage",[function(){return{restrict:"A",link:function(scope,element){scope.$on("clearImage",function(){element[0].src=""})}}}]),angular.module("directives.checkLoad",[]).directive("checkLoad",[function(){return{restrict:"A",link:function(scope,element,attrs){element.bind("load",function(){scope.$apply(function(){scope.$eval(attrs.checkLoad)})})}}}]),angular.module("directives.scrollTo",[]).directive("scrollTo",["$anchorScroll","$location",function($anchorScroll,$location){return{restrict:"A",scope:{hash:"@"},link:function(scope,element){element.bind("click",function(){element.parent().parent().children().removeClass("active"),element.parent().addClass("active"),$location.hash(scope.hash),$anchorScroll()})}}}]),angular.module("dynamicModals",[]).directive("dynamicModal",["$http","$compile","$templateCache","$location",function($http,$compile,$templateCache){return{restrict:"A",scope:!0,link:function(scope,element,attrs){element.on("show",function(){$http.get(attrs.url,{cache:$templateCache}).then(function(data){element.html(data.data),$compile(element.contents())(scope)})}),element.on("hidden",function(){scope.$$childHead.$destroy()})}}}]),angular.module("directives.imageZoom",[]).directive("imageZoom",["$window",function(){return{restrict:"A",link:function(scope,element){function hideZoom(mouseX,mouseY){if(data.init){var hide=!1;mouseX<data.imageData.minPosition.left||mouseX>data.imageData.maxPosition.left?hide=!0:(mouseY<data.imageData.minPosition.top||mouseY>data.imageData.maxPosition.top)&&(hide=!0),hide&&(box.hide().css("left",-1e3).css("top",-1e3),element.removeClass("active"),zoomBox.fadeOut())}}function showZoom(){box.show(),element.addClass("active"),zoomBox.stop(!0,!0),zoomBox.fadeIn()}function initialize(){if(!data.init||data.init){var imageData={minPosition:element[0].getBoundingClientRect()};imageData.maxPosition={left:imageData.minPosition.left+element[0].width,top:imageData.minPosition.top+element[0].height};var zoomData={minPosition:angular.element(zoom)[0].getBoundingClientRect()};zoomData.maxPosition={left:zoomData.minPosition.left+zoom[0].naturalWidth,top:zoomData.minPosition.top+zoom[0].naturalHeight},data={init:!0,widthRatio:zoom[0].naturalWidth/element[0].width,heightRatio:zoom[0].naturalHeight/element[0].height,boxSize:90,boxSized2:45,imageData:imageData,zoomData:zoomData},data.constant=data.boxSized2*data.widthRatio+10}}function moveBox(x,y){var left=x-data.boxSized2,top=y-data.boxSized2;top<data.imageData.minPosition.top?top=data.imageData.minPosition.top:top+data.boxSize>data.imageData.maxPosition.top&&(top=data.imageData.maxPosition.top-data.boxSize),left<=data.imageData.minPosition.left?left=data.imageData.minPosition.left:left+data.boxSize>=data.imageData.maxPosition.left&&(left=data.imageData.maxPosition.left-data.boxSize),box.css("left",left).css("top",top),moveZoom()}function moveZoom(){var boxOffset=angular.element(box)[0].getBoundingClientRect(),imageX=boxOffset.left+data.boxSized2-data.imageData.minPosition.left,imageY=boxOffset.top+data.boxSized2-data.imageData.minPosition.top,zoomX=-1*imageX*data.widthRatio+data.constant,zoomY=-1*imageY*data.heightRatio+data.constant;zoom.css("left",zoomX),zoom.css("top",zoomY)}var imageContainer=element.parent(),zoomBox=imageContainer.find(".imagePreviewZoom"),zoom=imageContainer.find(".imagePreviewZoom img"),box=angular.element("#imagePreviewZoomBox"),data={init:!1};element.bind("mouseenter",function(event){var boxWidth=angular.element("#quickViewModal").width()/2,boxHeight=angular.element("#quickViewModal").height(),zoomH=zoom[0].naturalHeight,zoomW=zoom[0].naturalWidth;console.log(zoomH,zoomW,element),zoomBox.css("width",boxWidth),zoomBox.css("height",boxHeight-10),zoomBox.css("left",boxWidth+10),zoom.css("height",zoomH),zoom.css("width",zoomW),showZoom(),initialize(),moveBox(event.clientX,event.clientY)}),box.bind("mousemove",function(event){moveBox(event.clientX,event.clientY)}),box.bind("mouseleave",function(event){hideZoom(event.clientX,event.clientY)}),element.bind("mouseleave",function(event){hideZoom(event.clientX,event.clientY)}),element.bind("mousemove",function(event){moveBox(event.clientX,event.clientY)}),angular.element(".productImageThumbsContainer").bind("hover",function(event){hideZoom(event.clientX,event.clientY)})}}}]),angular.module("directives.loadingSpinner",[]).directive("xhrSpinner",[function(){return{restrict:"A",link:function(scope,element,attrs){var temp;scope.$on("showSpinner",function(){!attrs.hollow&&element[0].firstElementChild&&(temp=element[0].removeChild(element[0].firstElementChild)),element.addClass("btnActivated")}),scope.$on("hideSpinner",function(){element.removeClass("btnActivated"),!attrs.hollow&&element.prepend(temp)})}}}]),angular.module("directives.masonryLayout",[]).factory("masonryService",["$window",function($window){function resetDimensions(){document.body.style.overflow="scroll",containerWidth=document.body.getBoundingClientRect().width,document.body.style.overflow="auto",columns=Math.floor(containerWidth/(MIN_IMG_WIDTH+MARGIN)),dynamicImageWidth=MIN_IMG_WIDTH,marginWidth=(containerWidth-(dynamicImageWidth*columns+MARGIN*(columns-1)))/2-20,containers=new Array(columns)}function initColumnHeight(){for(i=0,n=containers.length;n>i;i++)containers[i]=0}function getShortestColumn(){return containers.indexOf(containers.slice().sort(function(a,b){return a-b})[0])}function getLargestColumnHeight(){return containers.slice().sort(function(a,b){return b-a})[0]}function getDimensions(){return{containers:containers,imgWidth:dynamicImageWidth,marginWidth:marginWidth}}function getStatics(){return{margin:MARGIN,gap:GAP,windowWidth:windowWidth}}function updateColumnHeight(column,height){containers[column]+=height}function shouldResize(){return Math.abs(windowWidth-$window.innerWidth)>50?!0:!1}function setWindowWidth(){windowWidth=$window.innerWidth}!function(){function removeHoverClass(){document.body.classList.remove(className)}function addHoverClass(){document.body.classList.add(className)}var enableTimer=0,className="scrollingActive";window.addEventListener("scroll",function(){clearTimeout(enableTimer),removeHoverClass(),enableTimer=setTimeout(addHoverClass,1e3)},!1)}();var containerWidth,columns,dynamicImageWidth,containers,i,n,MIN_IMG_WIDTH=323,MARGIN=25,GAP=25,windowWidth=$window.innerWidth;return resetDimensions(),initColumnHeight(),{shortest:getShortestColumn,tallest:getLargestColumnHeight,dimensions:getDimensions,statics:getStatics,update:updateColumnHeight,reset:resetDimensions,init:initColumnHeight,shouldResize:shouldResize,setWindowWidth:setWindowWidth}}]).directive("masonryLayout",["$window","$rootScope","masonryService",function($window,$rootScope,masonryService){function setContainerHeight(elem,height,simplySet){simplySet?containerHeight=height:containerHeight+=height,elem[0].style.height=containerHeight+"px"}function init(){containerHeight=0,midContainer=angular.element("#midSection"),parentContainer=angular.element(".fanciedProductsContainer")}var midContainer,parentContainer,containerHeight,pageHeight,imgFancy2="fancy2",imgFancy3="fancy3",statics=masonryService.statics(),vMargin=statics.gap,hMargin=statics.margin,pageHeightSet=!1;return{restrict:"A",priority:1e3,link:function(scope,element){function repaint(){homeColumn=masonryService.shortest(),tallestColumn=masonryService.tallest(),newLeft=homeColumn*(dimensions.imgWidth+hMargin)+dimensions.marginWidth,newTop=dimensions.containers[homeColumn],masonryService.update(homeColumn,element[0].scrollHeight+vMargin),element[0].style.cssText+="; opacity: 1; left: "+newLeft+"px; top: "+newTop+"px;"}if("touch"==$rootScope.deviceType)return void(scope.imageType=imgFancy2);scope.imageType=imgFancy3;var tallestColumn,homeColumn,newLeft,newTop,dimensions=masonryService.dimensions(),img=element.find(".fancyItemImageContainer img");element[0].style.opacity="0",img.bind("load",repaint),0===scope.$index&&init(),49!==scope.$index||pageHeightSet||img.bind("load",function(){pageHeight=masonryService.tallest(),console.log("pageHeight",pageHeight),pageHeightSet=!0}),scope.$last&&(pageHeightSet?setContainerHeight(parentContainer,pageHeight,!1):setContainerHeight(parentContainer,3*$window.innerHeight,!1),img.bind("load",function(){setContainerHeight(parentContainer,masonryService.tallest(),!0)})),scope.$on("CLASSIC",function(){element.width(""),scope.imageType=imgFancy3,midContainer.hasClass("container-fluid fluidHomePage")&&(midContainer.removeClass("container-fluid fluidHomePage"),midContainer.addClass("container classicHomePage"))})}}}]).directive("masonryResize",["$window","$rootScope","masonryService",function($window,$rootScope,masonryService){function getStatics(){statics=masonryService.statics(),vMargin=statics.gap,hMargin=statics.margin}var statics,vMargin,hMargin,resizing=!1;return getStatics(),{restrict:"A",link:function(scope,element){function repaint(){if((masonryService.shouldResize()||switchingLayout)&&!resizing){for(console.log("START RESIZING"),resizing=!0,masonryService.setWindowWidth(),masonryService.reset(),masonryService.init(),dimensions=masonryService.dimensions(),imageContainers=element.find(".imageRepetition"),i=0,n=imageContainers.length;n>i;i++)homeColumn=masonryService.shortest(),container=angular.element(imageContainers[i]),newLeft=homeColumn*(dimensions.imgWidth+hMargin)+dimensions.marginWidth,newTop=dimensions.containers[homeColumn],container[0].style.cssText+="; opacity: 1; left: "+newLeft+"px; top: "+newTop+"px;",masonryService.update(homeColumn,container.height()+vMargin);element.height(masonryService.tallest()),resizing=!1,console.log("STOP RESIZING")}}if("touch"!=$rootScope.deviceType){var imageContainers,container,dimensions,homeColumn,newLeft,newTop,midContainer=$("#midSection"),switchingLayout=!1;scope.$watch("products.length",function(newCount){0===newCount&&(element.height(0),masonryService.init())}),scope.$on("MASONRY",function(){midContainer.hasClass("container classicHomePage")&&(element.height(0),masonryService.init(),getStatics(),switchingLayout=!0,midContainer.removeClass("container classicHomePage"),midContainer.addClass("container-fluid fluidHomePage"),repaint(),switchingLayout=!1)}),angular.element($window).bind("resize",repaint),scope.$on("$destroy",function(){resizing=!1,angular.element($window).off("resize")})}}}}]).directive("layoutSwitcher",[function(){var activeClass="current";return{restrict:"E",template:'<div class="layoutSwitchContainer">Switch layout<i class="classicSwitch {{classicActive}}" ng-click="switchLayout(layouts.classic)"></i><i class="masonrySwitch {{masonryActive}}" ng-click="switchLayout(layouts.masonry)"></i></div>',controller:function($scope){$scope.layouts={classic:0,masonry:1},$scope.classicActive="",$scope.masonryActive=activeClass,$scope.switchLayout=function(layout){switch(layout){case 0:$scope.$broadcast("CLASSIC"),$scope.masonryActive="",$scope.classicActive=activeClass;break;case 1:$scope.$broadcast("MASONRY"),$scope.classicActive="",$scope.masonryActive=activeClass}}},link:function(){}}}]),angular.module("directives.sexyOverlay",[]).directive("sexyOverlay",[function(){return{restrict:"A",scope:!0,link:function(scope,element,attrs){element.addClass("ng-hide"),scope.$on(attrs.id,function(){element.removeClass("ng-hide"),element.addClass("overlayModal"),scope.$broadcast("SHOW")}),scope.$on("CLOSEMODAL",function(){element.hasClass("ng-hide")||(element.addClass("ng-hide"),scope.$broadcast("HIDE"))})}}}]).directive("overlay",["$rootScope",function($rootScope){return{restrict:"E",template:'<div id="overlay" class="overlay"></div>',link:function(scope,element){element.on("click",function(){$rootScope.$broadcast("CLOSEMODAL"),element.remove()})}}}]).directive("olink",["$rootScope","$compile","$timeout",function($rootScope,$compile,$timeout){return{restrict:"A",scope:{},link:function(scope,element,attrs){element.on("click",function(){attrs.olink&&($("body").append($compile("<overlay></overlay>")($rootScope.$new())),$timeout(function(){$rootScope.$broadcast(attrs.olink),$rootScope.$apply()},100))})}}}]),angular.module("directives.fancy",[]).directive("btnFancy",["user","api","$route","$timeout","$rootScope","$analytics","bragService",function(user,api,$route,$timeout,$rootScope,$analytics,bragService){var fancyClass="hasBragged",fancyText="Brag",fanciedText="Edit";return{restrict:"E",scope:{storeId:"@sid",productId:"@pid",userName:"@uname",productName:"@pname",hasFancied:"@",fancyCounter:"=?"},templateUrl:function(tElement,tAttrs){return"undefined"!=typeof tAttrs.url?tAttrs.url:"/application/views/app/src/app/exhaustiveFeatures/callToActions/brag/bragBtn.html"},controller:function(){},link:function(scope,element,attrs){var fancied=!1,productData="";attrs.$observe("hasFancied",function(val){1===+val?(scope.fanciedClass=fancyClass,scope.productFanciedClass=api.ctaActivatedClass,scope.fancyText=fanciedText):(scope.fanciedClass="",scope.productFanciedClass="",scope.fancyText=fancyText)}),scope.triggerFancy=function(){user.getloginstatus()?(productData={pid:scope.productId,sid:scope.storeId,uname:scope.userName,pname:scope.productName},bragService.set(productData),$rootScope.openModal("fancyListModal"),$analytics.eventTrack("click",{category:"Brag",label:scope.productName}),$rootScope.$on("PRODUCTFANCIED",function(){fancied||(scope.fanciedClass=fancyClass,scope.productFanciedClass=api.ctaActivatedClass,scope.fancyText=fanciedText,window.location.href.match("product")&&scope.$parent.hasFancied&&0==scope.$parent.hasFancied&&(scope.$parent.hasFancied=1),user.updatefancycount(),"undefined"!=typeof scope.fancyCounter&&scope.fancyCounter++,fancied=!0)})):$("#loginModal").modal("show")}}}}]).factory("bragService",[function(){var productData;return{get:function(){return productData},set:function(data){productData=data}}}]).directive("fancyList",["$route","$rootScope","$timeout","$cacheFactory","$analytics","api","user","bragService",function($route,$rootScope,$timeout,$cacheFactory,$analytics,api,user,bragService){return{restrict:"A",scope:!0,controller:function($scope){function readFancyList(){api.get("rapiv1/profile/fancyListDetails/"+user.getuser(),!0).then(function(data){data&&data.data&&data.data.fancyListsData&&($scope.userFancyLists=data.data.fancyListsData)},function(){})}var editFancy=!1,selectedList="";$scope.listName="",$scope.userFancyLists=[],$scope.product=bragService.get(),readFancyList(),api.get("rapiv1/profile/inFancyList/"+$scope.product.pid).then(function(data){data&&data.data&&data.data[0].fancyListID&&(selectedList=data.data[0].fancyListID,$scope.selectedList=selectedList,editFancy=!0)}),$scope.selectList=function(list){$scope.selectedList=list.fancyListID},$scope.createNewList=function(){$scope.listName&&api.post("rapiv1/profile/saveFancyList",{listName:$scope.listName}).then(function(data){var bragListCache;if(data&&data.data&&data.data.saved){$scope.listName="";var newList=data.data[0];$scope.selectedList=newList.fancyListID,bragListCache=api.getHttpCacheObject("/index.php/rapiv1/profile/fancyListDetails/"+user.getuser()),bragListCache.data.fancyListsData.unshift({fancyListDescription:null,fancyListID:newList.fancyListID,fancyListName:newList.fancyListName,totalFanciedProducts:0}),api.updateHttpCache("/index.php/rapiv1/profile/fancyListDetails/"+user.getuser(),bragListCache),readFancyList()}},function(){})},$scope.fancyProduct=function(){editFancy?api.post("rapiv1/profile/moveToFancyList",{fromListID:selectedList,toListID:$scope.selectedList,productID:$scope.product.pid}).then(function(){editFancy=!1;var bragListCache=api.getHttpCacheObject("/index.php/rapiv1/profile/fancyListDetails/"+user.getuser());bragListCache.data.fancyListsData.findObject("fancyListID",selectedList).totalFanciedProducts--,bragListCache.data.fancyListsData.findObject("fancyListID",$scope.selectedList).totalFanciedProducts++,api.updateHttpCache("/index.php/rapiv1/profile/fancyListDetails/"+user.getuser(),bragListCache),console.log($scope.subview),"profileHeader"===$scope.subview&&$rootScope.$broadcast("PRODUCTEDITED",{productData:$scope.product}),$analytics.eventTrack("movedToAnotherList",{category:"Brag",label:$scope.product.pname})},function(){}):api.post("async/fancy2/"+$scope.product.pid,{listID:$scope.selectedList}).then(function(data){if(!data.error&&data.fancy&&!data.alreadyFancied){var profileInfoCache=api.getHttpCacheObject("/index.php/rapiv1/profile/info/"+user.getuser());profileInfoCache&&profileInfoCache.data.userInfo[0].totalFanciedProducts++,$rootScope.$broadcast("PRODUCTFANCIED");var bragListCache=api.getHttpCacheObject("/index.php/rapiv1/profile/fancyListDetails/"+user.getuser());bragListCache&&(bragListCache.data.fancyListsData.findObject("fancyListID",$scope.selectedList).totalFanciedProducts++,api.updateHttpCache("/index.php/rapiv1/profile/fancyListDetails/"+user.getuser(),bragListCache));var fancyPath=$route.current.action.split(".")[0]+"_page";$analytics.eventTrack("bragged",{category:"Brag",label:$scope.product.pname}),_bnbAnalytics.fancySuccess($scope.product.pid,$scope.product.pname,$scope.product.sid,data.catID,data.subCatID1,fancyPath)}},function(){})}},link:function(scope,element){scope.$on("$destroy",function(){element.remove()})}}}]),angular.module("directives.tag",["facebookService"]).directive("btnTag",["$rootScope","user","api","facebookFriends","tagService",function($rootScope,user,api,facebookFriends,tagService){return{restrict:"E",scope:{pid:"@",sid:"@",pname:"@"},templateUrl:"/application/views/app/src/app/exhaustiveFeatures/callToActions/tag/tagBtn.html",link:function(scope){function handleTagModal(){tagService.set({pid:scope.pid,sid:scope.sid,pname:scope.pname}),$rootScope.openModal("tagFriendModal")}scope.triggerTag=function(){user.getloginstatus()?facebookFriends.isFBConnected().then(function(fbConnected){fbConnected?handleTagModal():facebookFriends.openFBLoginDialog().then(function(loginSuccess){loginSuccess&&handleTagModal()})}):$("#fbSignUpModal").modal("show")}}}}]).factory("tagService",[function(){var productData;return{get:function(){return productData},set:function(data){productData=data}}}]).directive("tagFriends",["api","user","$route","facebookFriends","$filter","tagService",function(api,user,$route,facebookFriends,$filter,tagService){return{restrict:"A",scope:!0,controller:function($scope){function calculateInputWidth(val){0===val&&(calculateInputWidth.previousIndex=0);var totalNameLength=Array.prototype.join.call($scope.taggedFriends.slice(calculateInputWidth.previousIndex).map(function(friend){return friend.name})).length,width=499-8*totalNameLength-15*($scope.taggedFriends.length+1);width>96?$scope.inputWidth=width:($scope.inputWidth=499,calculateInputWidth.previousIndex=$scope.taggedFriends.length)}$scope.showFriends=!1,$scope.friends=[],$scope.searchResults=[],$scope.friendKey="",$scope.taggedFriends=[],$scope.inputWidth="",calculateInputWidth.previousIndex=0,0===$scope.friends.length&&facebookFriends.get().then(function(data){$scope.friends=data}),$scope.product=tagService.get(),$scope.$watch("friendKey.length",function(val){val>1&&($scope.showFriends=!0)}),$scope.$watch("friendKey",function(val){$scope.searchResults=$filter("filter")($scope.friends,{name:val})}),$scope.$watch("taggedFriends.length",calculateInputWidth),$scope.addFriendToTag=this.addFriendToTag=function(friend){$scope.taggedFriends.push(friend),$scope.friendKey="",$scope.showFriends=!1
},$scope.deleteFriendToTag=function(friend){$scope.taggedFriends.deleteObject("id",friend.id)},this.isActive=function(item){return $scope.active===item}},link:function(scope,element,attrs,controller){function onkeydown(event){var code=event.keyCode;38===code&&(event.preventDefault(),scope.$apply(function(){var index=scope.searchResults.indexOf(scope.active);scope.active=0===index?null:scope.searchResults[index-1]})),40===code&&(event.preventDefault(),scope.$apply(function(){var index=scope.searchResults.indexOf(scope.active);scope.active=scope.searchResults[(index+1)%scope.searchResults.length]})),(9===code||13===code||27===code)&&event.preventDefault()}function onkeyup(event){var code=event.keyCode;(9===code||13===code)&&scope.$apply(function(){scope.active?controller.addFriendToTag(scope.active):(scope.showFriends=!1,element.removeClass("searchActive"),inputElem.blur())}),27===code&&controller.safeApply(function(){scope.showSuggestions=!1})}var inputElem;scope.active=null,inputElem=element.find("input"),inputElem.on("keydown",onkeydown),inputElem.on("keyup",onkeyup),scope.tagFriends=function(){var userList=Array.prototype.join.call(scope.taggedFriends.map(function(friend){return"@["+friend.id+"]"})," "),productUrl="https://buynbrag.com/product/"+$filter("beautify")(scope.product.pname)+"/"+scope.product.pid;FB.api("/me/bnbbuynbrag:comment?message="+userList,"post",{product:productUrl},function(response){console.log(response);$route.current.action.split(".")[0]+"_page"})},scope.$on("$destroy",function(){element.remove()})}}}]).directive("activateItem",[function(){return{restrict:"A",require:"^tagFriends",link:function(scope,element,attrs,controller){var item=scope.$eval(attrs.activateItem);scope.$watch(function(){return controller.isActive(item)},function(active){active?element.addClass("active"):element.removeClass("active")})}}}]),angular.module("directives.follow",[]).directive("btnFollow",["api","$route","user","$timeout",function(api,$route,user,$timeout){return{restrict:"E",scope:{usertofollow:"@",hasFollowed:"@",followers:"@"},templateUrl:function(tElement,tAttrs){return"undefined"!=typeof tAttrs.url?tAttrs.url:"/application/views/app/src/app/exhaustiveFeatures/callToActions/follow/followBtn.html"},link:function(scope,element,attrs){function follow(){scope.$broadcast("showSpinner"),scope.followText=txtUnfollow,scope.activeClass=!1,scope.followers&&(scope.followers=+scope.followers+1),api.get("rapiv1/profile/follow/"+user.getuser()+"/"+scope.usertofollow).then(function(){scope.$broadcast("hideSpinner");var evntPage=$route.current.action.split(".")[0]+"_page";_bnbAnalytics.registerFollow(user.getuser(),user.getEmail(),evntPage,scope.usertofollow)})}function unFollow(){scope.$broadcast("showSpinner"),scope.followText=txtFollow,scope.activeClass=!0,scope.followers&&(scope.followers=+scope.followers-1),api.get("rapiv1/profile/unFollow/"+user.getuser()+"/"+scope.usertofollow).then(function(){scope.$broadcast("hideSpinner")})}var txtFollow="Follow",txtUnfollow="Unfollow";attrs.$observe("hasFollowed",function(val){1==val||"true"===val?(scope.followText=txtUnfollow,scope.activeClass=!1):(scope.followText=txtFollow,scope.activeClass=!0)}),attrs.$observe("usertofollow",function(val){$timeout(function(){scope.followBtnVisible=val==user.getuser()?!1:!0},600)}),scope.triggerFollow=function(){user.getloginstatus()?scope.followText===txtFollow?follow():scope.followText===txtUnfollow&&unFollow():$("#loginModal").modal("show")}}}}]),angular.module("directives.cart",["directives.loadingSpinner","services.cart"]).directive("btnCart",["user","cart","api",function(user,cart,api){var txtBuy="Buy now",txtInCart="In Your Cart",txtUnavailable="Out of stock",inCartClass="inYourCart";return{restrict:"E",scope:{pid:"@",sid:"@",sp:"@",pname:"@",quantity:"@",color:"@",size:"@",selectedquantity:"@"},templateUrl:function(tElem,tAttrs){return"undefined"!=typeof tAttrs.url?tAttrs.url:"/application/views/app/src/app/exhaustiveFeatures/callToActions/cart/cartBtnHome.html"},controller:function(){},link:function(scope,element,attrs){function loadText(pid){user.getloginstatus()&&cart.ready().then(function(){cart.inCart(pid)?(scope.cartText=txtInCart,scope.cartClass=inCartClass,scope.productCartClass=api.ctaActivatedClass,disableCartButton=!0):+scope.quantity<1?(scope.cartText=txtUnavailable,disableCartButton=!0):scope.cartText=txtBuy})}function addToCart(){scope.$broadcast("showSpinner");var uid=user.getuser(),color=scope.color||0,size=scope.size||0,quantity=scope.selectedquantity||1,params=scope.pid+"/"+color+"/"+size+"/"+uid+"/"+scope.sid+"/"+quantity;api.get("async/addToCart/"+params).then(function(data){data.addedProduct&&(scope.$broadcast("hideSpinner"),scope.cartText=txtInCart,scope.cartClass=inCartClass,scope.productCartClass=api.ctaActivatedClass,disableCartButton=!0,cart.refresh(!0))})}function canLoadText(){productIDAvailable&&quantityAvailable&&(disableCartButton=!1,loadText(productID))}var productID,productIDAvailable=!1,quantityAvailable=!1,disableCartButton=!1;scope.cartClass="",attrs.$observe("pid",function(pid){productIDAvailable=!0,productID=pid,canLoadText()}),attrs.$observe("quantity",function(){quantityAvailable=!0,canLoadText()}),scope.$on("ITEMREMOVEDFROMCART",function($event,data){data.productID==scope.pid&&(scope.cartClass="",scope.productCartClass="",disableCartButton=!1)}),scope.buyProduct=function(){user.getloginstatus()?disableCartButton||addToCart():$("#loginModal").modal("show")}}}}]).directive("cartmodalcheckout",["cart","user","api","$rootScope",function(cart){return{restrict:"A",scope:!0,controller:function($scope){$scope.cartData={},$scope.showSpinner=!1,$scope.emptyCart=!1,cart.get().then(function(data){return Object.keys(data.stores).length<1?void($scope.emptyCart=!0):($scope.cartData=data,void console.log($scope.cartData))}),$scope.updateCart=function(item){$scope.showSpinner=!0,cart.updateCart(item).then(function(){$scope.showSpinner=!1})},$scope.deleteCartItem=function(item){$scope.showSpinner=!0,cart.deleteCartItem(item).then(function(){$scope.showSpinner=!1})}},link:function(scope,element){scope.$watch("showSpinner",function(val){var modalBody=element.find(".modal-body");modalBody[0]&&(modalBody[0].style.overflow=val?"hidden":"")}),scope.$on("$destroy",function(){element.remove()})}}}]),angular.module("services.cart",["services.api"]).factory("cart",["api","$rootScope","$q","user",function(api,$rootScope,$q,user){function range(num){for(var i=1,quantity=[];i<=parseInt(+num);)quantity.push({num:i}),i++;return quantity}function storeProductInCart(storeID){return cart.stores[storeID]?!0:!1}var cart,cartDataAvailable=!1,couponApplied=!1;return{applyCoupon:function(coupon){var defer=$q.defer(),couponValid=!0;return coupon.couponSpecifics.length>0?storeProductInCart(coupon.param1[0])?+coupon.minPurchaseAmount>cart.totalAmount&&(defer.reject("minimumAmountError"),couponValid=!1):(couponValid=!1,defer.reject("storeCouponNotApplicable")):+coupon.minPurchaseAmount>cart.totalAmount&&(couponValid=!1,defer.reject("minimumAmountError")),couponValid&&api.get("cart/redeemCoupon?coupon_id="+coupon.couponID+"&totalPurchaseAmount="+cart.totalAmount).then(function(data){data.isValidCoupon&&data.isValidUser&&data.isValidAmount&&data.sessionSet?(cart.discount=+data.redeemedPrice,cart.totalPayable=cart.totalAmount-cart.discount,couponApplied=!0,cart.coupon=coupon,defer.resolve(!0)):defer.resolve(!1)}),defer.promise},calculateTotalCartAmount:function(){cart.totalAmount=0,angular.forEach(cart.stores,function(store){angular.forEach(store.items,function(item){cart.totalAmount+=+item.totalPayable})})},deleteCartItem:function(item){var defer=$q.defer(),self=this;return api.get("cart/deleteItem/"+item.cartID).then(function(data){data&&data.result&&(delete cart.stores[item.storeID].items[item.productID],$rootScope.user.userdata.cartcount-=1,self.calculateTotalCartAmount(),$rootScope.$broadcast("ITEMREMOVEDFROMCART",{productID:item.productID}),defer.resolve())}),defer.promise},get:function(){var defer=$q.defer();return cart&&Object.keys(cart.stores).length>0?defer.resolve(cart):this.refresh().then(function(){defer.resolve(cart)}),defer.promise},initialize:function(data,variants){var variantsDictionary={};if(cart={stores:{},coupon:"",totalAmount:0,discount:0,totalPayable:0,itemsDistinctCount:0,itemsTotalCount:0},variants&&"[object Object]"===variants.toString()&&Object.keys(variants).length>0){var variantName,variantQuantity,variantColor,variantSize;angular.forEach(variants,function(variant){variantsDictionary[variant.productID]||(variantsDictionary[variant.productID]={colorVariants:[],sizeVariants:[]}),variantName=variant.variantName,variantQuantity=variant.variantQuantity,variantName&&"COLOR"===variantName.toUpperCase()?(variantColor=variant.variantColor,variantColor&&variantsDictionary[variant.productID].colorVariants.push({color:variantColor,variantQuantity:variantQuantity})):variantName&&"SIZE"===variantName.toUpperCase()&&(variantSize=variant.variantSize,variantSize&&variantsDictionary[variant.productID].sizeVariants.push({size:variantSize,variantQuantity:variantQuantity}))})}data&&"[object Object]"===data.toString()&&Object.keys(data).length>0&&(angular.forEach(data,function(item){var discountedPrice=1===+item.isOnDiscount?+item.originalPrice-+item.discountAmount:+item.originalPrice;cart.stores[item.storeID]||(cart.stores[item.storeID]={items:{},storeName:item.storeName,storeID:item.storeID,itemCount:0}),item.sellingPrice=discountedPrice,item.totalPayable=discountedPrice*item.quantity,item.dispatchDate=Date.now()+864e5*(+item.processingTime+5),item.quantityRange=range(item.availableQuantity),item.variants=variantsDictionary[item.productID]||{colorVariants:[],sizeVariants:[]},item.selectedQuantity=item.quantityRange[item.quantityRange.indexOfObject("num",+item.quantity)],item.vcolor.length>1&&(item.selectedColor=item.variants.colorVariants[item.variants.colorVariants.indexOfObject("color",item.vcolor)]),item.vsize.length>1&&(item.selectedSize=item.variants.sizeVariants[item.variants.sizeVariants.indexOfObject("size",item.vsize)]),cart.totalAmount+=+item.totalPayable,cart.itemsTotalCount+=+item.quantity,cart.itemsDistinctCount+=1,cart.stores[item.storeID].items[item.productID]=item,cart.stores[item.storeID].itemCount+=1}),cart.totalPayable=cart.totalAmount-cart.discount,$rootScope.user.userdata.cartcount=cart.itemsDistinctCount)},inCart:function(productID){var productInCart=!1;return cart&&angular.forEach(cart.stores,function(store){angular.forEach(store.items,function(item){item.productID==productID&&(productInCart=!0)})}),productInCart},ready:function(){var stop,defer=$q.defer();return cartDataAvailable?defer.resolve():stop=window.setInterval(function(){cartDataAvailable&&(clearInterval(stop),defer.resolve())},100),defer.promise},refresh:function(flag){var self=this,defer=$q.defer();return api.get("async/cartData").then(function(data){data&&data[1]&&(self.initialize(data[1].cartData,data[1].productsVariants),cartDataAvailable=!0,defer.resolve(),flag&&$rootScope.openModal("checkoutModal",{dummy:"dummy"}))}),defer.promise},removeCoupon:function(){couponApplied&&api.get("cart/removeCoupon").then(function(data){data.couponFound&&data.couponRemoved&&(couponApplied=!1,cart.coupon="",cart.discount=0)})},updateCart:function(item){var defer=$q.defer(),self=this,uid=user.getuser(),color="undefined"!=typeof item.selectedColor?item.selectedColor.color:0,size="undefined"!=typeof item.selectedSize?item.selectedSize.size:0,quantity="undefined"!=typeof item.selectedQuantity?item.selectedQuantity.num:1,params=item.productID+"/"+color+"/"+size+"/"+uid+"/"+item.storeID+"/"+quantity;return api.get("async/addToCart/"+params).then(function(data){data.addedProduct&&(item.vcolor=color,item.vsize=size,item.quantity=quantity,item.totalPayable=+item.sellingPrice*+item.selectedQuantity.num,self.calculateTotalCartAmount(),defer.resolve())}),defer.promise}}}]),angular.module("userCoupons",[]).directive("couponshandler",["api","user",function(api,user){return{restrict:"A",scope:!0,controller:function($scope){$scope.userCoupons={},$scope.message=!1,$scope.$on("userLoggedIn",loadCoupons),api.get("coupons/all").then(function(data){function handleCouponDisplay(){$("#couponsModal").modal("show")}data&&data.isLoggedIN&&data?($scope.userCoupons=data,user.setCoupons(data.coupons),(!window.localStorage.getItem("couponsDisplayed")||Date.now()-+window.localStorage.getItem("couponsDisplayed")>864e5)&&handleCouponDisplay()):$scope.message=!0})},link:function(scope,element){scope.$on("$destroy",function(){element.remove()})}}}]),angular.module("fanciedByUsersModal",[]).directive("userswhobragged",["api",function(api){var productID,modalVisible=!1,page=0,noMoreData=!1;return{restrict:"A",controller:function($scope){$scope.busy=!1,this.getUsers=$scope.getUsersWhoFancied=function(){!modalVisible||$scope.busy||noMoreData||($scope.busy=!0,api.get("rapiv1/product/fanciedBy/"+productID+"/"+page).then(function(data){return data&&"object"==typeof data?($scope.usersWhoFancied.push.apply($scope.usersWhoFancied,data),page++,void($scope.busy=!1)):(noMoreData=!0,void($scope.busy=!1))},function(){}))}},link:function(scope,element,attrs,ctrl){scope.usersWhoFancied=[],scope.$on("prodBraggedUserModal",function(event,args){element.scrollTop=0,modalVisible=!0,productID=args.pid,ctrl.getUsers()}),scope.$on("$destroy",function(){element.remove()})}}}]),angular.module("userInfo",[]).directive("userInfo",["api",function(api){return{restrict:"A",controller:function($scope){$scope.friendInfo={},$scope.$on("personModal",function(event,args){$scope.userId=args.uid,$scope.friendInfo.firstName="",$scope.friendInfo.lastName="",$scope.friendInfo.profilePic="",$scope.friendInfo.userRank="",$scope.friendInfo.totalFanciedProducts="",$scope.friendInfo.totalBadges="",$scope.friendInfo.totalFollowers="",api.get("rapiv1/profile/info/"+$scope.userId,!0).then(function(data){var userInfo=data.data.userInfo[0],userNameDetails=userInfo.userFullName.split(" ");$scope.friendInfo.firstName=userNameDetails.slice(0,-1).join(" "),$scope.friendInfo.lastName=userNameDetails.slice(-1)[0],$scope.friendInfo.profilePic=isNaN(userInfo.userFBID)?api.userImageBnb(userInfo.userGender):api.userImageFb(userInfo.userFBID,200),$scope.friendInfo.userRank=userInfo.userRank||$scope.userId,$scope.friendInfo.totalFanciedProducts=userInfo.totalFanciedProducts||0,$scope.friendInfo.totalBadges=userInfo.totalBadges||0,$scope.friendInfo.totalFollowers=userInfo.totalFollowers||0,$scope.friendInfo.userCity=userInfo.userCity})})},link:function(scope,element){scope.$on("$destroy",function(){element.remove()})}}}]),angular.module("realtime.badges",[]).controller("BadgesController",["$scope","user","$timeout","api",function($scope,user,$timeout,api){function displayBadge(){$scope.badge=$scope.userBadges.pop(),$("#badgesModal").modal("show"),badgeOpen=!0}function startPolling(){window.setInterval(function(){api.get("async/badgeNotifications",!1,!0).then(function(data){if(data&&data.result){var badge,badges=data.result.badgesData;"[object Object]"===badges.toString()&&Object.keys(badges).length>0&&angular.forEach(badges,function(val){badge={id:val.type.toString()+val.level.toString(),badgeSrc:"/assets/images/badges/"+val.img,badgeText:val.txt,badgeType:val.type},$scope.userBadges.indexOfObject("id",badge.id)<0&&$scope.userBadges.splice(0,0,badge)}),!badgeOpen&&0!==$scope.userBadges.length&&displayBadge()}})},6e4)}var badgeOpen=!1;$scope.userBadges=[],startPolling(),$("#badgesModal").on("hidden",function(){badgeOpen=!1,api.get("ajax/badge_success/"+$scope.badge.badgeType),$timeout(function(){0!==$scope.userBadges.length&&displayBadge()},3e4)})}]),angular.module("gallery",["services.eventThrottler"]).factory("paginatorFactory",["api","$q","$timeout","$rootScope","$window","user","$document",function(api,$q,$timeout,$rootScope,$window,user,$document){function forceLogin(){var view=document.getElementById("midSection"),loginTemplate='<div class="forceLoginContainer"><div class="btnForceLogin text-center"><span class="forceLoginBtnWrapper"><a href="#loginModal" data-toggle="modal" role="button" class="btn btn-blue">Login to discover more</a></span></div></div>';view&&(view=angular.element(view),!view.find(".btnForceLogin").length&&view.append(loginTemplate),view.find(".spinner")&&view.find(".spinner").remove())}function Duplicates(){this.length=0,this.totalDuplicacyCount=0}function Paginator(pageSize,prefetching,imageParams){this.pageSize=pageSize,this.prefetching=!1,this.cache=[],this.duplicates=new Duplicates,this.buffer={request:"",data:""},this.after=0,this.cancelFurtherRequests=!1,this.busy=!1,this.blockMore=!1,this.imgParams=imageParams,this.previousRequest=""}return Paginator.prototype={constructor:Paginator,prefetchImages:function(results){function loadSequentially(){var imgElem=new Image,source="";imgElem.onload=function(){++count===n?$timeout(function(){allImagesLoaded.resolve()},0):loadSequentially()},imgElem.onerror=function(){console.log(n," loaded"),++count===n?$timeout(function(){allImagesLoaded.resolve()},0):loadSequentially()},source=imageSources.shift(),source&&(imgElem.src=source)}var product,i,n=results.length,allImagesLoaded=$q.defer(),imageSources=new Array(n),count=0;for(i=0;n>i;i++)product=results[i],imageSources[i]=api.productImage(product[this.imgParams[0]]||this.imgParams[0],product[this.imgParams[1]])+this.imgParams[2];return loadSequentially(),allImagesLoaded.promise},retreiveProducts:function(url,requestType,requestParams){function fetchNext(){self.fetchProducts(currentRequest).then(function(data){self.prefetching&&self.prefetchImages(data)})}var supplying=$q.defer(),self=this,currentRequest={url:url,requestType:requestType,requestParams:requestParams};return!angular.equals(currentRequest,this.previousRequest)&&this._reset(),2!==this.after||user.getloginstatus()||this.blockMore||(this.blockMore=!0,forceLogin()),angular.equals(this.buffer.request,currentRequest)?($timeout(function(){self.cancelFurtherRequests?supplying.reject("noMoreData"):supplying.resolve(self.buffer.data),self._clearBuffer()},0),$timeout(function(){fetchNext()},2e3)):this.fetchProducts(currentRequest).then(function(data){supplying.resolve(data),self._clearBuffer(),"complete"!==$document[0].readyState?angular.element($window).on("load",function(){fetchNext()}):fetchNext()},function(){self.cancelFurtherRequests&&supplying.reject("noMoreData")}),supplying.promise},fetchProducts:function(request){var urlBase,postParams,fetching=$q.defer(),url=request.url,requestType=request.requestType,requestParams=request.requestParams,self=this;return this.busy||this.cancelFurtherRequests||this.blockMore?fetching.reject("Fetcher is busy"):(this.busy=!0,"get"===requestType?(urlBase=url&&"string"==typeof url&&-1!==url.indexOf("trends")&&-1!==url.indexOf("?city2")?function(){var splitUrl=url.split("?");return splitUrl[0]+self.after+"/"+self.pageSize+"?"+splitUrl[1]}():url+self.after+"/"+self.pageSize,postParams=null):"post"===requestType&&(urlBase=url,postParams=angular.copy(requestParams),postParams.startFrom=this.after,postParams.maxResults=this.pageSize),this.previousRequest=request,api[requestType](urlBase,postParams).then(function(data){if(!data||"object"!=typeof data||"null"===data)return self.cancelFurtherRequests=!0,fetching.reject("noMoreData"),void(self.busy=!1);var productId,products=data,results=[];angular.forEach(products,function(product){"undefined"!=typeof product.productID?(productId=product.productID,self.cache.indexOf(productId)<0?(results.push(product),self.cache.push(productId)):(self.duplicates[productId]||(self.duplicates[productId]={duplicacyCount:0,details:product},self.duplicates.length++),self.duplicates[productId].duplicacyCount++,self.duplicates.totalDuplicacyCount++)):results.push(product)}),self.duplicates.length>0&&console.log("Duplicate Products --->  ",self.duplicates),self.buffer.request=request,self.buffer.data=results,fetching.resolve(results),self.after+=1,self.busy=!1},function(){self.busy=!1})),fetching.promise},reset:function(){this._reset(),this._clearBuffer()},_clearBuffer:function(){this.buffer.request="",this.buffer.data=""},_reset:function(){this.cache.length=0,this.duplicates=new Duplicates,this.after=0,this.cancelFurtherRequests=!1,this.busy=!1,this.blockMore=!1}},Paginator}]).directive("infiniteScroll",["$rootScope","$window","$timeout",function($rootScope,$window,$timeout){var lastScrollTime=0;return{restrict:"A",link:function(scope,elem,attrs){var checkWhenEnabled,handler,scrollDistance,scrollEnabled;return $window=angular.element($window),scrollDistance=0,null!=attrs.infiniteScrollDistance&&scope.$watch(attrs.infiniteScrollDistance,function(value){return scrollDistance=parseInt(value,10)}),scrollEnabled=!0,checkWhenEnabled=!1,null!=attrs.infiniteScrollDisabled&&scope.$watch(attrs.infiniteScrollDisabled,function(value){return scrollEnabled=!value,scrollEnabled&&checkWhenEnabled?(checkWhenEnabled=!1,handler()):void 0}),handler=function(){if(!(Date.now()-lastScrollTime<500)){var elementBottom,remaining,shouldScroll,windowBottom;return windowBottom=$window.height()+$window.scrollTop(),elementBottom=elem.offset().top+elem.height(),remaining=elementBottom-windowBottom,shouldScroll=remaining<=$window.height()*scrollDistance,shouldScroll&&scrollEnabled?(lastScrollTime=Date.now(),$rootScope.$$phase?scope.$eval(attrs.infiniteScroll):scope.$apply(attrs.infiniteScroll)):shouldScroll?checkWhenEnabled=!0:void 0}},$window.bind("scroll",handler),scope.$on("$destroy",function(){return $window.unbind("scroll",handler)}),$timeout(function(){return attrs.infiniteScrollImmediateCheck?scope.$eval(attrs.infiniteScrollImmediateCheck)?handler():void 0:handler()},0)}}}]).directive("elementScroll",[function(){return{restrict:"A",link:function(scope,element,attrs){var raw=element[0];element.bind("scroll",function(){raw.scrollTop+raw.offsetHeight+100>=raw.scrollHeight&&scope.$apply(attrs.elementScroll)})}}}]).directive("resizeImage",["$window",function(){return{restrict:"A",link:function(scope,element){function triggerResize(){$("body").width()>=768&&(scope.$index%2===0?resizeNext():resizePrevious())}function resizePrevious(){sibling=angular.element(element.parent().parent().parent().parent().parent())[0].previousElementSibling,siblingContainer=angular.element(angular.element(sibling).find(".fancyItemImageContainer")),sibling&&siblingContainer&&(siblingImage=siblingContainer.find("img"),aHeight=siblingContainer[0].clientHeight,bHeight=element[0].clientHeight,siblingImage[0].complete&&aHeight!==bHeight&&resize(siblingContainer,element,aHeight,bHeight))}function resizeNext(){sibling=angular.element(element.parent().parent().parent().parent().parent())[0].nextElementSibling,siblingContainer=angular.element(angular.element(sibling).find(".fancyItemImageContainer")),sibling&&siblingContainer&&(siblingImage=siblingContainer.find("img"),aHeight=element[0].clientHeight,bHeight=siblingContainer[0].clientHeight,siblingImage[0].complete&&aHeight!==bHeight&&resize(element,siblingContainer,aHeight,bHeight))}function resize(el1,el2,h1,h2){h1>h2?el2[0].style.height=h1+"px":h2>h1&&(el1[0].style.height=h2+"px")}var aHeight,bHeight,sibling,siblingContainer,siblingImage;scope.$on("CLASSIC",triggerResize),element.find("img").bind("load",triggerResize)}}}]),angular.module("prefetchTemplates",[]).directive("prefetchTemplates",["$window","$rootScope","$templateCache","$http","api",function($window,$rootScope,$templateCache,$http,api){var routes={home:"/application/views/app/src/app/pages/home/home.html",allStores:"/application/views/app/src/app/pages/allStores/allStores.html",category:"/application/views/app/src/app/pages/category/categories.html",store:"/application/views/app/src/app/pages/store/store.html",search:"/application/views/app/src/app/pages/search/search.html",cart:"/application/views/app/src/app/pages/cart/checkoutCart.html",checkout:"/application/views/app/src/app/pages/cart/checkout2.html",trends:"/application/views/app/src/app/pages/trends/trends.html",profile:"/application/views/app/src/app/pages/profile/profileHeader/profileHeader.html",people:"/application/views/app/src/app/pages/people/people.html",product:"/application/views/app/src/app/pages/product/product.html",couponsModal:"/application/views/app/src/app/exhaustiveFeatures/independentModals/coupons/coupons.html",bragModal:"/application/views/app/src/app/exhaustiveFeatures/callToActions/brag/bragList.html",braggedByModal:"/application/views/app/src/app/exhaustiveFeatures/independentModals/fanciedBy/usersList.html",searchProductsView:"/application/views/app/src/app/pages/search/searchProducts.html",searchStoresView:"/application/views/app/src/app/pages/search/searchStores.html",searchUsersView:"/application/views/app/src/app/pages/search/searchUsers.html",profileBragListView:"/application/views/app/src/app/pages/profile/fancyList/fancyList.html",profileAllBragsView:"/application/views/app/src/app/pages/profile/allBrags/allBrags.html",profileDetailedBragListView:"/application/views/app/src/app/pages/profile/fancyListView/fancyListView.html",profileBadgesView:"/application/views/app/src/app/pages/profile/badges/badges.html",profileSocialView:"/application/views/app/src/app/pages/profile/social/social.html",profileAboutView:"/application/views/app/src/app/pages/profile/about/about.html",profileSettingsView:"/application/views/app/src/app/pages/profile/settings/settings.html",editBragListModal:"/application/views/app/src/app/pages/profile/editFancyListModal.html",cartPreviewModal:"/application/views/app/src/app/exhaustiveFeatures/callToActions/cart/cartModal.html",redeemCouponModal:"/application/views/app/src/app/pages/cart/redeemCouponModal.html"},pageRelations={home:[{name:"bragModal",priority:1},{name:"braggedByModal",priority:2}],allStores:[{name:"store",priority:1}],category:[],store:[],cart:[{name:"redeemCouponModal",priority:1},{name:"checkout",priority:2}],search:[{name:"searchProductsView",priority:1},{name:"searchStoresView",priority:2},{name:"searchUsersView",priority:3}],trends:[],profileHeader:[{name:"profileBadgesView",priority:3},{name:"profileBragListView",priority:1},{name:"profileSocialView",priority:2},{name:"profileAboutView",priority:5},{name:"profileSettingsView",priority:6},{name:"profileAllBragsView",priority:7}],fancy:[{name:"profileDetailedBragListView",priority:1}],list:[{name:"bragModal",priority:1},{name:"editBragListModal",priority:2}],product:[]},alwaysAccessibleViews=[{name:"home",priority:1},{name:"allStores",priority:7},{name:"category",priority:4},{name:"profile",priority:3},{name:"product",priority:2},{name:"people",priority:11},{name:"cart",priority:10},{name:"search",priority:5},{name:"trends",priority:6},{name:"couponsModal",priority:8},{name:"cartPreviewModal",priority:9}],hasOnloadTriggered=!1;return{restrict:"A",controller:function(){},link:function(scope){function prefetchViews(viewsList){function prefetch(){function prefetchMoreIfAllLoaded(){console.log(n),6===++n&&sortedViews.length>0&&prefetch()}var url,n=0;sortedViews.splice(0,6).forEach(function(view){return url=routes[view.name],$templateCache.get(url)?void prefetchMoreIfAllLoaded():void $http.get(url,{cache:$templateCache}).then(function(){prefetchMoreIfAllLoaded()},function(){prefetchMoreIfAllLoaded()})})}if(viewsList&&0!==viewsList.length){var sortedViews=viewsList.sort(function(a,b){return a.priority-b.priority});prefetch()}}scope.$watch("subview",function(){api.httpRequestsFinished().then(function(){hasOnloadTriggered&&prefetchViews(pageRelations[scope.subview])})}),angular.element($window).on("load",function(){hasOnloadTriggered=!0,prefetchViews(alwaysAccessibleViews)})}}}]),angular.module("siteMessage",[]).controller("siteMsgController",["$scope","user","$timeout",function($scope,user,$timeout){$scope.newClass="",$scope.message="",$timeout(function(){!user.getloginstatus()&&$("#midSection").width()>599&&(document.body.className+=" siteMsgActive",$scope.newClass="active",$scope.message='<a href="#registerModal" role="button" data-toggle="modal">Register now </a>& get <span class="bnbRedFont"><i class="icon-fontawesome-webfont-5"></i>2500&#42;</span> worth of free shopping vouchers.')},2e4)}]),angular.module("home",["directives.fancy","directives.tag","directives.loadingSpinner","directives.masonryLayout"]).controller("HomeController",["$scope","api","requestContext","paginatorFactory",function($scope,api,requestContext,paginatorFactory){function fetchNewProducts(api){$scope.params=api,$scope.products.length=0,$scope.getProducts()}var renderContext=requestContext.getRenderContext("home");$scope.subview=renderContext.getNextSection(),$scope.$on("requestContextChanged",function(){renderContext.isChangeRelevant()&&($scope.subview=renderContext.getNextSection())});var paginator=new paginatorFactory($scope.imageCount,!0,["storeID","productID","fancy3.jpg"]),refreshData=!1;$scope.products=[],$scope.filter=4,$scope.hideSpinner=!1,$scope.filters={recentlyFancied:{val:1,api:"hdata/recent/"},popularity:{val:2,api:"hdata/popular/"},favourites:{val:3,api:"hdata/favourites/"},myFeed:{val:4,api:"rapiv1/me/feed/"}},$scope.params=$scope.filters.myFeed.api,$scope.$on("userLoggedIn",function(){refreshData=!0,paginator.reset(),$scope.getProducts()}),$scope.filterByFame=function(filter){$scope.filter=filter.val,fetchNewProducts(filter.api)},$scope.getProducts=function(){refreshData&&($scope.products.length=0,refreshData=!1),paginator.retreiveProducts($scope.params,"get").then(function(products){angular.forEach(products,function(product){product.src=api.productImage(product.storeID,product.productID),product.discounted_price=1==product.productIsOnDiscount?product.productSellingPrice-product.productDiscount:product.productSellingPrice,+product.badgeLevel?(product.badgeSrc="/assets/images/badges/fprod/"+product.badgeLevel+".png",product.badgeText=product.badgeNotificationText):(product.badgeSrc="/assets/images/badges/locked_badges.png",product.badgeText="Fancy more products to unlock badges!"),$scope.products.push(product)}),$scope.products.length>50&&($scope.hideSpinner=!0)},function(){})}}]),angular.module("allStores",[]).controller("StoreController",["$scope","api","requestContext","paginatorFactory",function($scope,api,requestContext){function getStoresByCategory(){$scope.category=categoryName,fetchNew()}function getStoresDefault(){$scope.category="All",categoryID=null,fetchNew()}function fetchNew(){$scope.stores.length=0,$scope.after=0,$scope.getStores()}var categoryID,categoryName,renderContext=requestContext.getRenderContext("allStores","categoryID");$scope.subview=renderContext.getNextSection(),$scope.$on("requestContextChanged",function(){renderContext.isChangeRelevant()&&(categoryID=requestContext.getParam("categoryID"),categoryName=requestContext.getParam("categoryName"),requestContext.hasParamChanged("categoryID")&&(categoryID?getStoresByCategory():getStoresDefault()))}),$scope.busy=!1,$scope.after=0,$scope.stores=[],$scope.category="Filter stores by category",$scope.filters={newStores:1,popularStores:2,allStores:3};var apis=[void 0,"newStores2","topStores","allStores"];$scope.filter=1,api.get("async/cats",!0).then(function(data){$scope.storesByCategories=data.cats}),$scope.hideSpinner=!1,$scope.cancelFurtherRequests=!1,$scope.getStores=function(){if(!$scope.busy&&!$scope.cancelFurtherRequests){var baseUrl="async/"+apis[+$scope.filter]+"/"+$scope.after,url=categoryID?baseUrl+"/"+categoryID:baseUrl;$scope.busy=!0,$scope.hideSpinner=!1,api.get(url,!0).then(function(data){if(!data[0].hasData)return $scope.hideSpinner=!0,$scope.cancelFurtherRequests=!0,void($scope.busy=!1);var stores=data[1];for(var store in stores){var elm=stores[store];$scope.stores.push(elm)}$scope.busy=!1,$scope.after+=1})}},$scope.filterProducts=function(filter){$scope.filter=filter,fetchNew()}}]),angular.module("trends",["directives.fancy","directives.tag"]).controller("TrendsController",["$scope","api","requestContext","trendsService","$filter","user","paginatorFactory",function($scope,api,requestContext,trendsService,$filter,user,paginatorFactory){function fetchNewProducts(){$scope.bannerSrc="",$scope.products.length=0,$scope.getProducts()
}function getRequestParam(){var cities=trendsService.names;angular.forEach(cities,function(city){return $filter("beautify")(city.urlParam)==$scope.city?($scope.requestParam=city,$scope.bannerSrc=city.bannerSrc,void($scope.breadCrumb=city.urlParam)):void 0})}var renderContext=requestContext.getRenderContext("trends","cityName");$scope.city=requestContext.getParam("cityName"),$scope.subview=renderContext.getNextSection(),$scope.$on("requestContextChanged",function(){renderContext.isChangeRelevant()&&($scope.city=requestContext.getParam("cityName"),requestContext.hasParamChanged("cityName")&&fetchNewProducts())});var paginator=new paginatorFactory($scope.imageCount,!0,["storeID","productID","fancy3.jpg"]);$scope.products=[],$scope.busy=!1,user.getloginstatus()&&!user.getCity()&&($scope.showInput=!0),$scope.saveUserCity=function(){$scope.userCity?api.post("rapiv1/profile/saveUserCity",{city:$scope.userCity}).then(function(data){data.data.updateOK?($scope.showInput=!1,window.alert("City updated!")):data.data.cityOK||window.alert("Please enter valid city!")}):window.alert("Please enter valid city!")},$scope.getProducts=function(){getRequestParam();var getParams=$scope.requestParam.requestParam?"rapiv1/trends/"+$scope.requestParam.requestParam+"/?city2="+$scope.requestParam.urlParam:"rapiv1/trends/"+$scope.requestParam.urlParam+"/";paginator.retreiveProducts(getParams,"get").then(function(products){angular.forEach(products,function(product){product.src=api.productImage(product.storeID,product.productID),product.discounted_price=1==product.productIsOnDiscount?product.productSellingPrice-product.productDiscount:product.productSellingPrice,+product.badgeLevel?(product.badgeSrc="/assets/images/badges/fprod/"+product.badgeLevel+".png",product.badgeText=product.badgeNotificationText):(product.badgeSrc="/assets/images/badges/locked_badges.png",product.badgeText="Fancy more products to unlock badges!"),$scope.products.push(product)}),$scope.products.length>50&&($scope.hideSpinner=!0)},function(){})}}]).factory("trendsService",[function(){var cities={};return cities.names={0:{urlParam:"New Delhi",requestParam:"delhi",bannerSrc:"NewDelhi"},1:{urlParam:"Mumbai",requestParam:"Bombay",bannerSrc:"Mumbai"},2:{urlParam:"Hyderabad",requestParam:"",bannerSrc:"Hyderabad"},4:{urlParam:"Kolkata",requestParam:"Calcutta",bannerSrc:"Kolkata"},5:{urlParam:"Bengaluru",requestParam:"bangalore",bannerSrc:"Bangalore"}},cities}]),angular.module("people",["directives.fancy","directives.tag","directives.loadingSpinner","directives.masonryLayout"]).controller("PeopleController",["$scope","api","requestContext","paginatorFactory",function($scope,api,requestContext,paginatorFactory){function fetchNewProducts(api){$scope.params=api,$scope.users.length=0,$scope.getUsers()}var renderContext=requestContext.getRenderContext("people");$scope.subview=renderContext.getNextSection(),$scope.$on("requestContextChanged",function(){renderContext.isChangeRelevant()&&($scope.subview=renderContext.getNextSection())});var paginator=new paginatorFactory(12,!1,["storeID","productID","fancy3.jpg"]),refreshData=!1;$scope.users=[],$scope.filter=1,$scope.hideSpinner=!1,$scope.filters={topRankers:{val:1,api:"rapiv1/people/index/1/"},mostFollowed:{val:2,api:"rapiv1/people/index/2/"},friends:{val:3,api:"rapiv1/people/index/3/"},favourites:{val:4,api:"rapiv1/people/index/4/"}},$scope.params=$scope.filters.topRankers.api,$scope.filterBySelection=function(filter){$scope.filter=filter.val,fetchNewProducts(filter.api)},$scope.getUsers=function(){refreshData&&($scope.users.length=0,refreshData=!1),paginator.retreiveProducts($scope.params,"get").then(function(users){angular.forEach(users[1],function(user){$scope.users.push(user)}),$scope.users.length>50&&($scope.hideSpinner=!0)},function(){})}}]),angular.module("dealofday",["directives.fancy","directives.tag"]).controller("DodController",["$scope","api","requestContext","trendsService","$filter","user","paginatorFactory",function($scope,api,requestContext,trendsService,$filter,user,paginatorFactory){var renderContext=requestContext.getRenderContext("dealofday");$scope.subview=renderContext.getNextSection();var paginator=new paginatorFactory(50,!0,["storeID","productID","fancy3.jpg"]);$scope.products=[],$scope.busy=!1,$scope.hideSpinner=!1,$scope.getProducts=function(){function get(){paginator.retreiveProducts("rapiv1/dod/dodProducts/"+$scope.deal.dealID+"/","get").then(function(products){$scope.hideSpinner=!0,angular.forEach(products,function(product){product.src=api.productImage(product.storeID,product.productID),product.discounted_price=1==product.productIsOnDiscount?product.productSellingPrice-product.productDiscount:product.productSellingPrice,+product.badgeLevel?(product.badgeSrc="/assets/images/badges/fprod/"+product.badgeLevel+".png",product.badgeText=product.badgeNotificationText):(product.badgeSrc="/assets/images/badges/locked_badges.png",product.badgeText="Fancy more products to unlock badges!"),$scope.products.push(product)}),$scope.products.length>50&&($scope.hideSpinner=!0)},function(error){switch(error){case"noMoreData":$scope.hideSpinner=!0}})}$scope.deal?get():$scope.$on("DEALDATAREADY",function(){get()})}}]).factory("trendsService",[function(){var cities={};return cities.names={0:{urlParam:"New Delhi",requestParam:"delhi",bannerSrc:"NewDelhi"},1:{urlParam:"Mumbai",requestParam:"Bombay",bannerSrc:"Mumbai"},2:{urlParam:"Hyderabad",requestParam:"",bannerSrc:"Hyderabad"},4:{urlParam:"Kolkata",requestParam:"Calcutta",bannerSrc:"Kolkata"},5:{urlParam:"Bengaluru",requestParam:"bangalore",bannerSrc:"Bangalore"}},cities}]),angular.module("profilePage",["facebookInvite","editFancyList"]).factory("fancyListService",[function(){var list="";return{setList:function(data){list=data},getList:function(){return list}}}]),angular.module("profilePage").controller("ProfileAboutController",["$scope","api","requestContext","user",function($scope,api,requestContext,user){var renderContext=requestContext.getRenderContext("profileHeader.about","userID");$scope.subview=renderContext.getNextSection(),$scope.$on("requestContextChanged",function(){renderContext.isChangeRelevant()&&($scope.subview=renderContext.getNextSection())}),$scope.aboutMe="",$scope.newTag="",$scope.saveBtnText="Save",$scope.allStyleTags={},$scope.userStyleTags=[],api.get("rapiv1/profile/getTags",!0).then(function(data){return data?(angular.forEach(data,function(tag){$scope.allStyleTags[tag.styleID]=tag,$scope.allStyleTags.added=!1}),api.get("rapiv1/profile/getUserStyleTags/"+$scope.userID)):void 0},function(){}).then(function(data){if(data&&data.data){var userStyleTags=data.data;$scope.userStyleTags=userStyleTags,angular.forEach(userStyleTags,function(tag){$scope.allStyleTags[tag.styleID]&&($scope.allStyleTags[tag.styleID].added=!0)})}},function(){}),$scope.updateAboutMe=function(){if($scope.aboutMe){var aboutText=$scope.aboutMe;$scope.aboutMe="",$scope.saveBtnText="Saved",api.post("rapiv1/profile/saveUserAboutMe",{aboutMe:aboutText}).then(function(data){data.data.saved&&($scope.userInfo.userAboutMe=aboutText)})}},$scope.updateSaveBtnText=function(){$scope.saveBtnText="Save"},$scope.toggleTag=function(tag){$scope.userID==user.getuser()&&($scope.allStyleTags[tag.styleID].added?($scope.allStyleTags[tag.styleID].added=!1,api.get("rapiv1/profile/removeUserStyleTag/"+tag.styleID).then(function(data){data&&!data.data.saved&&($scope.allStyleTags[tag.styleID].added=!0)},function(){$scope.allStyleTags[tag.styleID].added=!0})):($scope.allStyleTags[tag.styleID].added=!0,api.get("rapiv1/profile/saveUserStyleTag/"+tag.styleID).then(function(data){data&&!data.data.saved&&($scope.allStyleTags[tag.styleID].added=!1)},function(){$scope.allStyleTags[tag.styleID].added=!1})))}}]),angular.module("profilePage").controller("BadgesListController",["$scope","api","requestContext",function($scope,api,requestContext){function setParams(){$scope.params=$scope.userID?"badgesc/all/"+$scope.userID:"badgesc/all"}function refreshView(){$scope.hideSpinner=!1,$scope.userBadges={},setParams(),getUserBadges()}function getUserBadges(){api.get($scope.params,!0).then(function(data){var badgeType,badgeSubCategory,badgeCategory,badges=data.badges,userBadges={},userBadgesArr=[],lockedTypes=[];angular.forEach(badges,function(badge){badgeType=badge.type,-1!==Object.keys(badgesReference).indexOf(badgeType)&&(badgeCategory=badgesReference[badgeType].type,badgeSubCategory=badgesReference[badgeType].subType,badge.badgeSrc="/assets/images/badges/"+badge.img,userBadges[badgeType]||(userBadges[badgeType]={type:badgeType,text:badgeCategory+" | unlocked by "+function(){var result;switch(badgeCategory){case"explore":result="explor";break;case"brag":result="bragg";break;default:result=badgeCategory}return result}()+"ing "+badgeSubCategory+". "+badgesReference[badgeType].hint,unlockedBadges:[]}),userBadges[badge.type].unlockedBadges.push(badge))}),lockedTypes=Object.keys(badgesReference).filter(function(type){return Object.keys(userBadges).indexOf(type)<0}),angular.forEach(lockedTypes,function(type){var lockedBadges=[];badgeCategory=badgesReference[type].type,badgeSubCategory=badgesReference[type].subType;for(var i=0;16>i;i++)lockedBadges.push(i);userBadges[type]={type:type,text:badgeCategory+" | unlocked by "+("explore"===badgeCategory?"explor":badgeCategory)+"ing "+badgeSubCategory+". "+badgesReference[type].hint,lockedBadges:{badges:lockedBadges,badgeSrc:"/assets/images/badges/locked_badges.png",badgesText:"Locked!"},unlockedBadges:[]}}),angular.forEach(userBadges,function(badges){if(badges.unlockedBadges.length>0){for(var lockedBadgesCount=16-badges.unlockedBadges.length,lockedBadges=[],i=0;lockedBadgesCount>i;i++)lockedBadges.push(i);badges.lockedBadges={badges:lockedBadges,badgeSrc:"/assets/images/badges/locked_badges.png",badgesText:"Locked!"}}}),angular.forEach(userBadges,function(badges){userBadgesArr.push(badges)}),userBadgesArr.sort(function(a,b){return b.unlockedBadges.length-a.unlockedBadges.length}),$scope.userBadges=userBadgesArr,$scope.hideSpinner=!0})}var renderContext=requestContext.getRenderContext("profileHeader.badges","userID");$scope.subview=renderContext.getNextSection(),$scope.$on("requestContextChanged",function(){renderContext.isChangeRelevant()&&(requestContext.hasParamChanged("userID")&&refreshView(),$scope.subview=renderContext.getNextSection())});var badgesReference={1:{type:"explore",subType:"stores",hint:"The more you wander, the better it gets ;)"},3:{type:"follow",subType:"stores",hint:"Be a store guide..."},4:{type:"brag",subType:"products",hint:"Don't be shy, spread the love!"},6:{type:"buy",subType:"products",hint:"Ding! Sold! ;)"}};refreshView(),$scope.$on("badgeInfoModal",function(event,badge){badge.txt1="explore"==badgesReference[badge.type].type?"explor":badgesReference[badge.type].type,badge.txt2=badgesReference[badge.type].subType,$scope.activeBadge=badge})}]),angular.module("profilePage").controller("FancyListController",["$scope","fancyListService","api","requestContext","user",function($scope,fancyListService,api,requestContext,user){function refreshView(){$scope.fancyList=[],$scope.hideSpinner=!1,api.get("rapiv1/profile/fancyListDetails/"+$scope.userID,!0).then(function(data){var listToAdd;$scope.hideSpinner=!0,data.data&&data.data.fancyListsData&&angular.forEach(data.data.fancyListsData,function(list){listToAdd={fancyListID:list.fancyListID,fancyListName:list.fancyListName,fancyListDescription:list.fancyListDescription,fanciedItemsToDisplay:[],totalFancies:+list.totalFanciedProducts},list.fancyListName&&(user.getuser()==$scope.userID?$scope.fancyList.push(listToAdd):+list.totalFanciedProducts>0&&$scope.fancyList.push(listToAdd))}),loadListProducts()})}function loadListProducts(){angular.forEach($scope.fancyList,function(fancyList){+fancyList.totalFancies>0&&api.get("rapiv1/profile/fancyList/"+$scope.userID+"/"+fancyList.fancyListID+"/0/6",!0).then(function(fancyData){fancyData&&(fancyList.fanciedItemsToDisplay=fancyData)})})}var renderContext=requestContext.getRenderContext("profileHeader.fancy","userID");$scope.subview=renderContext.getNextSection(),$scope.$on("requestContextChanged",function(){renderContext.isChangeRelevant()&&(requestContext.hasParamChanged("userID")&&refreshView(),$scope.subview=renderContext.getNextSection())}),$scope.fancyList=[],refreshView(),$scope.sendList=function(list){fancyListService.setList(list)}}]),angular.module("profilePage").controller("AllBragsController",["$scope","api","requestContext","paginatorFactory",function($scope,api,requestContext,paginatorFactory){function refreshView(){$scope.hideSpinner=!1,$scope.showFancyMessage=!1,$scope.braggedProducts.length=0,$scope.getProducts()}var renderContext=requestContext.getRenderContext("profileHeader.allBrags","userID");$scope.subview=renderContext.getNextSection(),$scope.$on("requestContextChanged",function(){renderContext.isChangeRelevant()&&(requestContext.hasParamChanged("userID")&&refreshView(),$scope.subview=renderContext.getNextSection())});var paginator=new paginatorFactory(35,!0,["storeID","productID","img1_240x200.jpg"]);$scope.braggedProducts=[],$scope.bragList="",$scope.hideSpinner=!1,$scope.getProducts=function(){paginator.retreiveProducts("rapiv1/profile/fancyList/"+$scope.userID+"/0/","get").then(function(data){console.log("All Bragged Products --->  ",data),$scope.braggedProducts.push.apply($scope.braggedProducts,data)},function(error){"noMoreData"==error&&($scope.hideSpinner=!0)})}}]),angular.module("profilePage").controller("MutualProductsController",["$scope","api","requestContext","paginatorFactory",function($scope,api,requestContext,paginatorFactory){function refreshView(){$scope.hideSpinner=!1,$scope.showFancyMessage=!1,$scope.braggedProducts.length=0,$scope.getProducts()}var renderContext=requestContext.getRenderContext("profileHeader.mutualproducts","userID");$scope.currentUser=requestContext.getParam("userID"),$scope.subview=renderContext.getNextSection(),$scope.$on("requestContextChanged",function(){renderContext.isChangeRelevant()&&(requestContext.hasParamChanged("userID")&&($scope.currentUser=requestContext.getParam("userID"),refreshView()),$scope.subview=renderContext.getNextSection())});var paginator=new paginatorFactory(35,!0,["storeID","productID","img1_240x200.jpg"]);$scope.mutualProducts=[],$scope.bragList="",$scope.hideSpinner=!1,$scope.getProducts=function(){paginator.retreiveProducts("rapiv1/mutual/products/"+$scope.currentUser+"/","get").then(function(data){console.log("Mutual Products --->  ",data),$scope.mutualProducts.push.apply($scope.mutualProducts,data)},function(error){"noMoreData"==error&&($scope.hideSpinner=!0)})}}]),angular.module("profilePage").controller("FancyListViewController",["$scope","api","fancyListService","requestContext","paginatorFactory",function($scope,api,fancyListService,requestContext,paginatorFactory){function refreshView(){$scope.hideSpinner=!1,$scope.showFancyMessage=!1,$scope.listProducts.length=0,$scope.getListProducts()}var renderContext=requestContext.getRenderContext("profileHeader.list","listID");$scope.listID=requestContext.getParam("listID"),$scope.subview=renderContext.getNextSection(),$scope.$on("requestContextChanged",function(){renderContext.isChangeRelevant()&&(requestContext.hasParamChanged("listID")&&($scope.listID=requestContext.getParam("listID"),refreshView()),$scope.subview=renderContext.getNextSection())});var paginator=new paginatorFactory(12,!0,["storeID","productID","img1_240x200.jpg"]);$scope.listProducts=[],$scope.bragList="",$scope.hideSpinner=!1,$scope.bragList=fancyListService.getList(),$scope.$on("PRODUCTEDITED",function(event,data){var product=$scope.listProducts.filter(function(obj){return obj.productID==data.productData.pid})[0];$scope.listProducts.splice($scope.listProducts.indexOf(product),1)}),$scope.getListProducts=function(){paginator.retreiveProducts("rapiv1/profile/fancyList/"+$scope.userID+"/"+$scope.listID+"/","get").then(function(data){console.log("FANCY LIST VIEW DATA --->  ",data),$scope.listProducts.push.apply($scope.listProducts,data)},function(error){"noMoreData"==error&&($scope.hideSpinner=!0)})}}]),angular.module("profilePage").controller("ProfileInfoController",["$scope","$window","api","requestContext","user","$rootScope",function($scope,$window,api,requestContext,user,$rootScope){function refreshView(){$scope.hideLoader=!1,$scope.fancyListReady=!1,$scope.fancyList=[],$rootScope.$broadcast("clearImage"),api.get("rapiv1/profile/info/"+$scope.userID,!0).then(function(data){if(!data.data.userInfo)return void($scope.hideLoader=!0);var userInfo=data.data.userInfo[0],userNameDetails=userInfo.userFullName.split(" ");userInfo.firstName=userNameDetails.slice(0,-1).join(" "),userInfo.lastName=userNameDetails.slice(-1)[0],$scope.userInfo=userInfo,$scope.userStyleTags=userInfo.userStyleTags?userInfo.userStyleTags.split(","):[],$scope.hideLoader=!0})}var renderContext=requestContext.getRenderContext("profileHeader","userID");$scope.userID=requestContext.getParam("userID"),$scope.subview=renderContext.getNextSection(),console.log($scope.subview),$scope.$on("requestContextChanged",function(){renderContext.isChangeRelevant()&&(requestContext.hasParamChanged("userID")&&($scope.userID=requestContext.getParam("userID"),refreshView()),$scope.subview=renderContext.getNextSection())}),$scope.hideLoader=!1,$scope.fancyListReady=!1,$scope.fbConnectClass=user.getfbID()?"active":"",$scope.$on("userLoggedIn",function(){$scope.fbConnectClass=user.getfbID()?"active":""}),$scope.twConnectClass="",refreshView();var firstVisit=!0;$scope.$watch("subview",function(view){user.getuser()==$scope.userID?firstVisit?(_bnbAnalytics.trackProfileVisit(user.getuser(),user.getEmail(),"self","firstVisit"),firstVisit=!1):_bnbAnalytics.trackProfileVisit(user.getuser(),user.getEmail(),"self",view):firstVisit?(_bnbAnalytics.trackProfileVisit(user.getuser(),user.getEmail(),$scope.userID,"firstVisit"),firstVisit=!1):_bnbAnalytics.trackProfileVisit(user.getuser(),user.getEmail(),$scope.userID,view)}),$scope.connectWithFB=function(){if(!$scope.fbConnectClass){var fbDimensions=new function(){this.width=800,this.height=450,this.left=($window.innerWidth-this.width)/2,this.top=($window.innerHeight-this.height)/2};window.fbConnectWindow=window.open("/rapiv1/ulogin/facebook","_blank","width="+fbDimensions.width+", height="+fbDimensions.height+", left="+fbDimensions.left+", top="+fbDimensions.top+", status=yes, resizable=yes",!0)}}}]),angular.module("profilePage").controller("ProfileSettingsController",["$scope","api","requestContext","$http","$timeout",function($scope,api,requestContext,$http,$timeout){var renderContext=requestContext.getRenderContext("profileHeader.settings");$scope.subview=renderContext.getNextSection(),$scope.$on("requestContextChanged",function(){renderContext.isChangeRelevant()&&($scope.subview=renderContext.getNextSection())}),$scope.genders=["male","female"],$scope.saveResponse="",$scope.editableUserInfo={},$scope.savedClass="",angular.copy($scope.userInfo,$scope.editableUserInfo),$scope.editableUserInfo.gender=$scope.genders[$scope.genders.indexOf($scope.editableUserInfo.userGender.toLowerCase())],$http.get("/countryList.json").then(function(data){$scope.countries=data.data,angular.forEach($scope.countries,function(country){country.name==$scope.editableUserInfo.userCountry&&($scope.editableUserInfo.country=country)})}),$scope.updateProfile=function(){var userDOB=$scope.editableUserInfo.userDOB.split("-");$scope.$broadcast("showSpinner"),api.post("rapiv1/profile/saveUserDetails",{fName:$scope.editableUserInfo.firstName+" "+$scope.editableUserInfo.lastName,dd:userDOB[2],mm:userDOB[1],yy:userDOB[0],sex:$scope.editableUserInfo.gender,city:$scope.editableUserInfo.userCity,cc:$scope.editableUserInfo.country.code}).then(function(data){$scope.$broadcast("hideSpinner"),$scope.savedClass="savingDone",$timeout(function(){$scope.savedClass=""},5e3);var response=data.data;response.updateOK&&($scope.saveResponse="Changes successfully saved!")})},$scope.resetForm=function(){angular.copy($scope.userInfo,$scope.editableUserInfo)}}]).controller("PasswordChangeController",["api","$scope","user",function(api,$scope){$scope.formError="",$scope.$watch("passwords.newPswd",function(password){$scope.formError=password&&password.length<7?"Password should be atleast 7 characters long!":""}),$("#passwordChangeModal").on("hidden",function(){$scope.$apply(function(){$scope.formError="",$scope.passwords.currPswd="",$scope.passwords.newPswd="",$scope.passwords.cnfNewPswd=""})}),$scope.changePassword=function(){$scope.passwords.newPswd!==$scope.passwords.cnfNewPswd?$scope.formError="New Passwords must match!":api.post("rapiv1/profile/saveNewPassword",{curPw:$scope.passwords.currPswd,newPw:$scope.passwords.newPswd,cnfNewPw:$scope.passwords.cnfNewPswd}).then(function(data){var response=data.data;$scope.formError=response.userExists?response.currentPasswordMatches?response.passwordUpdated?"Password successfully changed!":"Password could not be updated, please try after some time!":"Please enter correct Current Password!":"User Does not Exist!"})}}]),angular.module("profilePage").controller("SocialController",["$scope","api","requestContext","user",function($scope,api,requestContext,user){function loadFollowers(){api.get("rapiv1/profile/followers/"+$scope.userID+"/"+$scope.followerAfter+"/"+listSize,!0).then(function(data){return data&&"null"!==data.data&&null!==data.data?(data.data.length<listSize&&($scope.hideFollowerBtn=!0),angular.forEach(data.data,function(user){$scope.followers.push(user)}),void($scope.hideFollowerSpinner=!0)):($scope.hideFollowerBtn=!0,$scope.hideFollowerSpinner=!0,void($scope.followers.length<1&&user.getuser()&&$scope.userID==user.getuser()&&($scope.showSuggestions=!0,$scope.followSuggestions=[],chainLoading())))})}function chainLoading(){var influencer=influencers.pop();influencer&&api.get("rapiv1/profile/info/"+influencer,!0).then(function(data){var info=data.data.userInfo[0];return info.userID=influencer,$scope.followSuggestions.push(info),chainLoading()})}function loadFollowing(){api.get("rapiv1/profile/following/"+$scope.userID+"/"+$scope.followingAfter+"/"+listSize,!0).then(function(data){return data&&"null"!==data.data&&null!==data.data?(data.data.length<listSize&&($scope.hideFollowingBtn=!0),angular.forEach(data.data,function(user){$scope.following.push(user)}),void($scope.hideFollowingSpinner=!0)):($scope.hideFollowingBtn=!0,void($scope.hideFollowingSpinner=!0))})}function refreshView(){$scope.hideFollowerSpinner=!1,$scope.hideFollowingSpinner=!1,$scope.followerAfter=0,$scope.followingAfter=0,$scope.followers.length=0,$scope.following.length=0,$scope.hideFollowerBtn=!1,$scope.hideFollowingBtn=!1,loadFollowers(),loadFollowing()}var renderContext=requestContext.getRenderContext("profileHeader.social","userID");$scope.subview=renderContext.getNextSection(),$scope.$on("requestContextChanged",function(){renderContext.isChangeRelevant()&&(requestContext.hasParamChanged("userID")&&refreshView(),$scope.subview=renderContext.getNextSection())});var listSize=10,influencers=[22,77,2509,1221,5642,9597,2340,2461,6276,3670,989,3024,5984,9029,7495,5955,8006,4147,2800,94,2801,115];$scope.followerAfter=0,$scope.followingAfter=0,$scope.showSuggestions=!1,$scope.followers=[],$scope.following=[],$scope.hideFollowerBtn=!1,$scope.hideFollowingBtn=!1,$scope.hideFollowerSpinner=!1,$scope.hideFollowingSpinner=!1,refreshView(),$scope.loadMoreFollowers=function(){$scope.followerAfter+=1,loadFollowers()},$scope.loadMoreFollowing=function(){$scope.followingAfter+=1,loadFollowing()}}]),angular.module("editFancyList",[]).directive("editFancylist",["$location","$rootScope","$cacheFactory","user","api",function($location,$rootScope,$cacheFactory,user,api){return{restrict:"A",controller:function($scope){var listPointer;$scope.$on("editFancyListModal",function(event,data){listPointer=data.list,$scope.listCopy=angular.copy(data.list),$scope.editableListName=$scope.listCopy.fancyListName,$scope.editableListDescription=$scope.listCopy.fancyListDescription}),$scope.updateListData=function(){var lName=$scope.editableListName,lDesc=$scope.editableListDescription;$scope.editableListName="",$scope.editableListDescription="",$scope.listCopy.fancyListName!=lName&&api.post("rapiv1/profile/updateFancyListName",{listID:$scope.listCopy.fancyListID,listName:lName}).then(function(data){if(data&&data.data&&data.data.saved){listPointer.fancyListName=lName;var bragListCache=api.getHttpCacheObject("/index.php/rapiv1/profile/fancyListDetails/"+user.getuser());bragListCache.data.fancyListsData.findObject("fancyListID",$scope.listCopy.fancyListID).fancyListName=lName,api.updateHttpCache("/index.php/rapiv1/profile/fancyListDetails/"+user.getuser(),bragListCache)}},function(){}),$scope.listCopy.fancyListDescription!=lDesc&&api.post("rapiv1/profile/saveFancyListDescription",{listID:$scope.listCopy.fancyListID,listDesc:lDesc}).then(function(data){if(data&&data.data&&data.data.saved){var bragListCache=api.getHttpCacheObject("/index.php/rapiv1/profile/fancyListDetails/"+user.getuser());bragListCache.data.fancyListsData.findObject("fancyListID",$scope.listCopy.fancyListID).fancyListDescription=lDesc,api.updateHttpCache("/index.php/rapiv1/profile/fancyListDetails/"+user.getuser(),bragListCache),listPointer.fancyListDescription=lDesc}},function(){}),angular.element("#editFancyListModal").modal("hide")},$scope.deleteList=function(list){api.post("rapiv1/profile/deleteFancyList",{listID:list.fancyListID}).then(function(data){if(data&&data.data&&data.data.result){var bragListCache=api.getHttpCacheObject("/index.php/rapiv1/profile/fancyListDetails/"+user.getuser()),listsArray=bragListCache.data.fancyListsData;listsArray.deleteObject("fancyListID",list.fancyListID),api.updateHttpCache("/index.php/rapiv1/profile/fancyListDetails/"+user.getuser(),bragListCache),angular.element("#editFancyListModal").modal("hide"),$location.path("profile/fancy/"+user.getuser())}})}},link:function(){}}}]),angular.module("categoryPage",[]).controller("CategoryController",["$scope","paginatorFactory","requestContext","categoryService","$q","$http","api",function($scope,paginatorFactory,requestContext,categoryService,$q,$http,api){function setParams(){var allSubCategories=[];if(0==$scope.sparseCategories[$scope.categoryID].parentID)$scope.params="/"+$scope.categoryID,$scope.parentCategory=$scope.categoryID;else{var pid=$scope.sparseCategories[$scope.categoryID].parentID,params="";for(allSubCategories.push($scope.categoryID);0!=pid;)allSubCategories.push(pid),pid=$scope.sparseCategories[pid].parentID;var reversedCats=allSubCategories.reverse();$scope.parentCategory=reversedCats[0],angular.forEach(reversedCats,function(val){params=params+"/"+val}),$scope.params=params}defer.resolve()}function renderSubView(){setParams(),$scope.filter=7,$scope.products.length=0,$scope.getProducts()}var renderContext=requestContext.getRenderContext("categories","categoryID");$scope.categoryID=requestContext.getParam("categoryID"),$scope.subview=renderContext.getNextSection(),$scope.$on("requestContextChanged",function(){renderContext.isChangeRelevant()&&($scope.categoryID=requestContext.getParam("categoryID"),requestContext.hasParamChanged("categoryID")&&renderSubView())});var defer=$q.defer(),paginator=new paginatorFactory($scope.imageCount,!0,["storeID","productID","fancy3.jpg"]),refreshData=!1;$scope.products=[],$scope.sparseCategories=[],$scope.filter=4,$scope.params="",$scope.hideSpinner=!1,$scope.filters={lowestPrice:1,highestPrice:2,popularity:3,latest:4,onSale:6,trending:7},categoryService.getCategories().then(function(data){$scope.sparseCategories=data,setParams()}),$scope.$on("userLoggedIn",function(){refreshData=!0,paginator.reset(),$scope.getProducts()}),$scope.filterProducts=function(filter){$scope.filter=filter,$scope.products.length=0,$scope.getProducts()},$scope.getProducts=function(){function loadRemoteData(){paginator.retreiveProducts("async/catProducts"+$scope.params,"post",requestObject).then(function(data){var count=0;angular.forEach(data,function(product){product.src=api.productImage(product.storeID,product.productID),product.discountedPrice=1==product.productIsOnDiscount?product.productSellingPrice-product.productDiscount:product.productSellingPrice,$scope.products.push(product),count++}),15>count&&($scope.hideSpinner=!0)},function(error){switch(error){case"noMoreData":$scope.hideSpinner=!0}})}refreshData&&($scope.products.length=0,refreshData=!1);var requestObject;requestObject=$scope.filter?{sortBy:$scope.filter}:{},$scope.params?loadRemoteData():defer.promise.then(function(){loadRemoteData()})}}]).directive("navigationBreadcrumbs",["categoryService","$routeParams","$filter","$location",function(categoryService,$routeParams){return{restrict:"A",link:function(scope){function updateSubCategories(cats){scope.cats=cats}function updateBreadcrumbs(){scope.path=categoryService.getRelativePath(),updateSubCategories(categoryService.cats)}scope.$on("ActiveCategoryChanged",function(){updateBreadcrumbs()}),scope.changeSubCats=function(cats){cats.children.length>0&&(updateSubCategories(cats),scope.path.push(cats))},scope.linkBackPath=function(cat){categoryService.setCategoryData(cat)};categoryService.getCategories().then(function(){scope.sparseCategories=categoryService.sparseCategories,categoryService.setCategoryData(scope.sparseCategories[$routeParams.categoryID]),updateBreadcrumbs()})}}}]).directive("navigationtree",["$compile","categoryService",function($compile,categoryService){return{restrict:"E",scope:{cats:"="},terminal:!0,link:function(scope,element){var template='<ul class="dropdown-menu dark hidden-iphone-landscape"><li  class="{{ (cat.parentID == 0) && \'dropdown-submenu\' || \'\' }}" ng-repeat="cat in cats.children"><a ng-click=passChildren(cat) ng-href="{{cat.data.relativeUrl}}{{cat.data.catID}}" tabindex="-1">{{cat.data.title}} ({{cat.data.totalProducts}})</a><navigationtree cats="cat"></navigationtree></li></ul>',linkedTemplate=$compile(angular.element(template))(scope),parentElement=element.parent();parentElement.bind("mouseenter",function(){(null===scope.cats.parentID||0===+scope.cats.parentID)&&0!==scope.cats.children.length&&parentElement.append(linkedTemplate)}),scope.passChildren=function(cat){categoryService.setCategoryData(cat)}}}}]).factory("categoryService",["$rootScope","api","$q","$filter",function($rootScope,api,$q,$filter){var serveCats={cats:"",sparseCategories:"",categories:"",path:""},defer1=$q.defer(),defer2=$q.defer();return api.get("async/catsData2").then(function(data){for(var roots,index,itemsByID=[],cats=data,sortOrder=[],sortedRoots=new Array(7),i=0;7>i;i++)sortOrder.push(cats[i].catID);angular.forEach(cats,function(item){itemsByID[item.catID]={data:{title:item.catName,catID:item.catID,totalProducts:item.totalProducts,relativeUrl:""},children:[],parentID:item.parentCatID}}),serveCats.sparseCategories=itemsByID,defer1.resolve(itemsByID),angular.forEach(itemsByID,function(item){null!==item.parentID&&0!=item.parentID?itemsByID[item.parentID]&&(itemsByID[item.parentID].children.push(item),item.data.relativeUrl=itemsByID[item.parentID].data.relativeUrl+$filter("beautify")(item.data.title)+"/"):item.data.relativeUrl=$filter("beautify")(item.data.title)+"/"}),roots=itemsByID.filter(function(item){return 0==item.parentID}),angular.forEach(roots,function(root){index=sortOrder.indexOf(root.data.catID),sortedRoots[index]=root}),console.log(sortedRoots),serveCats.categories={data:{title:"All Categories",catID:null},children:sortedRoots,parentID:null},defer2.resolve(serveCats.categories)}),serveCats.getCategories=function(categoriesType){return categoriesType&&"roots"===categoriesType?defer2.promise:defer1.promise},serveCats.setCategoryData=function(cats){this.cats=cats,$rootScope.$broadcast("ActiveCategoryChanged")},serveCats.getRelativePath=function(cat){this.path=[];var tempID=cat||this.cats.data.catID,pid=this.sparseCategories[tempID].parentID;for(this.path.push(tempID);0!=pid;)this.path.push(pid),pid=this.sparseCategories[pid].parentID;
return this.path.reverse().map(function(x){return serveCats.sparseCategories[x]})},serveCats}]),angular.module("storePage",["directives.fancy","directives.loadingSpinner"]).controller("StorePageController",["$scope","api","requestContext","paginatorFactory","user",function($scope,api,requestContext,paginatorFactory,user){function renderSectionView(){initSectionRequests=!showStoreProducts,$scope.filter=7,$scope.products.length=0,$scope.getProducts()}var renderContext=requestContext.getRenderContext("store","storeSectionID"),showStoreProducts=!1;$scope.storeID=requestContext.getParam("storeID"),$scope.subview=renderContext.getNextSection(),$scope.$on("requestContextChanged",function(){renderContext.isChangeRelevant()&&($scope.storeSectionID=requestContext.getParam("storeSectionID"),showStoreProducts=$scope.storeSectionID?!1:!0,requestContext.hasParamChanged("storeSectionID")&&renderSectionView())});var urlBase,hasFanciedStore,initSectionRequests=!1,paginator=new paginatorFactory($scope.imageCount,!0,[$scope.storeID,"productID","fancy3.jpg"]),refreshData=!1;$scope.products=[],$scope.filter=4,$scope.hideSpinner=!1,$scope.followText="",$scope.filters={lowestPrice:1,highestPrice:2,popularity:3,latest:4,onSale:6,trending:7},api.get("async/storeSections/"+$scope.storeID).then(function(data){$scope.storeSections=data.storeSections,$scope.storeInfo=data.storeInfo[0],hasFanciedStore=$scope.storeInfo.hasFanciedStore||0,$scope.followText=1==hasFanciedStore?"Following!":"Follow Store!"}),$scope.$on("userLoggedIn",function(){refreshData=!0,paginator.reset(),$scope.getProducts()}),$scope.fancyStore=function(){user.getloginstatus()&&"Follow Store!"===$scope.followText?($scope.$broadcast("showSpinner"),api.get("async/fancyStore/"+$scope.storeID).then(function(data){var resp=data.result;resp.userStoreFollowOK&&($scope.storeInfo.storeFancyCounter=resp.storeFancyCounter,$scope.followText="Following!",$scope.$broadcast("hideSpinner"))})):user.getloginstatus()||$("#loginModal").modal("show")},$scope.getProducts=function(){refreshData&&($scope.products.length=0,refreshData=!1),urlBase=initSectionRequests?"async/storeSectionProducts/"+$scope.storeID+"/"+$scope.storeSectionID+"/"+$scope.filter+"/":"async/storeProducts/"+$scope.storeID+"/"+$scope.filter+"/",paginator.retreiveProducts(urlBase,"get").then(function(data){var count=0;angular.forEach(data,function(product){product.src=api.productImage($scope.storeID,product.productID),product.discountedPrice=1==product.productIsOnDiscount?product.productSellingPrice-product.productDiscount:product.productSellingPrice,$scope.products.push(product),count++}),15>count&&($scope.hideSpinner=!0)},function(error){switch(error){case"noMoreData":$scope.hideSpinner=!0}})},$scope.filterProducts=function(filter){$scope.filter=filter,$scope.products.length=0,$scope.getProducts()}}]),angular.module("cartPage",["services.cart"]).directive("cartpagecheckout",["api","requestContext","cart","user",function(api,requestContext,cart){return{restrict:"A",scope:!0,controller:function($scope){var renderContext=requestContext.getRenderContext("cart");$scope.subview=renderContext.getNextSection(),$scope.$on("requestContextChanged",function(){renderContext.isChangeRelevant()&&($scope.subview=renderContext.getNextSection())});$scope.closeModal("checkoutModal"),$scope.cartData={},$scope.showSpinner=!1,$scope.emptyCart=!1,cart.get().then(function(data){return Object.keys(data.stores).length<1?void($scope.emptyCart=!0):void($scope.cartData=data)}),$scope.$watchCollection("[cartData.discount, cartData.totalAmount]",function(){$scope.cartData.totalPayable=$scope.cartData.totalAmount-$scope.cartData.discount}),$scope.updateCart=function(item){$scope.showSpinner=!0,cart.updateCart(item).then(function(){$scope.showSpinner=!1})},$scope.deleteCartItem=function(item){$scope.showSpinner=!0,cart.deleteCartItem(item).then(function(){$scope.cartData.stores[item.storeID].itemCount-=1,$scope.showSpinner=!1})},$scope.removeCoupon=function(){cart.removeCoupon()},$scope.saveCart=function(){api.get("rapiv1/checkout/init/1").then(function(){})}},link:function(){}}}]).directive("useCouponsModal",["user","cart",function(user,cart){var couponsHtmlRef={0:[void 0,"% off - Site wide"],1:["Rs ",void 0," off - Site wide"],5:["Rs ",void 0," off - ",void 0," category only"],8:[void 0,"% off -",void 0," store only"]},rupeeCoupons=[1,5],storeCoupons=[8],categoryCoupons=[5],couponPropertiesToUse=["couponValue","param1"];return{restrict:"A",scope:!0,controller:function($scope){var couponsObject=user.getUserCoupons(),availableCoupons=[];$scope.errorMessage="",angular.forEach(couponsObject,function(coupon){availableCoupons.push(coupon)}),angular.forEach(availableCoupons,function(coupon){var propertyCounter=0,couponType=+coupon.couponType;coupon.couponSpecifics=[],storeCoupons.indexOf(couponType)>-1?(coupon.couponSpecifics.push("store"),coupon.couponSpecifics.push(coupon.param1[1])):categoryCoupons.indexOf(couponType)>-1&&(coupon.couponSpecifics.push("category"),coupon.couponSpecifics.push(coupon.param1[1])),coupon.couponText=couponsHtmlRef[+coupon.couponType].map(function(ref){return ref?ref:coupon[couponPropertiesToUse[propertyCounter++]]}).join(""),coupon.discountType=rupeeCoupons.indexOf(+coupon.couponType)>-1?"Rs":"perc"}),availableCoupons.splice(0,0,{couponText:"Select from your available coupons"}),$scope.availableCoupons=angular.copy(availableCoupons),$scope.selectedCoupon=$scope.availableCoupons[0],$scope.discount=0,delete availableCoupons,$scope.redeemCoupon=function(){cart.applyCoupon($scope.selectedCoupon).then(function(data){data&&$scope.closeModal("couponSelectModal")},function(error){switch(error){case"minimumAmountError":$scope.errorMessage="Your cart amount should be greater than";break;case"storeCouponNotApplicable":$scope.errorMessage="You don't have product of store in your cart"}})}},link:function(scope,element){scope.$on("$destroy",function(){element.remove()})}}}]),angular.module("checkoutPage",[]).directive("blurFocus",[function(){var BLUR_CLASS="ng-blurred";return{restrict:"A",require:"ngModel",link:function(scope,element,attrs,ctrl){ctrl.$blurred=!1,console.log(scope),element.bind("keydown",function(){element.removeClass(BLUR_CLASS),scope.$apply(function(){ctrl.$blurred=!1,scope.checkoutForm.submitted=!1})}),element.bind("blur",function(){element.addClass(BLUR_CLASS),scope.$apply(function(){ctrl.$blurred=!0})})}}}]).directive("checkoutPageHandler",["api",function(api){function addressModel(){this.fullName="",this.email="",this.address1="",this.address2="",this.city="",this.state="",this.country="",this.pincode="",this.contactNumber="",this.addressType={shipping:"",billing:""}}return{restrict:"A",scope:!0,controller:function($scope){function fetchAddresses(){api.get("rapiv1/address/read").then(function(data){data.isLoggedIN&&(+data.totalResults>0?($scope.savedAddresses=data.result,$scope.shippingAddress=$scope.savedAddresses.sort(function(add1,add2){return+add1.lastUsed-+add2.lastUsed})[0],$scope.billingAddress=angular.copy($scope.shippingAddress),window.scrollTo(0,0)):$scope.showAddressesAndForm=!0)})}var addressToChange,editMode=!1;$scope.addressDetails=new addressModel,$scope.showAddressesAndForm=!1,$scope.shippingAddress="",$scope.billingAddress="",$scope.savedAddresses=[],$scope.paymentDetails={method:""},fetchAddresses(),api.http("/countryList.json").then(function(data){$scope.countries=data,angular.forEach($scope.countries,function(){$scope.addressDetails.country=$scope.countries[100]})}),$scope.confirmCheckout=function(){if($scope.checkoutForm.$valid){var names=$scope.addressDetails.fullName.split(" ");api.post("rapiv1/address/save",{editMode:editMode?1:0,addressID:editMode?$scope.addressDetails.addressID:"",firstName:names[0],lastName:names.splice(1).join(" "),email:$scope.addressDetails.email,address1:$scope.addressDetails.address1,address2:$scope.addressDetails.address2,city:$scope.addressDetails.city,state:$scope.addressDetails.state,country:$scope.addressDetails.country.name,zipcode:$scope.addressDetails.pincode,phoneNo:$scope.addressDetails.contactNumber,addressType:+$scope.addressDetails.addressType.shipping+ +$scope.addressDetails.addressType.billing}).then(function(data){data.isValid&&data.result.created&&fetchAddresses(),$scope.clearForm()})}else console.log("INVALID"),$scope.checkoutForm.submitted=!0},$scope.editAddress=function(address){switch($scope.clearForm(),$scope.addressDetails.fullName=address.firstName+" "+address.lastName,$scope.addressDetails.address1=address.address1,$scope.addressDetails.address2=address.address2,$scope.addressDetails.city=address.city,$scope.addressDetails.state=address.state,$scope.addressDetails.country=$scope.countries[$scope.countries.indexOfObject("name",address.country)],$scope.addressDetails.pincode=address.zipCode,$scope.addressDetails.contactNumber=address.mobile,$scope.addressDetails.addressID=address.addressID,+address.addressType){case 1:$scope.addressDetails.addressType.shipping=1,$scope.addressDetails.addressType.billing=0;break;case 2:$scope.addressDetails.addressType.shipping=0,$scope.addressDetails.addressType.billing=2;break;case 3:$scope.addressDetails.addressType.shipping=1,$scope.addressDetails.addressType.billing=2}editMode=!0},$scope.changeAddress=function(addressType){addressToChange=addressType,$scope.showAddressesAndForm=!0},$scope.selectAddress=function(address){1==addressToChange?$scope.shippingAddress=address:2==addressToChange&&($scope.billingAddress=address),$scope.showAddressesAndForm=!1},$scope.deleteAddress=function(address){var addressID=address.addressID;address&&api.get("rapiv1/address/delete/"+addressID).then(function(data){data.result.deleted&&($scope.savedAddresses.deleteObject("addressID",addressID),$scope.shippingAddress.addressID==addressID&&($scope.shippingAddress=""),$scope.billingAddress.addressID==addressID&&($scope.billingAddress=""))})},$scope.clearForm=function(){$scope.checkoutForm.$setPristine(),$scope.checkoutForm.submitted=!1,editMode=!1,$scope.addressDetails=new addressModel},$scope.$watch("paymentDetails.method",function(val){val&&api.get("rapiv1/checkout/setPaymentMethod/"+$scope.shippingAddress.addressID+"/"+$scope.billingAddress.addressID+"/"+val).then(function(data){var nonCODProducts,data=data.result;$scope.proceedToPay=function(){function checkState(){data.stateSaved.saved||window.alert("Some error occured on the server, we apologise for the inconvenience. Please try again after some time.")}if(data.validParams&&data.addressExists&&data.stateDataExists&&data.addressSet&&data.paymentOptionSet)if(data.paymentOptionConflict){if(nonCODProducts=data.nonCODProducts,!window.confirm("COD is not available for "+nonCODProducts.length+" products in your cart, they will be dropped from this order. Do you wish to continue?"))return;checkState()}else checkState()}})})},link:function(scope){scope.checkoutForm.submitted=!1}}}]),angular.module("search",["directives.fancy"]).controller("SearchController",["$scope","$location","$rootScope","api","requestContext",function($scope,$location,$rootScope,api,requestContext){function getResults(){newSearch&&api.get($scope.urlParams.count+$scope.rawSearchKey).then(function(data){var pc=data.productsCount||0,sc=data.storesCount||0,uc=data.usersCount||0;0===pc&&(0===sc?0!==uc&&$location.path("search/people/"+$scope.searchKey).replace():$location.path("search/stores/"+$scope.searchKey).replace()),$scope.resultsCount={products:!isNaN(pc)&&pc>0?pc:0,stores:!isNaN(sc)&&sc>0?sc:0,users:!isNaN(uc)&&uc>0?uc:0}},function(){})}function searchThis(){$scope.productsVault.length=0,$scope.storesVault.length=0,$scope.usersVault.length=0,$scope.resultsCount.products="",$scope.resultsCount.stores="",$scope.resultsCount.users="",newSearch=!0,getResults()}var renderContext=requestContext.getRenderContext("search",["searchKey"]);$scope.searchKey=requestContext.getParam("searchKey"),$scope.rawSearchKey=$scope.searchKey.split("-").join(" "),$scope.subview=renderContext.getNextSection(),$scope.$on("requestContextChanged",function(){renderContext.isChangeRelevant()&&($scope.searchKey=requestContext.getParam("searchKey"),$scope.rawSearchKey=$scope.searchKey.split("-").join(" "),requestContext.hasParamChanged("searchKey")&&searchThis(),$scope.subview=renderContext.getNextSection())}),$scope.urlParams={products:"search/results/",stores:"search/storeResult/",users:"search/userResult/",count:"search/resultsCount/"},$scope.resultsCount={products:"",stores:"",users:""};var newSearch=!0;$scope.productsVault=[],$scope.storesVault=[],$scope.usersVault=[],$scope.midSectionClass="products"===$scope.subview&&"nonTouch"==$rootScope.deviceType?"searchPage container-fluid fluidHomePage cssTransitionSlow":"searchPage container cssTransitionSlow",searchThis()}]).controller("SearchProductsController",["$scope","$rootScope","api","requestContext",function($scope,$rootScope,api,requestContext){function refreshData(){page=0,$scope.hideSpinner=!1,$scope.noResults=!1,$scope.products.length=0,noMoreData=!1,$scope.getProducts()}var renderContext=requestContext.getRenderContext("search.products",["searchKey"]);$scope.subview=renderContext.getNextSection(),$scope.$on("requestContextChanged",function(){renderContext.isChangeRelevant()&&requestContext.hasParamChanged("searchKey")&&refreshData()});var pageData,pages=0,page=0,pageSize=20,noMoreData=!1;$scope.products=[],$scope.hideSpinner=!1,$scope.noResults=!1,$scope.getProducts=function(){console.log("Firing request"),0!==Object.keys($scope.productsVault).length?noMoreData||($scope.hideSpinner=!0,pageData=$scope.productsVault.slice(page*pageSize,(page+1)*pageSize-1),$scope.products.push.apply($scope.products,pageData),++page===pages&&(noMoreData=!0)):api.get($scope.urlParams.products+$scope.rawSearchKey).then(function(data){return!data||"object"!=typeof data||"object"==typeof data&&0===Object.keys(data).length?($scope.hideSpinner=!0,noMoreData=!0,void($scope.noResults=!0)):($scope.hideSpinner=!0,$scope.productsVault.length=0,angular.forEach(data,function(product){product.src=api.productImage(product.storeID,product.productID),product.discountedPrice=1==product.productIsOnDiscount?product.productSellingPrice-product.productDiscount:product.productSellingPrice,$scope.productsVault.push(product)}),pages=Math.ceil($scope.productsVault.length/pageSize),pageData=$scope.productsVault.slice(page*pageSize,(page+1)*pageSize-1),$scope.products.push.apply($scope.products,pageData),void(++page===pages&&(noMoreData=!0)))},function(){})}}]).controller("SearchStoresController",["$scope","api","requestContext",function($scope,api,requestContext){function refreshData(){page=0,$scope.hideSpinner=!1,$scope.noResults=!1,$scope.stores.length=0,noMoreData=!1,$scope.getStores()}var renderContext=requestContext.getRenderContext("search.stores",["searchKey"]);$scope.subview=renderContext.getNextSection(),$scope.$on("requestContextChanged",function(){renderContext.isChangeRelevant()&&requestContext.hasParamChanged("searchKey")&&refreshData()});var pageData,pages=0,page=0,pageSize=20,noMoreData=!1;$scope.stores=[],$scope.hideSpinner=!1,$scope.noResults=!1,$scope.getStores=function(){0!==Object.keys($scope.storesVault).length?noMoreData||($scope.hideSpinner=!0,pageData=$scope.storesVault.slice(page*pageSize,(page+1)*pageSize-1),$scope.stores.push.apply($scope.stores,pageData),++page===pages&&(noMoreData=!0)):api.get($scope.urlParams.stores+$scope.rawSearchKey).then(function(data){return!data||"object"!=typeof data||"object"==typeof data&&0===Object.keys(data).length?($scope.hideSpinner=!0,noMoreData=!0,void($scope.noResults=!0)):($scope.hideSpinner=!0,$scope.storesVault.length=0,angular.forEach(data,function(store){$scope.storesVault.push(store)}),pages=Math.ceil($scope.storesVault.length/pageSize),pageData=$scope.storesVault.slice(page*pageSize,(page+1)*pageSize-1),$scope.stores.push.apply($scope.stores,pageData),void(++page===pages&&(noMoreData=!0)))},function(){})}}]).controller("SearchUsersController",["$scope","api","requestContext",function($scope,api,requestContext){function refreshData(){page=0,$scope.hideSpinner=!1,$scope.noResults=!1,$scope.users.length=0,noMoreData=!1,$scope.getUsers()}var renderContext=requestContext.getRenderContext("search.people",["searchKey"]);$scope.subview=renderContext.getNextSection(),$scope.$on("requestContextChanged",function(){renderContext.isChangeRelevant()&&requestContext.hasParamChanged("searchKey")&&refreshData()});var pageData,pages=0,page=0,pageSize=20,noMoreData=!1;$scope.users=[],$scope.hideSpinner=!1,$scope.noResults=!1,$scope.getUsers=function(){0!==Object.keys($scope.usersVault).length?noMoreData||($scope.hideSpinner=!0,pageData=$scope.usersVault.slice(page*pageSize,(page+1)*pageSize-1),$scope.users.push.apply($scope.users,pageData),++page===pages&&(noMoreData=!0)):api.get($scope.urlParams.users+$scope.rawSearchKey).then(function(data){return!data||"object"!=typeof data||"object"==typeof data&&0===Object.keys(data).length?($scope.hideSpinner=!0,noMoreData=!0,void($scope.noResults=!0)):($scope.hideSpinner=!0,$scope.usersVault.length=0,angular.forEach(data,function(user){user.userDetails;$scope.usersVault.push(user)}),pages=Math.ceil($scope.usersVault.length/pageSize),pageData=$scope.usersVault.slice(page*pageSize,(page+1)*pageSize-1),$scope.users.push.apply($scope.users,pageData),void(++page===pages&&(noMoreData=!0)))},function(){})}}]).directive("typeahead",["$window","$location","api","$filter","$rootScope",function($window,$location,api,$filter,$rootScope){var minChars=2;return{restrict:"A",controller:function($scope){$scope.showSuggestions=!1,$scope.searchResults=[],$scope.active=null,this.activate=function(item){$scope.active=item},this.activateNext=function(){var index=$scope.searchResults.indexOf($scope.active);this.activate($scope.searchResults[(index+1)%$scope.searchResults.length])},this.activatePrevious=function(){var index=$scope.searchResults.indexOf($scope.active);this.activate(0===index?null:$scope.searchResults[index-1])},this.isActive=function(item){return $scope.active===item},this.selectActive=function(){$scope.showSuggestions=!1},this.shouldSearch=function(){return parseInt(minChars)<=$scope.searchKey.trim().length},this.safeApply=function(fn){$rootScope.$$phase?$scope.$eval(fn):$scope.$apply(fn)}},link:function(scope,element,attrs,controller){function setPath(){var currentSplitPath=$location.path().split("/");return"search"!=currentSplitPath[1]?"search/products/":currentSplitPath[1]+"/"+currentSplitPath[2]+"/"}console.log(controller);var inputElem=element.find("input");inputElem.bind("focus",function(){controller.safeApply(function(){scope.showSuggestions=!0})}),inputElem.bind("blur",function(){controller.safeApply(function(){scope.showSuggestions=!1})}),inputElem.bind("keydown",function(event){var code=event.keyCode;38===code&&(event.preventDefault(),scope.$apply(function(){controller.activatePrevious()})),40===code&&(event.preventDefault(),scope.$apply(function(){controller.activateNext()})),(9===code||13===code||27===code)&&event.preventDefault()}),inputElem.bind("keyup",function(event){var code=event.keyCode;(9===code||13===code)&&scope.$apply(function(){scope.active?controller.selectActive():(scope.showSuggestions=!1,$location.path(setPath()+$filter("beautify")(scope.searchKey)),element.removeClass("searchActive"),inputElem.blur())}),27===code&&controller.safeApply(function(){scope.showSuggestions=!1})})}}}]).directive("typeaheadItem",[function(){return{restrict:"A",require:"^typeahead",link:function(scope,element,attrs,controller){var item=scope.$eval(attrs.typeaheadItem);scope.$watch(function(){return controller.isActive(item)},function(active){active?element.addClass("active"):element.removeClass("active")}),element.bind("mouseenter",function(){scope.$apply(function(){controller.activate(item)})}),element.bind("mousedown",function(){scope.$apply(function(){controller.selectActive()})})}}}]),angular.module("productPage",["directives.cart","directives.fancy","directives.imageZoom","fanciedByUsersModal"]).directive("productPageHandler",["$filter","$rootScope","api","requestContext","user","imageService",function($filter,$rootScope,api,requestContext,user,imageService){return{restrict:"A",scope:!0,controller:function($scope,$element){function loadProductComments(){api.get("rapiv1/comments/read/"+$scope.productID).then(function(data){data&&(data.result?(angular.forEach(data.result,function(value){value.commentedTime=function(){var commentTime=+value.commentTime,timeDiff=Math.ceil(Date.now()/1e3-commentTime);return 60>timeDiff?timeDiff>0?timeDiff+" secs ago":"1 sec ago":3600>timeDiff?Math.floor(timeDiff/60)+" mins ago":172800>timeDiff?Math.floor(timeDiff/3600)<(new Date).getHours()?Math.floor(timeDiff/3600)+" hours ago":"Yesterday at "+$filter("date")(1e3*commentTime,"h:mm a"):$filter("date")(1e3*commentTime,"MMM d, yyyy  h:mm a")}()}),$scope.productComments=data.result):1===$scope.productComments.length&&($scope.productComments.length=0))})}function loadRemoteData(){$scope.productComments.length=0,$scope.usersWhoFancied=[],$element.find(".fancyItemImageContainer img")[0].src="",api.get("async/productPageData/"+$scope.productID).then(function(data){var i,imageURL,variantName,variant="",colorVariants=[],sizeVariants=[],qvdata=data.qvData,moreStoreProducts=data.moreStoreProducts,descriptionHtml=qvdata.productDescription,thumbnails=data.filesExistence,variants=data.variants,descriptionText=function(){var div=document.createElement("div"),html=descriptionHtml;return div.innerHTML=html,div.textContent||div.innerText||""}();for(variants&&angular.forEach(variants,function(val){variantName=val.variantName,variantQuantity=val.variantQuantity,variantName&&"COLOR"===variantName.toUpperCase()?(variant=val.variantColor,variant&&colorVariants.push({color:variant,variantQuantity:variantQuantity})):variantName&&"SIZE"===variantName.toUpperCase()&&(variant=val.variantSize,variant&&sizeVariants.push({size:variant,variantQuantity:variantQuantity}))}),$scope.hideSpinner=!0,$scope.storeID=qvdata.storeID,productImageUrl=api.productImage($scope.storeID,$scope.productID),$scope.productImage=productImageUrl+"fancy2.jpg",$scope.productName=qvdata.productName,$scope.dynamicSeoContent.title=angular.copy($scope.productName),$scope.dynamicSeoContent.description=descriptionText,$scope.dynamicSeoContent.ogType="product",$scope.dynamicSeoContent.image=api.productImage($scope.storeID,$scope.productID)+"img1_240x200.jpg",$scope.dynamicSeoContent.imageType="image/jpg",$scope.dynamicSeoContent.imageWidth="240",$scope.dynamicSeoContent.imageHeight="200",$scope.storeName=qvdata.storeName,$scope.hasFancied=qvdata.hasFancied,$scope.hasBragged=qvdata.hasBragged,$scope.fancyCount=qvdata.productFancyCounter,$scope.bragCount=qvdata.productBragCounter,$scope.viewCount=qvdata.productVisitCounter,$scope.discountAvailable=qvdata.isOnDiscount,$scope.originalPrice=qvdata.productSellingPrice,$scope.discountedPrice=1==qvdata.isOnDiscount?qvdata.productSellingPrice-qvdata.productDiscount:qvdata.productSellingPrice,$scope.productDescription=qvdata.productDescription,$scope.productDescriptionShort=descriptionText.split(".")[0]+".",$scope.totalQuantity=qvdata.productQuantity,$scope.isCOD=qvdata.storeCODPolicy,$scope.isEMI=qvdata.storeEMIPolicy,$scope.isHappyReturn=qvdata.storeReturnPolicy,$scope.processingTime=+qvdata.processingTime,$scope.deliveryDate=Date.now()+864e5*$scope.processingTime,$scope.colorVariants=0!==colorVariants.length?colorVariants:null,$scope.selectedColorVariant=$scope.colorVariants?$scope.colorVariants[0]:null,$scope.sizeVariants=0!==sizeVariants.length?sizeVariants:null,$scope.selectedSizeVariant=$scope.sizeVariants?$scope.sizeVariants[0]:null,$scope.moreProducts=moreStoreProducts,$scope.productQuantity=function(){for(var i=1,quantity=[];i<=parseInt($scope.totalQuantity);)quantity.push({num:i}),i++;return quantity}(),$scope.selectedQuantity=$scope.productQuantity[0],$scope.imageThumbs=function(){var imageThumbs=[];return angular.forEach(thumbnails,function(val,key){val&&imageThumbs.push({imageURL:api.productImage($scope.storeID,$scope.productID),num:parseInt(key)+1})}),imageThumbs}(),i=1;5>=i;i++){var userID=eval("qvdata.userID"+i),userFBID=eval("qvdata.user"+i+"FBID"),userGender=eval("qvdata.user"+i+"Gender"),imageURL;userID&&(imageURL=userFBID&&!isNaN(userFBID)?api.userImageFb(userFBID,75):api.userImageBnb(userGender),$scope.usersWhoFancied.push({userID:userID,imageURL:imageURL}))}})}var renderContext=requestContext.getRenderContext("product","productID");$scope.productID=requestContext.getParam("productID"),$scope.subview=renderContext.getNextSection(),$scope.$on("requestContextChanged",function(){renderContext.isChangeRelevant()&&($scope.productID=requestContext.getParam("productID"),requestContext.hasParamChanged("productID")&&($scope.hideSpinner=!1,$scope.similarProducts.length=0,cancelFurther=!1,page=0,window.scrollTo(0,0),loadRemoteData()))}),window.scrollTo(0,0);var page=0,cancelFurther=!1,productCommentsInitialised=!1,productImageUrl;$scope.busy=!1,$scope.hideSpinner=!1,$scope.productComment="",$scope.productComments="",$scope.similarProducts=[],loadRemoteData(),$scope.loadRemainingData=function(){!productCommentsInitialised&&loadProductComments(),productCommentsInitialised=!0},$scope.checkLogin=function($event){user.getloginstatus()||($event.preventDefault(),$("#loginModal").modal("show"))},$scope.saveComment=function($event){$event&&13===$event.keyCode&&($event.preventDefault(),user.getloginstatus()?$scope.userComment&&api.post("rapiv1/comments/save",{ctype:1,comments:$scope.userComment,pid:$scope.productID}).then(function(data){$scope.userComment="",data.result&&loadProductComments()}):$("#loginModal").modal("show"))},$scope.deleteComment=function(cid,userID){user.getuser()==userID&&api.get("rapiv1/comments/delete/"+cid).then(function(data){data.result&&loadProductComments()})},$scope.editComment=function(comment,$event){$event&&13===$event.keyCode&&($event.preventDefault(),comment.toggle=!1,user.getuser()==comment.userID&&api.post("rapiv1/comments/update/"+comment.commentID,{comments:comment.userComments}).then(function(data){data.result&&loadProductComments()}))},$scope.changeProductImage=function(num){imageNum=num,$scope.productImage=1===num?productImageUrl+"fancy2.jpg":productImageUrl+"img"+num+"_product.jpg"},$scope.loadSimilarFanciedProducts=function(){if(!cancelFurther){if($scope.busy)return;$scope.busy=!0,api.get("rapiv1/product/fanciedUsersFancies/"+$scope.productID+"/"+page).then(function(data){return!data||"object"!=typeof data||"object"==typeof data&&0===Object.keys(data).length?void(cancelFurther=!0):(page++,$scope.similarProducts.push.apply($scope.similarProducts,data),void($scope.busy=!1))},function(){})}},$scope.showLargerImages=function(){imageService.set({productName:$scope.productName,productImage:productImageUrl,imageThumbs:$scope.imageThumbs})}},link:function(){}}}]).factory("imageService",[function(){var imageSources;return{set:function(obj){imageSources=obj},get:function(){return imageSources}}}]).directive("productImageZoom",["imageService",function(imageService){return{restrict:"A",link:function(scope,element){var imageUrl;scope.$on("SHOW",function(){var imageSources=imageService.get();imageUrl=imageSources.productImage,scope.productImage=imageUrl+"fancy1.jpg",scope.productImageThumbs=imageSources.imageThumbs,scope.productName=imageSources.productName}),scope.$on("HIDE",function(){scope.productImage="",element.find(".zoomProductImage")[0].src=""}),scope.changeProductImage=function(num){scope.productImage=1===+num?imageUrl+"fancy1.jpg":imageUrl+"img"+num+"_product.jpg"}}}}]).directive("imageSlider",[function(){return{restrict:"A",scope:!0,link:function(scope,element){function getImageCount(){imageCount=container[0].children.length}var imageCount,container=element.find(".imageContainers");scope.imagesViewed=5,scope.$watch("imagesViewed",function(count){scope.showPrevious=count>5?!0:!1,scope.showNext=imageCount?imageCount>count?!0:!1:!0}),scope.getPrevious=function(){var resolution=$(".container").width();imageCount||getImageCount(),scope.imagesViewed>5&&(resolution>=768?container.css("left",parseInt(container.css("left"))+885):container.css("left",parseInt(container.css("left"))+675),scope.imagesViewed-=5)},scope.getNext=function(){var resolution=$(".container").width();imageCount||getImageCount(),scope.imagesViewed<imageCount&&(resolution>=768?container.css("left",parseInt(container.css("left"))-885):container.css("left",parseInt(container.css("left"))-675),scope.imagesViewed+=5)}}}}]),angular.module("blocked",[]).directive("blockedView",["api",function(api){return{restrict:"A",controller:function($scope){var page=0,busy=!1;$scope.products=[],$scope.getProducts=function(){busy||4===page||(busy=!0,api.get("rapiv1/ldata/get/"+page).then(function(data){data&&data.result&&($scope.products.push.apply($scope.products,data.result),page++,busy=!1)},function(){}))}},link:function(){}}}]),angular.module("facebookInvite",["facebookService"]).directive("inviteFacebook",["$rootScope","user","facebookFriends",function($rootScope,user,facebookFriends){var fbFriendsNotOnBnb={male:[],female:[]},fbFriendsOnBnb={male:[],female:[]},fbFriends=[];return{restrict:"A",controller:function($scope){function updateFriends(count){var femaleFriends;5===count?"male"==$rootScope.user.userdata.gender.toLowerCase()?(femaleFriends=fbFriendsNotOnBnb.female.slice(femaleCounter,femaleCounter+4),$scope.fbFriendsToInvite.push.apply($scope.fbFriendsToInvite,femaleFriends),$scope.fbFriendsToInvite.push.apply($scope.fbFriendsToInvite,fbFriendsNotOnBnb.male.slice(maleCounter,maleCounter+5-femaleFriends.length)),femaleCounter+=femaleFriends.length,maleCounter+=5-femaleFriends.length):(femaleFriends=fbFriendsNotOnBnb.female.slice(femaleCounter,femaleCounter+3),$scope.fbFriendsToInvite.push.apply($scope.fbFriendsToInvite,femaleFriends),$scope.fbFriendsToInvite.push.apply($scope.fbFriendsToInvite,fbFriendsNotOnBnb.male.slice(maleCounter,maleCounter+5-femaleFriends.length)),femaleCounter+=femaleFriends.length,maleCounter+=5-femaleFriends.length):($scope.fbFriendsToInvite.push.apply($scope.fbFriendsToInvite,fbFriendsNotOnBnb.female.slice(femaleCounter,femaleCounter+1)),femaleCounter+=1)}var maleCounter=0,femaleCounter=0;$scope.fbFriendsToInvite=[],user.getloginstatus()&&0===fbFriends.length&&facebookFriends.get().then(function(response){response&&0!==response.length&&(fbFriends=response,angular.forEach(fbFriends,function(friend){"undefined"==typeof friend.installed?"male"==friend.gender.toLowerCase()?fbFriendsNotOnBnb.male.push(friend):fbFriendsNotOnBnb.female.push(friend):friend.installed&&("male"==friend.gender.toLowerCase()?fbFriendsOnBnb.male.push(friend):fbFriendsOnBnb.female.push(friend))}),updateFriends(5))}),$scope.inviteFriend=function(friend){FB.ui({method:"apprequests",message:user.getName()+" has invited you to join BuynBrag. Discover amazing designs, brag the things you love, unlock amazing deals!",to:friend.id},function(response){response&&response.to&&1===response.to.length&&$scope.$apply(function(){$scope.fbFriendsToInvite.splice($scope.fbFriendsToInvite.indexOf(friend),1),"female"==friend.gender.toLowerCase()?fbFriendsNotOnBnb.female.splice(fbFriendsNotOnBnb.female.indexOf(friend),1):fbFriendsNotOnBnb.male.splice(fbFriendsNotOnBnb.male.indexOf(friend),1)})})},$scope.inviteMultiple=function(){FB.ui({method:"apprequests",message:user.getName()+" has invited you to join BuynBrag. Discover amazing designs, brag the things you love, unlock amazing deals!",filters:["app_non_users"]},function(response){response&&response.to&&$scope.$apply(function(){})})},$scope.$watch("fbFriendsToInvite.length",function(val){if(5>val&&0!=fbFriends.length){var friendsToLoad=5-+val;updateFriends(friendsToLoad)}})},link:function(){}}}]),angular.module("addthis",[]).directive("addthisShare",["$filter",function($filter){return{restrict:"E",replace:!0,template:'<div class="shareItemIcon pull-right"><a class="addthis_button_compact" href=""></a></div>',link:function(scope,element){var share_obj={url:"http://buynbrag.com/#/product/"+$filter("beautify")(scope.img.productName)+"/"+scope.img.productID,title:scope.img.productName},addthis_config={data_track_addressbar:!0,data_track_clickback:!0,data_ga_tracker:"UA-35785264-1",data_ga_social:!0,services_expanded:"facebook,twitter,google_plusone_share,pinterest,email",services_compact:"facebook,twitter,google_plusone_share,pinterest,email",services_exclude:"thefancy,print,yahoomail",ui_use_addressbook:!0};
addthis.button(element[0].children[0],addthis_config,share_obj)}}}]),angular.module("inviteFriends",[]).controller("InviteController",["$scope","api","user","dataService",function($scope,api,user,dataService){var options={contenturl:"http://dm234.buynbrag.com/#/home",clientid:"647407892758.apps.googleusercontent.com",cookiepolicy:"http://buynbrag.com",prefilltext:"Invitation to join BuynBrag",calltoactionlabel:"INVITE",calltoactionurl:"http://dm234.buynbrag.com/#/home?invite=true"};$scope.showFriends=!1,$scope.inviteFriend=function(){api.post("invite/email",{inviteeEmailAddress:$scope.invite.emails}).then(function(data){console.log(data),data[1].savedInvite&&data[1].hash&&alert("Invitation successfully sent!")})},$scope.inviteFacebookFriends=function(){var msg=user.getName()+" has invited you to join BuynBrag. Discover amazing designs, brag the things you love, unlock amazing deals!";FB.ui({method:"apprequests",message:msg,filters:["app_non_users"]},function(response){if(response){for(var request_ids="",i=0;i<response.to.length;i++)response.request+"_"+response.to[i],request_ids=request_ids.length>0?request_ids+","+response.request+"_"+response.to[i]:response.request+"_"+response.to[i];api.post("invite/fbInvite/save",{request_ids:request_ids})}})},$scope.inviteGooglePlusFriends=function(){window.gapi.interactivepost.render("sharePost",options)},$scope.inviteGmailFriends=function(){},$scope.inviteTwitterFriends=function(){api.get("twitterLogin/isConnected").then(function(data){data.isConnected?$scope.getTwitterFollowers():window.tw_window=window.open("/twitterLogin/index","_blank","height=500,width=700,left=250,top=100,resizable=yes",!0)})},$scope.getTwitterFollowers=function(){api.get("twitterLogin/followers").then(function(data){dataService.setData(data),$scope.showFriends=!1})}}]).controller("FriendsController",["$scope","api","dataService",function($scope,api,dataService){var selected=[];$scope.showFriends=!1,$scope.$on("friendsAvailable",function(){var followers=dataService.data.users;angular.forEach(followers,function(val){val.checked=!1}),$scope.twitterFollowers=followers,$scope.showFriends=!0}),$scope.toggleAll=function(bool){angular.forEach($scope.twitterFollowers,function(val){console.log(bool),val.checked=bool})},$scope.sendInvites=function(){selected=[],angular.forEach($scope.twitterFollowers,function(val){1==val.checked&&selected.push(val.id)}),api.post("twitterLogin/sendMessage",{followerIDs:selected})}}]).controller("InviteStatusController",["$scope","api",function($scope,api){$scope.inviteStatus={0:"Invitation Sent",1:"Joined",2:"Already Registered"},$scope.invitedFriends=api.get("invite/invlist",1)}]),window.bnbAppSocial={},function(b){setTimeout(function(){$("body").prepend('<div id="fb-root"></div>'),$("body").append('<div id="sharePost"></div>'),window.fbAsyncInit=function(){FB.init({appId:"394741787279624",channelUrl:"//"+window.location.host+"/assets/channel.html",status:!0,cookie:!0,xfbml:!0,frictionlessRequests:!0})}},500),function(doc,script){setTimeout(function(){var js,fjs=doc.getElementsByTagName(script)[0],getScript=function(url,id,sdk,callback){doc.getElementById(id)||(js=doc.createElement(script),js.src=url,id&&(js.id=id),fjs.parentNode.insertBefore(js,fjs),js.onload=js.onreadystatechange=function(){this.readyState&&"loaded"!=this.readyState&&"complete"!=this.readyState||(b[sdk]=!0,callback&&callback())})};b.facebookLoaded||getScript("//connect.facebook.net/en_US/all.js","facebook-jssdk","facebookLoaded"),b.frogLoaded||getScript("//buynbragin.nsfleximail.com/buynbragin/etrack.php","frog-script","frogLoaded")},500)}(document,"script")}(window.bnbAppSocial),angular.module("facepile",[]).directive("facepile",["$document",function(){return{restrict:"E",template:'<div class="fb-facepile" data-href="https://www.facebook.com/Buynbrag" data-size="large" data-colorscheme="light" data-width="{{containerWidth}}" data-max-rows="1"></div>',link:function(scope){scope.containerWidth=document.getElementById("midSection").clientWidth}}}]),angular.module("userSession.signIn",["services.cart"]).directive("signIn",["$rootScope","$location","$window","$timeout","user","api","$cookieStore","cart","$q","$route",function($rootScope,$location,$window,$timeout,user,api,$cookieStore,cart){return{restrict:"A",controller:function($scope){function updateUserData(logindata,userdata,badgedata){var fbId=logindata.FBID&&!isNaN(logindata.FBID)?logindata.FBID:null,imgSrc=fbId?api.userImageFb(fbId,75):api.userImageBnb(logindata.gender);$rootScope.user={userid:logindata.ID,userdata:{loggedin:!0,email:logindata.email,name:logindata.fullName,city:logindata.userCity,country:logindata.userCountry,gender:logindata.gender,dob:logindata.userDOB,cartcount:userdata.cartCount,rank:userdata.rank||logindata.ID,fancy:parseInt(userdata.fancyCount),fbid:fbId,fbsrc:imgSrc,totalBadges:userdata.totalBadges||0,bragBucks:logindata.bragBucks,collectionsCount:userdata.fancyListCount},badgesData:badgedata},$rootScope.$broadcast("userLoggedIn"),cart.get(),document.documentElement.className+=" loggedIn";var fbRegister=getCookie("bnbX_firstLogin");"true"===fbRegister?_bnbAnalytics.fbRegisterSuccess(logindata.ID,logindata.email,logindata.fullName,logindata.gender,logindata.FBID,logindata.userDOB,logindata.userAge,logindata.userCity,logindata.userCountry):_bnbAnalytics.trackLoginSuccess(logindata.ID,logindata.email,logindata.fullName,logindata.gender,logindata.FBID,logindata.userDOB,logindata.userAge,logindata.userCity,logindata.userCountry,logindata.userJoinedDate),_bnbAnalytics.userStatsUpdate(logindata.ID,logindata.email,userdata.rank,userdata.fancyCount,userdata.cartCount,userdata.totalOrders,userdata.totalBadges)}function handleNewUser(){var imgSrc="http://affiliates.icubeswire.com/track_lead/353/"+user.getEmail(),elm=document.createElement("img");elm.src=imgSrc,angular.element("body").append(elm),$cookieStore.remove("newBnbUser")}$rootScope.user={userid:null,userdata:{loggedin:!1}},$scope.formError=null,$scope.signInFB=function(){var fbDimensions=new function(){this.width=800,this.height=450,this.left=($window.innerWidth-this.width)/2,this.top=($window.innerHeight-this.height)/2};navigator.userAgent.match("CriOS")?$window.location.href="/fbLogin/index":fbLoginWindow=window.open("/rapiv1/ulogin/facebook","_blank","width="+fbDimensions.width+", height="+fbDimensions.height+", left="+fbDimensions.left+", top="+fbDimensions.top+", status=yes, resizable=yes",!1)},$scope.connectWithFB=function(){api.get("rapiv1/firstlogin/changeUserFlowStatus/6").then(function(data){data&&data.data&&($window.location.href="/")})},$scope.logUserIn=function(){api.get("async/checkLogin").then(function(data){if(data[0]&&data[0].isLoggedIN&&data[1])switch(+data[1].rFlowStatus){case 1:$rootScope.userDetails=data[1],$rootScope.$broadcast("CATEGORYVIEW");break;case 6:updateUserData(data[1],data[2],data[3].badgesData)}else $rootScope.$broadcast("notLoggedIn");$cookieStore.get("newBnbUser")&&handleNewUser()})},$scope.clearError=function(){$scope.formError=""},$scope.signInLocal=function(){$scope.loginForm.$valid?api.post("async/login",{signin_email:$scope.login.email,signin_pw:$scope.login.password}).then(function(data){var signInDetails=data[1],signInData=data[2],badgesData=data[3].badgesData;data[0].validCredentials&&data[0].sessionSet&&data[0].rFlowStatus?(-1!==$location.path().indexOf("login")&&($window.location.href="/"),updateUserData(signInDetails,signInData,badgesData),angular.element("#loginModal").modal("hide")):$scope.formError="Please enter valid Email & Password!"}):$scope.formError="Please enter valid Email & Password!"}},link:function(scope,element){scope.logUserIn(),scope.$on("$destroy",function(){element.remove()})}}}]),angular.module("userSession.signUp",["registrationFlow"]).directive("signUp",["$location","$window","$timeout","user","api","$cookieStore",function($location,$window,$timeout,user,api,$cookieStore){return{restrict:"A",controller:function($scope){$scope.startRegistration=function(){var fbDimensions=new function(){this.width=800,this.height=450,this.left=($window.innerWidth-this.width)/2,this.top=($window.innerHeight-this.height)/2};navigator.userAgent.match("CriOS")?$window.location.href="/fbLogin/index":fbRegistrationWindow=window.open("/rapiv1/ulogin/facebook","_blank","width="+fbDimensions.width+", height="+fbDimensions.height+", left="+fbDimensions.left+", top="+fbDimensions.top+", status=yes, resizable=yes",!0)}},link:function(scope){scope.signUpLocal=function(){scope.register.pw1!==scope.register.pw2&&(scope.formError="Passwords do not match!"),api.post("ajax/signup",{signup_email:scope.register.email,signup_fname:scope.register.fname,signup_lname:scope.register.lname,signup_pw1:scope.register.pw1,signup_pw2:scope.register.pw2,signup_gender:scope.register.gender}).then(function(data){switch(data){case"sign_up_success":$timeout(function(){$cookieStore.put("newBnbUser",{newRegisteredUser:(new Date).getTime()}),-1!==$location.path().indexOf("register")&&($window.location.href="#/"),$timeout(function(){$window.location.reload()},100)},500);break;case"existing_signup_user":scope.formError="User already registered";break;case"existing_facebook_user":scope.formError="User already signed up with facebook";break;default:scope.formError="Please check the details entered"}})}}}}]),angular.module("userSession",["userSession.signIn","userSession.signUp"]),angular.module("registrationFlow",["fancyProducts","followPeople","selectRegistrationCategory"]).directive("registrationFlow",["api",function(api){var views={1:"category",2:"products",3:"people"};return{restrict:"A",controller:function($scope){$scope.subview="",$scope.showRegistrationModal=!1,$scope.displayModal=function(){$scope.showRegistrationModal=!0,api.get("async/checkLogin").then(function(data){var level=data[0]&&data[0].isLoggedIN?data[1].rFlowStatus:0;1===+level&&($scope.userDetails=data[1],$scope.$broadcast("CATEGORYVIEW"))})},$scope.$on("PEOPLEVIEW",function(){$scope.subview="people"}),$scope.$on("CATEGORYVIEW",function(){$scope.showRegistrationModal=!0,$scope.subview="category"}),$scope.$on("PRODUCTSVIEW",function(){$scope.subview="products"}),$scope.$on("STOREVIEW",function(){$scope.subview="stores"}),$scope.goBack=function(view){view>1&&($scope.subview=views[+view-1])}},link:function(){}}}]),angular.module("selectRegistrationCategory",[]).directive("selectCategory",["$rootScope","$window","api",function($rootScope,$window,api){return{restrict:"A",controller:function($scope){$scope.categoriesSelected=0,api.get("rapiv1/firstlogin/cats").then(function(data){data&&data.data&&($scope.categoriesToSelect=data.data)}),$scope.switchView=function(){$scope.categoriesSelected>=1&&$scope.$emit("PRODUCTSVIEW")},$scope.$watch("categoriesSelected",function(count){$scope.buttonText=1>count?1-count+" more":"Continue"})},link:function(){}}}]).directive("selectCat",["api",function(api){var txtSelect="Select",txtSelected="UnSelect",selectedCategories=[];return{restrict:"A",controller:function($scope){$scope.selectText=selectedCategories.indexOf($scope.category.catID)>-1?txtSelected:txtSelect,$scope.$parent.categoriesSelected=selectedCategories.length},link:function(scope){scope.selectCat=function(cat){scope.selectText===txtSelect?(scope.selectText=txtSelected,api.get("rapiv1/firstlogin/saveCatPref/"+cat.catID).then(function(data){data&&data.data&&(selectedCategories.push(cat.catID),scope.$parent.categoriesSelected++)})):scope.selectText===txtSelected&&(scope.selectText=txtSelect,api.get("rapiv1/removeCatPref/"+cat.catID).then(function(data){data.data&&data.data.saved&&(selectedCategories.splice(selectedCategories.indexOf(cat.catID),1),scope.$parent.categoriesSelected--)}))}}}}]).directive("fancyProduct",["api",function(api){var txtFancy="Fancy It!",txtFancied="Fancied!";return{restrict:"A",scope:{productid:"@"},controller:function($scope){$scope.fancyText=txtFancy},link:function(scope,element){element.bind("mouseup",function(){scope.$apply(function(){scope.fancyText===txtFancy&&api.get("async/fancy2/"+scope.productid).then(function(data){data.fancy&&!data.alreadyFancied&&(scope.fancyText=txtFancied,scope.$parent.$parent.productsFancied++)})})})}}}]),angular.module("fancyProducts",[]).directive("bragProducts",["$rootScope","$window","api",function($rootScope,$window,api){return{restrict:"A",controller:function($scope){var page=0;$scope.productsFancied=3,$scope.loadNext=function(){api.get("rapiv1/ldata/get/"+page).then(function(data){data.result&&($scope.productsToFancy=data.result,page++)})},$scope.switchView=function(){$scope.productsFancied>=3&&$scope.$emit("PEOPLEVIEW")},$scope.$watch("productsFancied",function(count){$scope.buttonText=3>count?3-count+" more":"Continue"}),$scope.loadNext()},link:function(){}}}]).directive("bragThis",["api",function(api){var braggedClass="hasBragged",productsBragged=[];return{restrict:"E",scope:{pid:"@",sid:"@",uname:"@",pname:"@"},templateUrl:function(tElement,tAttrs){return"undefined"!=typeof tAttrs.url?tAttrs.url:"/application/views/app/src/app/user/bragBtn.html"},controller:function($scope){$scope.triggerBrag=function(){$scope.braggedClass||($scope.braggedClass=braggedClass,$scope.$parent.$parent.productsFancied++,api.get("async/fancy2/"+$scope.pid).then(function(data){data.fancy&&!data.alreadyFancied&&(productsBragged.push($scope.pid),_bnbAnalytics.fancySuccess($scope.pid,$scope.pname,$scope.sid,data.catID,data.subCatID1,"Registration_Flow"))}))}},link:function(scope,element,attrs){attrs.$observe("pid",function(pid){scope.braggedClass=productsBragged.indexOf(pid)>-1?braggedClass:""}),scope.$parent.$parent.productsFancied=productsBragged.length}}}]),angular.module("followPeople",[]).directive("followPeople",["$rootScope","$window","api",function($rootScope,$window,api){return{restrict:"A",controller:function($scope){$scope.personsFollowed=0,$scope.personsToFollow=[],$scope.friendsOnFacebook=[],api.get("rapiv1/firstlogin/getHandPickedUsers").then(function(data){var suggestedUsers=data.data.handpicked||null,facebookFriends=data.data.friends||null;facebookFriends&&angular.forEach(facebookFriends,function(value){value.userImgSrc=isNaN(value.userFBID)?api.userImageBnb(value.userGender):api.userImageFb(value.userFBID,75),$scope.friendsOnFacebook.push(value)}),suggestedUsers&&angular.forEach(suggestedUsers,function(value){value.userImgSrc=isNaN(value.userFBID)?api.userImageBnb(value.userGender):api.userImageFb(value.userFBID,75),$scope.personsToFollow.push(value)})}),$scope.switchView=function(){$scope.personsFollowed>=3&&api.get("rapiv1/firstlogin/changeUserFlowStatus/6").then(function(data){data&&data.data&&$window.location.reload()})},$scope.$watch("personsFollowed",function(count){$scope.buttonText=3>count?3-count+" more":"Finish"})},link:function(){}}}]).directive("followUser",["api","$rootScope",function(api,$rootScope){var txtFollow="Follow",txtFollowed="Following";return{restrict:"E",scope:{usertofollow:"@",userid:"@",classlist:"@",followers:"@"},templateUrl:"/application/views/app/src/app/user/followBtn.html",controller:function($scope){$scope.followText=txtFollow},link:function(scope){scope.triggerFollow=function(){scope.followText===txtFollow&&(scope.followText=txtFollowed,scope.$parent.$parent.personsFollowed++,scope.followers=+scope.followers+1,api.get("rapiv1/profile/follow/"+scope.userid+"/"+scope.usertofollow).then(function(){_bnbAnalytics.registerFollow($rootScope.userDetails.ID,$rootScope.userDetails.email,"Registration_Flow",scope.userid)}))}}}}]),angular.module("changePassword",[]).controller("ForgotPasswordController",["$scope","api",function($scope,api){$scope.show=!0,$scope.recoverPassword=function(){$scope.forgotForm.$valid?api.post("async/forgotPassword/1",{email:$scope.email}).then(function(response){$scope.message="",0==response.userExists?$scope.message="User does not exist":0!=response.hashGenerated&&(0==response.hashSaved||0==response.emailSent?$scope.message="Server seems busy, please try after some time":1==response.emailSent&&($scope.show=!1))}):$scope.message="Please enter your Email!"}}]).controller("ResetPasswordController",["$scope","api","requestContext","$timeout","$window",function($scope,api,requestContext,$timeout,$window){var renderContext=requestContext.getRenderContext("reset");$scope.resetHash=requestContext.getParam("resetHash"),$scope.subview=renderContext.getNextSection(),$scope.resetPassword=function(){$scope.newPasswords.password1===$scope.newPasswords.password2?api.post("async/forgotPassword/2/"+$scope.resetHash,{newPassword:$scope.newPasswords.password1,newPasswordConfirm:$scope.newPasswords.password2}).then(function(response){1==response.newPasswordSet?($scope.message="Your new password has been set!",console.log($scope.message),$timeout(function(){$window.location.href="login"},5e3)):$scope.message="Sorry, some problem occurred, please try after some time!"}):($scope.message="Passwords must match, please try again!",console.log($scope.message))}}]),angular.module("router.renderRequest",[]).value("RenderContext",function(requestContext,actionPrefix,paramNames){function getNextSection(){return requestContext.getNextSection(actionPrefix)}function isChangeLocal(){return requestContext.startsWith(actionPrefix)}function isChangeRelevant(){return requestContext.startsWith(actionPrefix)?requestContext.hasActionChanged()?!0:paramNames.length&&requestContext.haveParamsChanged(paramNames):!1}return{getNextSection:getNextSection,isChangeLocal:isChangeLocal,isChangeRelevant:isChangeRelevant}}).service("requestContext",function(RenderContext){function getNextSection(prefix){if(!startsWith(prefix))return null;if(""===prefix)return sections[0];var depth=prefix.split(".").length;return depth===sections.length?null:sections[depth]}function getParam(name,defaultValue){return angular.isUndefined(defaultValue)&&(defaultValue=null),params[name]||defaultValue}function getParamAsInt(name,defaultValue){var valueAsInt=1*this.getParam(name,defaultValue||0);return isNaN(valueAsInt)?defaultValue||0:valueAsInt}function getRenderContext(requestActionLocation,paramNames){return requestActionLocation=requestActionLocation||"",paramNames=paramNames||[],angular.isArray(paramNames)||(paramNames=[paramNames]),new RenderContext(this,requestActionLocation,paramNames)}function hasActionChanged(){return action!==previousAction}function hasParamChanged(paramName,paramValue){return angular.isUndefined(paramValue)?!previousParams.hasOwnProperty(paramName)&&params.hasOwnProperty(paramName)?!0:previousParams.hasOwnProperty(paramName)&&!params.hasOwnProperty(paramName)?!0:previousParams[paramName]!==params[paramName]:!isParam(paramName,paramValue)}function haveParamsChanged(paramNames){for(var i=0,length=paramNames.length;length>i;i++)if(hasParamChanged(paramNames[i]))return!0;return!1}function isParam(paramName,paramValue){return params.hasOwnProperty(paramName)&&params[paramName]==paramValue?!0:!1}function setContext(newAction,newRouteParams){previousAction=action,previousParams=params,action=newAction,sections=action.split("."),params=angular.copy(newRouteParams)}function startsWith(prefix){return prefix.length&&action!==prefix&&0!==action.indexOf(prefix+".")?!1:!0}var action="",sections=[],params={},previousAction="",previousParams={};return{getNextSection:getNextSection,getParam:getParam,getParamAsInt:getParamAsInt,getRenderContext:getRenderContext,hasActionChanged:hasActionChanged,hasParamChanged:hasParamChanged,haveParamsChanged:haveParamsChanged,isParam:isParam,setContext:setContext,startsWith:startsWith}}),angular.module("router.routesConfig",[]).config(function($routeProvider,$locationProvider){$routeProvider.when("",{action:"home.default"}).when("/",{action:"home.default"}).when("/#_=_",{action:"home.default"}).when("/home",{action:"home.default"}).when("/users",{action:"users.default"}).when("/trends/:cityName",{action:"trends.default"}).when("/dealofday",{action:"dealofday.default"}).when("/allStores",{action:"allStores.default"}).when("/allStores/:categoryName/:categoryID",{action:"allStores.default"}).when("/product/:productName/:productID",{action:"product.default"}).when("/store/:storeName/:storeID",{action:"store.default"}).when("/store/:storeName/:storeSectionName/:storeID/:storeSectionID",{action:"store.default"}).when("/storeDisabled/:storeID",{action:"storeDisabled.default"}).when("/storeDisabled/:storeID/:storeSectionID",{action:"storeDisabled.default"}).when("/Furniture/:categoryID",{action:"categories.default"}).when("/Furniture/:categoryName*/:categoryID",{action:"categories.default"}).when("/Decor-Furnishing/:categoryID",{action:"categories.default"}).when("/Decor-Furnishing/:categoryName*/:categoryID",{action:"categories.default"}).when("/Dining/:categoryID",{action:"categories.default"}).when("/Dining/:categoryName*/:categoryID",{action:"categories.default"}).when("/Lighting/:categoryID",{action:"categories.default"}).when("/Lighting/:categoryName*/:categoryID",{action:"categories.default"}).when("/Fashion/:categoryID",{action:"categories.default"}).when("/Fashion/:categoryName*/:categoryID",{action:"categories.default"}).when("/Gifts-Collectibles/:categoryID",{action:"categories.default"}).when("/Gifts-Collectibles/:categoryName*/:categoryID",{action:"categories.default"}).when("/Art/:categoryID",{action:"categories.default"}).when("/Art/:categoryName*/:categoryID",{action:"categories.default"}).when("/inviteFriends",{action:"inviteFriends.default"}).when("/inviteStatus",{action:"inviteStatus.default"}).when("/login",{action:"login.default"}).when("/register",{action:"register.default"}).when("/404",{action:"404.default"}).when("/contact",{action:"contact.default"}).when("/forSellers",{action:"forSellers.default"}).when("/aboutUs",{action:"aboutUs.default"}).when("/policies",{action:"policies.default"}).when("/search/products/:searchKey",{action:"search.products"}).when("/search/stores/:searchKey",{action:"search.stores"}).when("/search/people/:searchKey",{action:"search.people"}).when("/cart",{action:"cart.default"}).when("/checkout",{action:"checkout.default"}).when("/profile/fancy/:userID",{action:"profileHeader.fancy"}).when("/profile/allBrags/:userID",{action:"profileHeader.allBrags"}).when("/profile/mutualproducts/:userID",{action:"profileHeader.mutualproducts"}).when("/profile/fancy/:userID/list/:listID",{action:"profileHeader.list"}).when("/profile/badges/:userID",{action:"profileHeader.badges"}).when("/profile/social/:userID",{action:"profileHeader.social"}).when("/profile/about/:userID",{action:"profileHeader.about"}).when("/profile/settings/:userID",{action:"profileHeader.settings"}).when("/profile/purchaseHistory",{action:"profileHeader.purchaseHistory"}).when("/reset/:resetHash",{action:"reset.default"}).otherwise({redirectTo:"/home"}),$locationProvider.html5Mode(!0).hashPrefix("!")}),angular.module("router",["router.renderRequest","router.routesConfig"]),angular.module("bnbApp",["angular-loading-bar","ngCookies","ngRoute","ngTouch","ngAnimate","ngSanitize","router","gallery","home","blocked","trends","allStores","dealofday","people","profilePage","productPage","cartPage","checkoutPage","categoryPage","storePage","search","userSession","siteMessage","userCoupons","changePassword","filters.beautify","filters.compress","services.api","services.user","services.seo","directives.stabiliseHover","directives.clearImage","directives.checkLoad","directives.scrollTo","directives.follow","directives.sexyOverlay","directives.share","dynamicModals","realtime.badges","prefetchTemplates","angulartics","angulartics.google.analytics"]).run(["$rootScope","$window",function($rootScope){!function(){var ENV="buynbrag"===document.location.host.split(".")[0]?"PRODUCTION":"DEVELOPMENT";"PRODUCTION"===ENV?(window.console&&window.console.log&&window.console.info&&(window.console.log=function(){},window.console.info=function(){}),$rootScope.relativeServerPath="/"):$rootScope.relativeServerPath="/application/views/app/"}(),Array.prototype.findObject=function(key,id){var obj=this.filter(function(item){return item[key]==id})[0];return obj},Array.prototype.indexOfObject=function(key,id){return this.indexOf(this.findObject(key,id))},Array.prototype.deleteObject=function(key,id){this.splice(this.indexOfObject(key,id),1)},Array.prototype.range=function(a,b,step){step=step?step:1,b/=step;for(var i=a;b>=i;i++)this.push(i*step);return this},$rootScope.deviceType="ontouchstart"in document.documentElement?"touch":"nonTouch",$rootScope.openModal=function(id,obj){id&&(angular.element("#"+id).modal("show"),obj&&"[object Object]"===obj.toString()&&Object.keys(obj).length>0&&$rootScope.$broadcast(id,obj))},$rootScope.closeModal=function(id){angular.element("#"+id).modal("hide")}}]).config(["$provide","cfpLoadingBarProvider",function($provide,cfpLoadingBarProvider){cfpLoadingBarProvider.includeSpinner=!1}]).controller("AppController",["$scope","$window","$rootScope","$route","$routeParams","$location","$window","api","requestContext","categoryService","trendsService","seo","$sce",function($scope,$window,$rootScope,$route,$routeParams,$location,$window,api,requestContext,categoryService,trendsService,seo,$sce){function isRouteRedirect(route){return!route.current.action}var renderContext=requestContext.getRenderContext();$scope.subview=renderContext.getNextSection(),$scope.$on("requestContextChanged",function(){renderContext.isChangeRelevant()&&($scope.subview=renderContext.getNextSection())}),$scope.$on("$routeChangeSuccess",function(){isRouteRedirect($route)||($scope.dynamicSeoContent={},requestContext.setContext($route.current.action,$routeParams),$scope.$broadcast("requestContextChanged",requestContext))});var protocol=$location.protocol();$rootScope.baseUrl=protocol+"://"+$location.host()+"/",$rootScope.s3baseUrl=protocol+"://ir0.mobify.com/jpg50/http://buynbragstores.s3.amazonaws.com/assets/images/stores/",$scope.defaultSeoContent=seo,$scope.dynamicSeoContent={},$scope.bodyClass="landingActive",function(){var containerWidth,columns,MIN_IMG_WIDTH=323,MARGIN=25;document.body.style.overflow="scroll",containerWidth=document.body.getBoundingClientRect().width,document.body.style.overflow="auto",columns=Math.floor(containerWidth/(MIN_IMG_WIDTH+MARGIN)),$scope.imageCount="touch"==$rootScope.deviceType?2>columns?10:16:Math.floor(window.innerHeight/300*2.5*columns)}(),$scope.$on("userLoggedIn",function(){$scope.defaultView="/application/views/app/src/app/pages/home/home.html",$scope.bodyClass=""}),$scope.$on("notLoggedIn",function(){$scope.defaultView="/application/views/app/src/app/pages/blocked/blocked.html"}),categoryService.getCategories("roots").then(function(data){$scope.categories=data}),api.get("rapiv1/dod/dods",!0).then(function(data){data&&data.data&&data.data.dods&&($scope.deal=data.data.dods[0],$scope.$broadcast("DEALDATAREADY"))}),$scope.cities=trendsService.names,$scope.trustSrc=function(src){return $sce.trustAsResourceUrl(src)},$scope.userImg=function(obj){return obj&&"undefined"!=typeof obj.id&&"undefined"!=typeof obj.gender?obj.id&&!isNaN(obj.id)?"https://graph.facebook.com/"+obj.id+"/picture?width="+obj.dimension+"&height="+obj.dimension:"curator"===obj.gender?"/assets/images/sapna_pic.jpg":"female"===obj.gender?"/assets/images/default/female.png":"/assets/images/default/male.png":void 0},$scope.logout=function(){api.post("async/logout",{}).then(function(){$rootScope.user={userid:null,userdata:{}},window.location.href="/"})}}]);var fbRegistrationWindow,fbLoginWindow;