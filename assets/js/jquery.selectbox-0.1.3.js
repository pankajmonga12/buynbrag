/*
 * jQuery Selectbox plugin 0.1.3
 *
 * Copyright 2011, Dimitar Ivanov (http://www.bulgaria-web-developers.com/projects/javascript/selectbox/)
 * Licensed under the MIT (http://www.opensource.org/licenses/mit-license.php) license.
 * 
 * Date: Wed Jul 29 23:20:57 2011 +0200
 */
(function(d,f){var e="selectbox",c=false,b=true;function a(){this._state=[];this._defaults={classHolder:"sbHolder",classHolderDisabled:"sbHolderDisabled",classSelector:"sbSelector",classOptions:"sbOptions",classGroup:"sbGroup",classSub:"sbSub",classDisabled:"sbDisabled",classToggleOpen:"sbToggleOpen",classToggle:"sbToggle",speed:200,effect:"slide",onChange:null,onOpen:null,onClose:null}}d.extend(a.prototype,{_isOpenSelectbox:function(h){if(!h){return c}var g=this._getInst(h);return g.isOpen},_isDisabledSelectbox:function(h){if(!h){return c}var g=this._getInst(h);return g.isDisabled},_attachSelectbox:function(o,k){if(this._getInst(o)){return c}var j=d(o),u=this,m=u._newInst(j),l,r,i,p,v=c,t=j.find("optgroup"),h=j.find("option"),n=h.length;j.attr("sb",m.uid);d.extend(m.settings,u._defaults,k);u._state[m.uid]=c;j.hide();function g(){var w,s=this.attr("id").split("_")[1];for(w in u._state){if(w!==s){if(u._state.hasOwnProperty(w)){if(d(":input[sb='"+w+"']")[0]){u._closeSelectbox(d(":input[sb='"+w+"']")[0])}}}}}l=d("<div>",{id:"sbHolder_"+m.uid,"class":m.settings.classHolder});r=d("<a>",{id:"sbSelector_"+m.uid,href:"#","class":m.settings.classSelector,click:function(w){w.preventDefault();g.apply(d(this),[]);var s=d(this).attr("id").split("_")[1];if(u._state[s]){u._closeSelectbox(o)}else{u._openSelectbox(o)}}});i=d("<a>",{id:"sbToggle_"+m.uid,href:"#","class":m.settings.classToggle,click:function(w){w.preventDefault();g.apply(d(this),[]);var s=d(this).attr("id").split("_")[1];if(u._state[s]){u._closeSelectbox(o)}else{u._openSelectbox(o)}}});i.appendTo(l);p=d("<ul>",{id:"sbOptions_"+m.uid,"class":m.settings.classOptions,css:{display:"none"}});j.children().each(function(x){var y=d(this),s,w={};if(y.is("option")){q(y)}else{if(y.is("optgroup")){s=d("<li>");d("<span>",{text:y.attr("label")}).addClass(m.settings.classGroup).appendTo(s);s.appendTo(p);if(y.is(":disabled")){w.disabled=true}w.sub=true;q(y.find("option"),w)}}});function q(){var w=arguments[1]&&arguments[1].sub?true:false,s=arguments[1]&&arguments[1].disabled?true:false;arguments[0].each(function(y){var z=d(this),x=d("<li>"),A;if(z.is(":selected")){r.text(z.text());v=b}if(y===n-1){x.addClass("last")}if(!z.is(":disabled")&&!s){A=d("<a>",{href:"#"+z.val(),rel:z.val(),text:z.text(),click:function(D){D.preventDefault();var C=i,B=C.attr("id").split("_")[1];u._changeSelectbox(o,d(this).attr("rel"),d(this).text());u._closeSelectbox(o)}});if(w){A.addClass(m.settings.classSub)}A.appendTo(x)}else{A=d("<span>",{text:z.text()}).addClass(m.settings.classDisabled);if(w){A.addClass(m.settings.classSub)}A.appendTo(x)}x.appendTo(p)})}if(!v){r.text(h.first().text())}d.data(o,e,m);r.appendTo(l);p.appendTo(l);l.insertAfter(j)},_detachSelectbox:function(h){var g=this._getInst(h);if(!g){return c}d("#sbHolder_"+g.uid).remove();d.data(h,e,null);d(h).show()},_changeSelectbox:function(j,i,k){var h=this._getInst(j),g=this._get(h,"onChange");d("#sbSelector_"+h.uid).text(k);d(j).find("option[value='"+i+"']").attr("selected",b);if(g){g.apply((h.input?h.input[0]:null),[i,h])}else{if(h.input){h.input.trigger("change")}}},_enableSelectbox:function(h){var g=this._getInst(h);if(!g||!g.isDisabled){return c}d("#sbHolder_"+g.uid).removeClass(g.settings.classHolderDisabled);g.isDisabled=c;d.data(h,e,g)},_disableSelectbox:function(h){var g=this._getInst(h);if(!g||g.isDisabled){return c}d("#sbHolder_"+g.uid).addClass(g.settings.classHolderDisabled);g.isDisabled=b;d.data(h,e,g)},_optionSelectbox:function(j,g,i){var h=this._getInst(j);if(!h){return c}h[g]=i;d.data(j,e,h)},_openSelectbox:function(m){var k=this._getInst(m);if(!k||k.isOpen||k.isDisabled){return}var h=d("#sbOptions_"+k.uid),l=parseInt(d(window).height(),10),j=d("#sbHolder_"+k.uid).offset(),g=d(window).scrollTop(),o=h.prev().height(),n=l-(j.top-g)-o/2,i=this._get(k,"onOpen");h.css({top:o+"px",maxHeight:(n-o)+"px"});k.settings.effect==="fade"?h.fadeIn(k.settings.speed):h.slideDown(k.settings.speed);d("#sbToggle_"+k.uid).addClass(k.settings.classToggleOpen);this._state[k.uid]=b;k.isOpen=b;if(i){i.apply((k.input?k.input[0]:null),[k])}d.data(m,e,k)},_closeSelectbox:function(i){var h=this._getInst(i);if(!h||!h.isOpen){return}var g=this._get(h,"onClose");h.settings.effect==="fade"?d("#sbOptions_"+h.uid).fadeOut(h.settings.speed):d("#sbOptions_"+h.uid).slideUp(h.settings.speed);d("#sbToggle_"+h.uid).removeClass(h.settings.classToggleOpen);this._state[h.uid]=c;h.isOpen=c;if(g){g.apply((h.input?h.input[0]:null),[h])}d.data(i,e,h)},_newInst:function(g){var h=g[0].id.replace(/([^A-Za-z0-9_-])/g,"\\\\$1");return{id:h,input:g,uid:Math.floor(Math.random()*99999999),isOpen:c,isDisabled:c,settings:{}}},_getInst:function(h){try{return d.data(h,e)}catch(g){throw"Missing instance data for this selectbox"}},_get:function(h,g){return h.settings[g]!==f?h.settings[g]:this._defaults[g]}});d.fn.selectbox=function(h){var g=Array.prototype.slice.call(arguments,1);if(typeof h=="string"&&h=="isDisabled"){return d.selectbox["_"+h+"Selectbox"].apply(d.selectbox,[this[0]].concat(g))}if(h=="option"&&arguments.length==2&&typeof arguments[1]=="string"){return d.selectbox["_"+h+"Selectbox"].apply(d.selectbox,[this[0]].concat(g))}return this.each(function(){typeof h=="string"?d.selectbox["_"+h+"Selectbox"].apply(d.selectbox,[this].concat(g)):d.selectbox._attachSelectbox(this,h)})};d.selectbox=new a();d.selectbox.version="0.1.3"})(jQuery);