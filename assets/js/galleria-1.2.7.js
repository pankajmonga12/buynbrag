(function(h){var d,p=this,G=p.document,o=h(G),B=h(p),k=Array.prototype,D=1.27,f=true,b=30000,x=false,u=navigator.userAgent.toLowerCase(),r=p.location.hash.replace(/#\//,""),w=function(){},C=function(){return false},q=(function(){var F=3,I=G.createElement("div"),H=I.getElementsByTagName("i");do{I.innerHTML="<!--[if gt IE "+(++F)+"]><i></i><![endif]-->"}while(H[0]);return F>4?F:d}()),E=function(){return{html:G.documentElement,body:G.body,head:G.getElementsByTagName("head")[0],title:G.title}},i="data ready thumbnail loadstart loadfinish image play pause progress fullscreen_enter fullscreen_exit idle_enter idle_exit rescale lightbox_open lightbox_close lightbox_image",v=(function(){var F=[];h.each(i.split(" "),function(H,I){F.push(I);if(/_/.test(I)){F.push(I.replace(/_/g,""))}});return F}()),A=function(F){var H;if(typeof F!=="object"){return F}h.each(F,function(I,J){if(/^[a-z]+_/.test(I)){H="";h.each(I.split("_"),function(L,K){H+=L>0?K.substr(0,1).toUpperCase()+K.substr(1):K});F[H]=J;delete F[I]}});return F},c=function(F){if(h.inArray(F,v)>-1){return Galleria[F.toUpperCase()]}return F},n={youtube:{reg:/https?:\/\/(?:[a-zA_Z]{2,3}.)?(?:youtube\.com\/watch\?)((?:[\w\d\-\_\=]+&amp;(?:amp;)?)*v(?:&lt;[A-Z]+&gt;)?=([0-9a-zA-Z\-\_]+))/i,embed:function(F){return"http://www.youtube.com/embed/"+F},getThumb:function(I,H,F){F=F||w;h.getJSON("http://gdata.youtube.com/feeds/api/videos/"+I+"?v=2&alt=json-in-script&callback=?",function(J){try{H(J.entry.media$group.media$thumbnail[0].url)}catch(K){F()}}).error(F)}},vimeo:{reg:/https?:\/\/(?:www\.)?(vimeo\.com)\/(?:hd#)?([0-9]+)/i,embed:function(F){return"http://player.vimeo.com/video/"+F},getThumb:function(I,H,F){F=F||w;h.getJSON("http://vimeo.com/api/v2/video/"+I+".json?callback=?",function(J){try{H(J[0].thumbnail_medium)}catch(K){F()}}).error(F)}},dailymotion:{reg:/https?:\/\/(?:www\.)?(dailymotion\.com)\/video\/([^_]+)/,embed:function(F){return"http://www.dailymotion.com/embed/video/"+F},getThumb:function(I,H,F){F=F||w;h.getJSON("https://api.dailymotion.com/video/"+I+"?fields=thumbnail_medium_url&callback=?",function(J){try{H(J.thumbnail_medium_url)}catch(K){F()}}).error(F)}}},a=function(I){var H;for(var F in n){H=I&&I.match(n[F].reg);if(H&&H.length){return{id:H[2],provider:F}}}return false},j={trunk:{},add:function(K,J,I,H){K=K||new Date().getTime();H=H||false;this.clear(K);if(H){var F=J;J=function(){F();j.add(K,J,I)}}this.trunk[K]=p.setTimeout(J,I)},clear:function(I){var F=function(J){p.clearTimeout(this.trunk[J]);delete this.trunk[J]},H;if(!!I&&I in this.trunk){F.call(j,I)}else{if(typeof I==="undefined"){for(H in this.trunk){if(this.trunk.hasOwnProperty(H)){F.call(j,H)}}}}}},s=[],z=[],t=false,y=false,g=[],m=function(F){Galleria.theme=F;h.each(g,function(I,H){if(!H._initialized){H._init.call(H)}})},e=(function(){return{array:function(F){return k.slice.call(F,0)},create:function(F,I){I=I||"div";var H=G.createElement(I);H.className=F;return H},getScriptPath:function(H){H=H||h("script:last").attr("src");var F=H.split("/");if(F.length==1){return""}F.pop();return F.join("/")+"/"},animate:(function(){var N=(function(U){var T="transition WebkitTransition MozTransition OTransition".split(" "),S;if(p.opera){return false}for(S=0;T[S];S++){if(typeof U[T[S]]!=="undefined"){return T[S]}}return false}((G.body||G.documentElement).style));var R={MozTransition:"transitionend",OTransition:"oTransitionEnd",WebkitTransition:"webkitTransitionEnd",transition:"transitionend"}[N];var I={_default:[0.25,0.1,0.25,1],galleria:[0.645,0.045,0.355,1],galleriaIn:[0.55,0.085,0.68,0.53],galleriaOut:[0.25,0.46,0.45,0.94],ease:[0.25,0,0.25,1],linear:[0.25,0.25,0.75,0.75],"ease-in":[0.42,0,1,1],"ease-out":[0,0,0.58,1],"ease-in-out":[0.42,0,0.58,1]};var K=function(T,U,V){var S={};V=V||"transition";h.each("webkit moz ms o".split(" "),function(){S["-"+this+"-"+V]=U});T.css(S)};var O=function(S){K(S,"none","transition");if(Galleria.WEBKIT&&Galleria.TOUCH){K(S,"translate3d(0,0,0)","transform");if(S.data("revert")){S.css(S.data("revert"));S.data("revert",null)}}};var P,Q,M,H,L,F,J;return function(T,U,S){S=h.extend({duration:400,complete:w,stop:false},S);T=h(T);if(!S.duration){T.css(U);S.complete.call(T[0]);return}if(!N){T.animate(U,S);return}if(S.stop){T.unbind(R);O(T)}P=false;h.each(U,function(V,W){J=T.css(V);if(e.parseValue(J)!=e.parseValue(W)){P=true}T.css(V,J)});if(!P){p.setTimeout(function(){S.complete.call(T[0])},S.duration);return}Q=[];M=S.easing in I?I[S.easing]:I._default;H=" "+S.duration+"ms cubic-bezier("+M.join(",")+")";p.setTimeout((function(W,Y,X,V){return function(){W.one(Y,(function(Z){return function(){O(Z);S.complete.call(Z[0])}}(W)));if(Galleria.WEBKIT&&Galleria.TOUCH){L={};F=[0,0,0];h.each(["left","top"],function(aa,Z){if(Z in X){F[aa]=(e.parseValue(X[Z])-e.parseValue(W.css(Z)))+"px";L[Z]=X[Z];delete X[Z]}});if(F[0]||F[1]){W.data("revert",L);Q.push("-webkit-transform"+V);K(W,"translate3d("+F.join(",")+")","transform")}}h.each(X,function(Z,aa){Q.push(Z+V)});K(W,Q.join(","));W.css(X)}}(T,R,U,H)),2)}}()),removeAlpha:function(J){if(q<9&&J){var I=J.style,F=J.currentStyle,H=F&&F.filter||I.filter||"";if(/alpha/.test(H)){I.filter=H.replace(/alpha\([^)]*\)/i,"")}}},forceStyles:function(H,F){H=h(H);if(H.attr("style")){H.data("styles",H.attr("style")).removeAttr("style")}H.css(F)},revertStyles:function(){h.each(e.array(arguments),function(F,H){H=h(H);H.removeAttr("style");H.attr("style","");if(H.data("styles")){H.attr("style",H.data("styles")).data("styles",null)}})},moveOut:function(F){e.forceStyles(F,{position:"absolute",left:-10000})},moveIn:function(){e.revertStyles.apply(e,e.array(arguments))},elem:function(F){if(F instanceof h){return{$:F,dom:F[0]}}else{return{$:h(F),dom:F}}},hide:function(K,L,M){M=M||w;var J=e.elem(K),H=J.$;K=J.dom;if(!H.data("opacity")){H.data("opacity",H.css("opacity"))}var I={opacity:0};if(L){var F=q<9&&K?function(){e.removeAlpha(K);K.style.visibility="hidden";M.call(K)}:M;e.animate(K,I,{duration:L,complete:F,stop:true})}else{if(q<9&&K){e.removeAlpha(K);K.style.visibility="hidden"}else{H.css(I)}}},show:function(L,M,N){N=N||w;var J=e.elem(L),H=J.$;L=J.dom;var K=parseFloat(H.data("opacity"))||1,I={opacity:K};if(M){if(q<9){H.css("opacity",0);L.style.visibility="visible"}var F=q<9&&L?function(){if(I.opacity==1){e.removeAlpha(L)}N.call(L)}:N;e.animate(L,I,{duration:M,complete:F,stop:true})}else{if(q<9&&I.opacity==1&&L){e.removeAlpha(L);L.style.visibility="visible"}else{H.css(I)}}},optimizeTouch:(function(){var M,K,I,N,H={},L=function(O){O.preventDefault();H=h.extend({},O,true)},J=function(){this.evt=H},F=function(){this.handler.call(M,this.evt)};return function(O){h(O).bind("touchend",function(P){M=P.target;N=true;while(M.parentNode&&M!=P.currentTarget&&N){K=h(M).data("events");I=h(M).data("fakes");if(K&&"click" in K){N=false;P.preventDefault();h(M).click(L).click();K.click.pop();h.each(K.click,J);h(M).data("fakes",K.click);delete K.click}else{if(I){N=false;P.preventDefault();h.each(I,F)}}M=M.parentNode}})}}()),addTimer:function(){j.add.apply(j,e.array(arguments));return this},clearTimer:function(){j.clear.apply(j,e.array(arguments));return this},wait:function(I){I=h.extend({until:C,success:w,error:function(){Galleria.raise("Could not complete wait function.")},timeout:3000},I);var K=e.timestamp(),F,H,J=function(){H=e.timestamp();F=H-K;if(I.until(F)){I.success();return false}if(typeof I.timeout=="number"&&H>=K+I.timeout){I.error();return false}p.setTimeout(J,10)};p.setTimeout(J,10)},toggleQuality:function(F,H){if((q!==7&&q!==8)||!F||F.nodeName.toUpperCase()!="IMG"){return}if(typeof H==="undefined"){H=F.style.msInterpolationMode==="nearest-neighbor"}F.style.msInterpolationMode=H?"bicubic":"nearest-neighbor"},insertStyleTag:function(I){var H=G.createElement("style");E().head.appendChild(H);if(H.styleSheet){H.styleSheet.cssText=I}else{var F=G.createTextNode(I);H.appendChild(F)}},loadScript:function(I,J){var F=false,H=h("<script>").attr({src:I,async:true}).get(0);H.onload=H.onreadystatechange=function(){if(!F&&(!this.readyState||this.readyState==="loaded"||this.readyState==="complete")){F=true;H.onload=H.onreadystatechange=null;if(typeof J==="function"){J.call(this,this)}}};E().head.appendChild(H)},parseValue:function(H){if(typeof H==="number"){return H}else{if(typeof H==="string"){var F=H.match(/\-?\d|\./g);return F&&F.constructor===Array?F.join("")*1:0}else{return 0}}},timestamp:function(){return new Date().getTime()},loadCSS:function(F,M,L){var J,H=false,I,K=function(){var N=new Image();N.onload=N.onerror=function(O){N=null;H=true};N.src=F};h("link[rel=stylesheet]").each(function(){if(new RegExp(F).test(this.href)){J=this;return false}});if(typeof M==="function"){L=M;M=d}L=L||w;if(J){L.call(J,J);return J}I=G.styleSheets.length;if(h("#"+M).length){h("#"+M).attr("href",F);I--;H=true}else{J=h("<link>").attr({rel:"stylesheet",href:F,id:M}).get(0);p.setTimeout(function(){var N=h('link[rel="stylesheet"], style');if(N.length){N.get(0).parentNode.insertBefore(J,N[0])}else{E().head.appendChild(J)}if(q){if(I>=31){Galleria.raise("You have reached the browser stylesheet limit (31)",true);return}J.onreadystatechange=function(Q){if(!H&&(!this.readyState||this.readyState==="loaded"||this.readyState==="complete")){H=true}}}else{var P=G.createElement("a"),O=p.location;P.href=F;if(!(/file/.test(O.protocol))&&O.hostname==P.hostname&&O.port==P.port&&O.protocol==P.protocol){h.ajax({url:F,success:function(){H=true},error:K})}else{K()}}},10)}if(typeof L==="function"){e.wait({until:function(){return H&&G.styleSheets.length>I},success:function(){p.setTimeout(function(){L.call(J,J)},100)},error:function(){Galleria.raise("Theme CSS could not load",true)},timeout:10000})}return J}}}()),l=(function(){var F=function(K,I,J,H){var O=this.getOptions("easing"),N=this.getStageWidth(),M={left:N*(K.rewind?-1:1)},L={left:0};if(J){M.opacity=0;L.opacity=1}else{M.opacity=1}h(K.next).css(M);e.animate(K.next,L,{duration:K.speed,complete:(function(P){return function(){I();P.css({left:0})}}(h(K.next).add(K.prev))),queue:false,easing:O});if(H){K.rewind=!K.rewind}if(K.prev){M={left:0};L={left:N*(K.rewind?1:-1)};if(J){M.opacity=1;L.opacity=0}h(K.prev).css(M);e.animate(K.prev,L,{duration:K.speed,queue:false,easing:O,complete:function(){h(this).css("opacity",0)}})}};return{fade:function(I,H){h(I.next).css({opacity:0,left:0}).show();e.animate(I.next,{opacity:1},{duration:I.speed,complete:H});if(I.prev){h(I.prev).css("opacity",1).show();e.animate(I.prev,{opacity:0},{duration:I.speed})}},flash:function(I,H){h(I.next).css({opacity:0,left:0});if(I.prev){e.animate(I.prev,{opacity:0},{duration:I.speed/2,complete:function(){e.animate(I.next,{opacity:1},{duration:I.speed,complete:H})}})}else{e.animate(I.next,{opacity:1},{duration:I.speed,complete:H})}},pulse:function(I,H){if(I.prev){h(I.prev).hide()}h(I.next).css({opacity:0,left:0}).show();e.animate(I.next,{opacity:1},{duration:I.speed,complete:H})},slide:function(I,H){F.apply(this,e.array(arguments))},fadeslide:function(I,H){F.apply(this,e.array(arguments).concat([true]))},doorslide:function(I,H){F.apply(this,e.array(arguments).concat([false,true]))}}}());Galleria=function(){var O=this;this._options={};this._playing=false;this._playtime=5000;this._active=null;this._queue={length:0};this._data=[];this._dom={};this._thumbnails=[];this._layers=[];this._initialized=false;this._firstrun=false;this._stageWidth=0;this._stageHeight=0;this._target=d;this._id=parseInt(Math.random()*10000,10);var K="container stage images image-nav image-nav-left image-nav-right info info-text info-title info-description thumbnails thumbnails-list thumbnails-container thumb-nav-left thumb-nav-right loader counter tooltip",J="current total";h.each(K.split(" "),function(Q,R){O._dom[R]=e.create("galleria-"+R)});h.each(J.split(" "),function(Q,R){O._dom[R]=e.create("galleria-"+R,"span")});var I=this._keyboard={keys:{UP:38,DOWN:40,LEFT:37,RIGHT:39,RETURN:13,ESCAPE:27,BACKSPACE:8,SPACE:32},map:{},bound:false,press:function(R){var Q=R.keyCode||R.which;if(Q in I.map&&typeof I.map[Q]==="function"){I.map[Q].call(O,R)}},attach:function(S){var R,Q;for(R in S){if(S.hasOwnProperty(R)){Q=R.toUpperCase();if(Q in I.keys){I.map[I.keys[Q]]=S[R]}else{I.map[Q]=S[R]}}}if(!I.bound){I.bound=true;o.bind("keydown",I.press)}},detach:function(){I.bound=false;I.map={};o.unbind("keydown",I.press)}};var M=this._controls={0:d,1:d,active:0,swap:function(){M.active=M.active?0:1},getActive:function(){return M[M.active]},getNext:function(){return M[1-M.active]}};var N=this._carousel={next:O.$("thumb-nav-right"),prev:O.$("thumb-nav-left"),width:0,current:0,max:0,hooks:[],update:function(){var R=0,S=0,Q=[0];h.each(O._thumbnails,function(U,T){if(T.ready){R+=T.outerWidth||h(T.container).outerWidth(true);Q[U+1]=R;S=Math.max(S,T.outerHeight||h(T.container).outerHeight(true))}});O.$("thumbnails").css({width:R,height:S});N.max=R;N.hooks=Q;N.width=O.$("thumbnails-list").width();N.setClasses();O.$("thumbnails-container").toggleClass("galleria-carousel",R>N.width);N.width=O.$("thumbnails-list").width()},bindControls:function(){var Q;N.next.bind("click",function(R){R.preventDefault();if(O._options.carouselSteps==="auto"){for(Q=N.current;Q<N.hooks.length;Q++){if(N.hooks[Q]-N.hooks[N.current]>N.width){N.set(Q-2);break}}}else{N.set(N.current+O._options.carouselSteps)}});N.prev.bind("click",function(R){R.preventDefault();if(O._options.carouselSteps==="auto"){for(Q=N.current;Q>=0;Q--){if(N.hooks[N.current]-N.hooks[Q]>N.width){N.set(Q+2);break}else{if(Q===0){N.set(0);break}}}}else{N.set(N.current-O._options.carouselSteps)}})},set:function(Q){Q=Math.max(Q,0);while(N.hooks[Q-1]+N.width>=N.max&&Q>=0){Q--}N.current=Q;N.animate()},getLast:function(Q){return(Q||N.current)-1},follow:function(Q){if(Q===0||Q===N.hooks.length-2){N.set(Q);return}var R=N.current;while(N.hooks[R]-N.hooks[N.current]<N.width&&R<=N.hooks.length){R++}if(Q-1<N.current){N.set(Q-1)}else{if(Q+2>R){N.set(Q-R+N.current+2)}}},setClasses:function(){N.prev.toggleClass("disabled",!N.current);N.next.toggleClass("disabled",N.hooks[N.current]+N.width>=N.max)},animate:function(R){N.setClasses();var Q=N.hooks[N.current]*-1;if(isNaN(Q)){return}e.animate(O.get("thumbnails"),{left:Q},{duration:O._options.carouselSpeed,easing:O._options.easing,queue:false})}};var P=this._tooltip={initialized:false,open:false,timer:"tooltip"+O._id,swapTimer:"swap"+O._id,init:function(){P.initialized=true;var Q=".galleria-tooltip{padding:3px 8px;max-width:50%;background:#ffe;color:#000;z-index:3;position:absolute;font-size:11px;line-height:1.3opacity:0;box-shadow:0 0 2px rgba(0,0,0,.4);-moz-box-shadow:0 0 2px rgba(0,0,0,.4);-webkit-box-shadow:0 0 2px rgba(0,0,0,.4);}";e.insertStyleTag(Q);O.$("tooltip").css("opacity",0.8);e.hide(O.get("tooltip"))},move:function(X){var W=O.getMousePosition(X).x,V=O.getMousePosition(X).y,T=O.$("tooltip"),Z=W,Y=V,aa=T.outerHeight(true)+1,S=T.outerWidth(true),U=aa+15;var R=O.$("container").width()-S-2,Q=O.$("container").height()-aa-2;if(!isNaN(Z)&&!isNaN(Y)){Z+=10;Y-=30;Z=Math.max(0,Math.min(R,Z));Y=Math.max(0,Math.min(Q,Y));if(V<U){Y=U}T.css({left:Z,top:Y})}},bind:function(R,S){if(Galleria.TOUCH){return}if(!P.initialized){P.init()}var Q=function(T,U){P.define(T,U);h(T).hover(function(){e.clearTimer(P.swapTimer);O.$("container").unbind("mousemove",P.move).bind("mousemove",P.move).trigger("mousemove");P.show(T);e.addTimer(P.timer,function(){O.$("tooltip").stop().show().animate({opacity:1});P.open=true},P.open?0:500)},function(){O.$("container").unbind("mousemove",P.move);e.clearTimer(P.timer);O.$("tooltip").stop().animate({opacity:0},200,function(){O.$("tooltip").hide();e.addTimer(P.swapTimer,function(){P.open=false},1000)})}).click(function(){h(this).trigger("mouseout")})};if(typeof S==="string"){Q((R in O._dom?O.get(R):R),S)}else{h.each(R,function(T,U){Q(O.get(T),U)})}},show:function(Q){Q=h(Q in O._dom?O.get(Q):Q);var S=Q.data("tt"),R=function(T){p.setTimeout((function(U){return function(){P.move(U)}}(T)),10);Q.unbind("mouseup",R)};S=typeof S==="function"?S():S;if(!S){return}O.$("tooltip").html(S.replace(/\s/,"&nbsp;"));Q.bind("mouseup",R)},define:function(R,S){if(typeof S!=="function"){var Q=S;S=function(){return Q}}R=h(R in O._dom?O.get(R):R).data("tt",S);P.show(R)}};var L=this._fullscreen={scrolled:0,crop:d,transition:d,active:false,keymap:O._keyboard.map,os:{callback:w,support:(function(){var Q=E().html;return Q.requestFullscreen||Q.mozRequestFullScreen||Q.webkitRequestFullScreen}()),enter:function(R){L.os.callback=R||w;var Q=E().html;if(Q.requestFullscreen){Q.requestFullscreen()}else{if(Q.mozRequestFullScreen){Q.mozRequestFullScreen()}else{if(Q.webkitRequestFullScreen){Q.webkitRequestFullScreen()}}}},exit:function(Q){L.os.callback=Q||w;if(G.exitFullscreen){G.exitFullscreen()}else{if(G.mozCancelFullScreen){G.mozCancelFullScreen()}else{if(G.webkitCancelFullScreen){G.webkitCancelFullScreen()}}}},listen:function(){if(!L.os.support){return}var Q=function(){if(G.fullscreen||G.mozFullScreen||G.webkitIsFullScreen){L._enter(L.os.callback)}else{L._exit(L.os.callback)}};G.addEventListener("fullscreenchange",Q,false);G.addEventListener("mozfullscreenchange",Q,false);G.addEventListener("webkitfullscreenchange",Q,false)}},enter:function(Q){if(O._options.trueFullscreen&&L.os.support){L.os.enter(Q)}else{L._enter(Q)}},_enter:function(X){L.active=true;e.hide(O.getActiveImage());O.$("container").addClass("fullscreen");L.scrolled=B.scrollTop();e.forceStyles(O.get("container"),{position:"fixed",top:0,left:0,width:"100%",height:"100%",zIndex:10000});var U={height:"100%",overflow:"hidden",margin:0,padding:0},W=O.getData(),T=O._options;e.forceStyles(E().html,U);e.forceStyles(E().body,U);L.keymap=h.extend({},O._keyboard.map);O.attachKeyboard({escape:O.exitFullscreen,right:O.next,left:O.prev});L.crop=T.imageCrop;if(T.fullscreenCrop!=d){T.imageCrop=T.fullscreenCrop}if(W&&W.big&&W.image!==W.big){var Q=new Galleria.Picture(),V=Q.isCached(W.big),S=O.getIndex(),R=O._thumbnails[S];O.trigger({type:Galleria.LOADSTART,cached:V,rewind:false,index:S,imageTarget:O.getActiveImage(),thumbTarget:R,galleriaData:W});Q.load(W.big,function(Y){O._scaleImage(Y,{complete:function(Z){O.trigger({type:Galleria.LOADFINISH,cached:V,index:S,rewind:false,imageTarget:Z.image,thumbTarget:R});var aa=O._controls.getActive().image;if(aa){h(aa).width(Z.image.width).height(Z.image.height).attr("style",h(Z.image).attr("style")).attr("src",Z.image.src)}}})})}O.rescale(function(){e.addTimer(false,function(){e.show(O.getActiveImage());if(typeof X==="function"){X.call(O)}},100);O.trigger(Galleria.FULLSCREEN_ENTER)});B.resize(function(){L.scale()})},scale:function(){O.rescale()},exit:function(Q){if(O._options.trueFullscreen&&L.os.support){L.os.exit(Q)}else{L._exit(Q)}},_exit:function(S){L.active=false;e.hide(O.getActiveImage());O.$("container").removeClass("fullscreen");e.revertStyles(O.get("container"),E().html,E().body);p.scrollTo(0,L.scrolled);O.detachKeyboard();O.attachKeyboard(L.keymap);O._options.imageCrop=L.crop;var Q=O.getData().big,R=O._controls.getActive().image;if(!O.getData().iframe&&R&&Q&&Q==R.src){p.setTimeout(function(T){return function(){R.src=T}}(O.getData().image),1)}O.rescale(function(){e.addTimer(false,function(){e.show(O.getActiveImage());if(typeof S==="function"){S.call(O)}B.trigger("resize")},50);O.trigger(Galleria.FULLSCREEN_EXIT)});B.unbind("resize",L.scale)}};L.os.listen();var H=this._idle={timer:"idle"+O._id,trunk:[],bound:false,add:function(R,T){if(!R){return}if(!H.bound){H.addEvent()}R=h(R);var S={},Q;for(Q in T){if(T.hasOwnProperty(Q)){S[Q]=R.css(Q)}}R.data("idle",{from:S,to:T,complete:true,busy:false});H.addTimer();H.trunk.push(R)},remove:function(Q){Q=jQuery(Q);h.each(H.trunk,function(R,S){if(S&&S.length&&!S.not(Q).length){O._idle.show(Q);O._idle.trunk.splice(R,1)}});if(!H.trunk.length){H.removeEvent();e.clearTimer(H.timer)}},addEvent:function(){H.bound=true;O.$("container").bind("mousemove click",H.showAll)},removeEvent:function(){H.bound=false;O.$("container").unbind("mousemove click",H.showAll)},addTimer:function(){e.addTimer(H.timer,function(){H.hide()},O._options.idleTime)},hide:function(){if(!O._options.idleMode||O.getIndex()===false||O.getData().iframe){return}O.trigger(Galleria.IDLE_ENTER);h.each(H.trunk,function(Q,R){var S=R.data("idle");if(!S){return}R.data("idle").complete=false;e.animate(R,S.to,{duration:O._options.idleSpeed})})},showAll:function(){e.clearTimer(H.timer);h.each(H.trunk,function(Q,R){H.show(R)})},show:function(Q){var R=Q.data("idle");if(!R.busy&&!R.complete){R.busy=true;O.trigger(Galleria.IDLE_EXIT);e.clearTimer(H.timer);e.animate(Q,R.from,{duration:O._options.idleSpeed/2,complete:function(){h(this).data("idle").busy=false;h(this).data("idle").complete=true}})}H.addTimer()}};var F=this._lightbox={width:0,height:0,initialized:false,active:null,image:null,elems:{},keymap:false,init:function(){O.trigger(Galleria.LIGHTBOX_OPEN);if(F.initialized){return}F.initialized=true;var Q="overlay box content shadow title info close prevholder prev nextholder next counter image",R={},S=O._options,V="",Y="position:absolute;",U="lightbox-",T={overlay:"position:fixed;display:none;opacity:"+S.overlayOpacity+";filter:alpha(opacity="+(S.overlayOpacity*100)+");top:0;left:0;width:100%;height:100%;background:"+S.overlayBackground+";z-index:99990",box:"position:fixed;display:none;width:400px;height:400px;top:50%;left:50%;margin-top:-200px;margin-left:-200px;z-index:99991",shadow:Y+"background:#000;width:100%;height:100%;",content:Y+"background-color:#fff;top:10px;left:10px;right:10px;bottom:10px;overflow:hidden",info:Y+"bottom:10px;left:10px;right:10px;color:#444;font:11px/13px arial,sans-serif;height:13px",close:Y+"top:10px;right:10px;height:20px;width:20px;background:#fff;text-align:center;cursor:pointer;color:#444;font:16px/22px arial,sans-serif;z-index:99999",image:Y+"top:10px;left:10px;right:10px;bottom:30px;overflow:hidden;display:block;",prevholder:Y+"width:50%;top:0;bottom:40px;cursor:pointer;",nextholder:Y+"width:50%;top:0;bottom:40px;right:-1px;cursor:pointer;",prev:Y+"top:50%;margin-top:-20px;height:40px;width:30px;background:#fff;left:20px;display:none;text-align:center;color:#000;font:bold 16px/36px arial,sans-serif",next:Y+"top:50%;margin-top:-20px;height:40px;width:30px;background:#fff;right:20px;left:auto;display:none;font:bold 16px/36px arial,sans-serif;text-align:center;color:#000",title:"float:left",counter:"float:right;margin-left:8px;"},W=function(Z){return Z.hover(function(){h(this).css("color","#bbb")},function(){h(this).css("color","#444")})},X={};if(q&&q>7){T.nextholder+="background:#000;filter:alpha(opacity=0);";T.prevholder+="background:#000;filter:alpha(opacity=0);"}h.each(T,function(Z,aa){V+=".galleria-"+U+Z+"{"+aa+"}"});V+=".galleria-"+U+"box.iframe .galleria-"+U+"prevholder,.galleria-"+U+"box.iframe .galleria-"+U+"nextholder{width:100px;height:100px;top:50%;margin-top:-70px}";e.insertStyleTag(V);h.each(Q.split(" "),function(Z,aa){O.addElement("lightbox-"+aa);R[aa]=F.elems[aa]=O.get("lightbox-"+aa)});F.image=new Galleria.Picture();h.each({box:"shadow content close prevholder nextholder",info:"title counter",content:"info image",prevholder:"prev",nextholder:"next"},function(aa,ab){var Z=[];h.each(ab.split(" "),function(ac,ad){Z.push(U+ad)});X[U+aa]=Z});O.append(X);h(R.image).append(F.image.container);h(E().body).append(R.overlay,R.box);e.optimizeTouch(R.box);W(h(R.close).bind("click",F.hide).html("&#215;"));h.each(["Prev","Next"],function(ac,aa){var ab=h(R[aa.toLowerCase()]).html(/v/.test(aa)?"&#8249;&nbsp;":"&nbsp;&#8250;"),Z=h(R[aa.toLowerCase()+"holder"]);Z.bind("click",function(){F["show"+aa]()});if(q<8||Galleria.TOUCH){ab.show();return}Z.hover(function(){ab.show()},function(ad){ab.stop().fadeOut(200)})});h(R.overlay).bind("click",F.hide);if(Galleria.IPAD){O._options.lightboxTransitionSpeed=0}},rescale:function(U){var T=Math.min(B.width()-40,F.width),Q=Math.min(B.height()-60,F.height),S=Math.min(T/F.width,Q/F.height),R=Math.round(F.width*S)+40,W=Math.round(F.height*S)+60,V={width:R,height:W,"margin-top":Math.ceil(W/2)*-1,"margin-left":Math.ceil(R/2)*-1};if(U){h(F.elems.box).css(V)}else{h(F.elems.box).animate(V,{duration:O._options.lightboxTransitionSpeed,easing:O._options.easing,complete:function(){var Y=F.image,X=O._options.lightboxFadeSpeed;O.trigger({type:Galleria.LIGHTBOX_IMAGE,imageTarget:Y.image});h(Y.container).show();h(Y.image).animate({opacity:1},X);e.show(F.elems.info,X)}})}},hide:function(){F.image.image=null;B.unbind("resize",F.rescale);h(F.elems.box).hide();e.hide(F.elems.info);O.detachKeyboard();O.attachKeyboard(F.keymap);F.keymap=false;e.hide(F.elems.overlay,200,function(){h(this).hide().css("opacity",O._options.overlayOpacity);O.trigger(Galleria.LIGHTBOX_CLOSE)})},showNext:function(){F.show(O.getNext(F.active))},showPrev:function(){F.show(O.getPrev(F.active))},show:function(Q){F.active=Q=typeof Q==="number"?Q:O.getIndex()||0;if(!F.initialized){F.init()}if(!F.keymap){F.keymap=h.extend({},O._keyboard.map);O.attachKeyboard({escape:F.hide,right:F.showNext,left:F.showPrev})}B.unbind("resize",F.rescale);var U=O.getData(Q),S=O.getDataLength(),X=O.getNext(Q),T,W,R;e.hide(F.elems.info);try{for(R=O._options.preload;R>0;R--){W=new Galleria.Picture();T=O.getData(X);W.preload("big" in T?T.big:T.image);X=O.getNext(X)}}catch(V){}F.image.isIframe=!!U.iframe;h(F.elems.box).toggleClass("iframe",!!U.iframe);F.image.load(U.iframe||U.big||U.image,function(Y){F.width=Y.isIframe?h(p).width():Y.original.width;F.height=Y.isIframe?h(p).height():Y.original.height;h(Y.image).css({width:Y.isIframe?"100%":"100.1%",height:Y.isIframe?"100%":"100.1%",top:0,zIndex:99998,opacity:0,visibility:"visible"});F.elems.title.innerHTML=U.title||"";F.elems.counter.innerHTML=(Q+1)+" / "+S;B.resize(F.rescale);F.rescale()});h(F.elems.overlay).show().css("visibility","visible");h(F.elems.box).show()}};return this};Galleria.prototype={constructor:Galleria,init:function(I,H){var F=this;H=A(H);this._original={target:I,options:H,data:null};this._target=this._dom.target=I.nodeName?I:h(I).get(0);this._original.html=this._target.innerHTML;z.push(this);if(!this._target){Galleria.raise("Target not found",true);return}this._options={autoplay:false,carousel:true,carouselFollow:true,carouselSpeed:400,carouselSteps:"auto",clicknext:false,dailymotion:{foreground:"%23EEEEEE",highlight:"%235BCEC5",background:"%23222222",logo:0,hideInfos:1},dataConfig:function(J){return{}},dataSelector:"img",dataSource:this._target,debug:d,dummy:d,easing:"galleria",extend:function(J){},fullscreenCrop:d,fullscreenDoubleTap:true,fullscreenTransition:d,height:0,idleMode:true,idleTime:3000,idleSpeed:200,imageCrop:false,imageMargin:0,imagePan:false,imagePanSmoothness:12,imagePosition:"50%",imageTimeout:d,initialTransition:d,keepSource:false,layerFollow:true,lightbox:false,lightboxFadeSpeed:200,lightboxTransitionSpeed:200,linkSourceImages:true,maxScaleRatio:d,minScaleRatio:d,overlayOpacity:0.85,overlayBackground:"#0b0b0b",pauseOnInteraction:true,popupLinks:false,preload:2,queue:true,responsive:false,show:0,showInfo:true,showCounter:true,showImagenav:true,swipe:true,thumbCrop:true,thumbEventType:"click",thumbFit:true,thumbMargin:0,thumbQuality:"auto",thumbnails:true,touchTransition:d,transition:"fade",transitionInitial:d,transitionSpeed:400,trueFullscreen:true,useCanvas:false,vimeo:{title:0,byline:0,portrait:0,color:"aaaaaa"},wait:5000,width:"auto",youtube:{modestbranding:1,autohide:1,color:"white",hd:1,rel:0,showinfo:0}};this._options.initialTransition=this._options.initialTransition||this._options.transitionInitial;if(H&&H.debug===false){f=false}if(H&&typeof H.imageTimeout==="number"){b=H.imageTimeout}if(H&&typeof H.dummy==="string"){x=H.dummy}h(this._target).children().hide();if(typeof Galleria.theme==="object"){this._init()}else{g.push(this)}return this},_init:function(){var H=this,I=this._options;if(this._initialized){Galleria.raise("Init failed: Gallery instance already initialized.");return this}this._initialized=true;if(!Galleria.theme){Galleria.raise("Init failed: No theme found.",true);return this}h.extend(true,I,Galleria.theme.defaults,this._original.options,Galleria.configure.options);(function(K){if(!("getContext" in K)){K=null;return}y=y||{elem:K,context:K.getContext("2d"),cache:{},length:0}}(G.createElement("canvas")));this.bind(Galleria.DATA,function(){if(Galleria.QUIRK){Galleria.raise("Your page is in Quirks mode, Galleria may not render correctly. Please validate your HTML.")}this._original.data=this._data;this.get("total").innerHTML=this.getDataLength();var M=this.$("container");var L={width:0,height:0};var K=function(){return H.$("stage").height()};e.wait({until:function(){L=H._getWH();M.width(L.width).height(L.height);return K()&&L.width&&L.height>50},success:function(){H._width=L.width;H._height=L.height;if(Galleria.WEBKIT){p.setTimeout(function(){H._run()},1)}else{H._run()}},error:function(){if(K()){Galleria.raise("Could not extract sufficient width/height of the gallery container. Traced measures: width:"+L.width+"px, height: "+L.height+"px.",true)}else{Galleria.raise("Could not extract a stage height from the CSS. Traced height: "+K()+"px.",true)}},timeout:typeof this._options.wait=="number"?this._options.wait:false})});this.append({"info-text":["info-title","info-description"],info:["info-text"],"image-nav":["image-nav-right","image-nav-left"],stage:["images","loader","counter","image-nav"],"thumbnails-list":["thumbnails"],"thumbnails-container":["thumb-nav-left","thumbnails-list","thumb-nav-right"],container:["stage","thumbnails-container","info","tooltip"]});e.hide(this.$("counter").append(this.get("current"),G.createTextNode(" / "),this.get("total")));this.setCounter("&#8211;");e.hide(H.get("tooltip"));this.$("container").addClass(Galleria.TOUCH?"touch":"notouch");h.each(new Array(2),function(K){var L=new Galleria.Picture();h(L.container).css({position:"absolute",top:0,left:0}).prepend(H._layers[K]=h(e.create("galleria-layer")).css({position:"absolute",top:0,left:0,right:0,bottom:0,zIndex:2})[0]);H.$("images").append(L.container);H._controls[K]=L});this.$("images").css({position:"relative",top:0,left:0,width:"100%",height:"100%"});this.$("thumbnails, thumbnails-list").css({overflow:"hidden",position:"relative"});this.$("image-nav-right, image-nav-left").bind("click",function(L){if(I.clicknext){L.stopPropagation()}if(I.pauseOnInteraction){H.pause()}var K=/right/.test(this.className)?"next":"prev";H[K]()});h.each(["info","counter","image-nav"],function(K,L){if(I["show"+L.substr(0,1).toUpperCase()+L.substr(1).replace(/-/,"")]===false){e.moveOut(H.get(L.toLowerCase()))}});this.load();if(!I.keepSource&&!q){this._target.innerHTML=""}if(this.get("errors")){this.appendChild("target","errors")}this.appendChild("target","container");if(I.carousel){var J=0,F=I.show;this.bind(Galleria.THUMBNAIL,function(){this.updateCarousel();if(++J==this.getDataLength()&&typeof F=="number"&&F>0){this._carousel.follow(F)}})}if(I.responsive){B.bind("resize",function(){if(!H.isFullscreen()){H.resize()}})}if(I.swipe){(function(T){var S=[0,0],V=[0,0],M=30,L=100,R=false,N=0,P,U={start:"touchstart",move:"touchmove",stop:"touchend"},O=function(W){return W.originalEvent.touches?W.originalEvent.touches[0]:W},Q=function(W){if(W.originalEvent.touches&&W.originalEvent.touches.length>1){return}P=O(W);V=[P.pageX,P.pageY];if(!S[0]){S=V}if(Math.abs(S[0]-V[0])>10){W.preventDefault()}},K=function(W){T.unbind(U.move,Q);if((W.originalEvent.touches&&W.originalEvent.touches.length)||R){R=!R;return}if(e.timestamp()-N<1000&&Math.abs(S[0]-V[0])>M&&Math.abs(S[1]-V[1])<L){W.preventDefault();H[S[0]>V[0]?"next":"prev"]()}S=V=[0,0]};T.bind(U.start,function(W){if(W.originalEvent.touches&&W.originalEvent.touches.length>1){return}P=O(W);N=e.timestamp();S=V=[P.pageX,P.pageY];T.bind(U.move,Q).one(U.stop,K)})}(H.$("images")));if(I.fullscreenDoubleTap){this.$("stage").bind("touchstart",(function(){var O,L,Q,P,N,M,K=function(R){return R.originalEvent.touches?R.originalEvent.touches[0]:R};return function(R){M=Galleria.utils.timestamp();L=K(R).pageX;Q=K(R).pageY;if((M-O<500)&&(L-P<20)&&(Q-N<20)){H.toggleFullscreen();R.preventDefault();H.$("stage").unbind("touchend",arguments.callee);return}O=M;P=L;N=Q}}()))}}e.optimizeTouch(this.get("container"));h.each(Galleria.on.binds,function(K,L){H.bind(L.type,L.callback)});return this},_getWH:function(){var K=this.$("container"),H=this.$("target"),I=this,J={},F;h.each(["width","height"],function(M,L){if(I._options[L]&&typeof I._options[L]==="number"){J[L]=I._options[L]}else{F=[e.parseValue(K.css(L)),e.parseValue(H.css(L)),K[L](),H[L]()];if(!I["_"+L]){F.splice(F.length,e.parseValue(K.css("min-"+L)),e.parseValue(H.css("min-"+L)))}J[L]=Math.max.apply(Math,F)}});if(I._options.height&&I._options.height<2){J.height=J.width*I._options.height}return J},_createThumbnails:function(){this.get("total").innerHTML=this.getDataLength();var N,F,H,M,P,S,T=this,I=this._options,K=(function(){var U=T.$("thumbnails").find(".active");if(!U.length){return false}return U.find("img").attr("src")}()),J=typeof I.thumbnails==="string"?I.thumbnails.toLowerCase():null,O=function(U){return G.defaultView&&G.defaultView.getComputedStyle?G.defaultView.getComputedStyle(H.container,null)[U]:S.css(U)},Q=function(W,V,U){return function(){h(U).append(W);T.trigger({type:Galleria.THUMBNAIL,thumbTarget:W,index:V,galleriaData:T.getData(V)})}},R=function(V){if(I.pauseOnInteraction){T.pause()}var U=h(V.currentTarget).data("index");if(T.getIndex()!==U){T.show(U)}V.preventDefault()},L=function(U){U.scale({width:U.data.width,height:U.data.height,crop:I.thumbCrop,margin:I.thumbMargin,canvas:I.useCanvas,complete:function(X){var ab=["left","top"],W=["Width","Height"],V,Z,aa=T.getData(X.index),Y=aa.thumb.split(":");h.each(W,function(ac,ad){V=ad.toLowerCase();if((I.thumbCrop!==true||I.thumbCrop===V)&&I.thumbFit){Z={};Z[V]=X[V];h(X.container).css(Z);Z={};Z[ab[ac]]=0;h(X.image).css(Z)}X["outer"+ad]=h(X.container)["outer"+ad](true)});e.toggleQuality(X.image,I.thumbQuality===true||(I.thumbQuality==="auto"&&X.original.width<X.width*3));if(aa.iframe&&Y.length==2&&Y[0] in n){n[Y[0]].getThumb(Y[1],(function(ac){return function(ad){ac.src=ad}}(X.image)))}T.trigger({type:Galleria.THUMBNAIL,thumbTarget:X.image,index:X.data.order,galleriaData:T.getData(X.data.order)})}})};this._thumbnails=[];this.$("thumbnails").empty();for(N=0;this._data[N];N++){M=this._data[N];if(I.thumbnails===true&&(M.thumb||M.image)){H=new Galleria.Picture(N);H.index=N;F=M.thumb||M.image;this.$("thumbnails").append(H.container);S=h(H.container);H.data={width:e.parseValue(O("width")),height:e.parseValue(O("height")),order:N};if(I.thumbFit&&I.thumbCrop!==true){S.css({width:"auto",height:"auto"})}else{S.css({width:H.data.width,height:H.data.height})}P=F.split(":");if(P.length==2&&P[0] in n){H.load("data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw%3D%3D",{height:H.data.height,width:H.data.height*1.25},L)}else{H.load(F,L)}if(I.preload==="all"){H.preload(M.image)}}else{if(M.iframe||J==="empty"||J==="numbers"){H={container:e.create("galleria-image"),image:e.create("img","span"),ready:true};if(J==="numbers"){h(H.image).text(N+1)}if(M.iframe){h(H.image).addClass("iframe")}this.$("thumbnails").append(H.container);p.setTimeout((Q)(H.image,N,H.container),50+(N*20))}else{H={container:null,image:null}}}h(H.container).add(I.keepSource&&I.linkSourceImages?M.original:null).data("index",N).bind(I.thumbEventType,R);if(K===F){h(H.container).addClass("active")}this._thumbnails.push(H)}},_run:function(){var F=this;F._createThumbnails();e.wait({timeout:10000,until:function(){if(Galleria.OPERA){F.$("stage").css("display","inline-block")}F._stageWidth=F.$("stage").width();F._stageHeight=F.$("stage").height();return(F._stageWidth&&F._stageHeight>50)},success:function(){s.push(F);e.show(F.get("counter"));if(F._options.carousel){F._carousel.bindControls()}if(F._options.autoplay){F.pause();if(typeof F._options.autoplay==="number"){F._playtime=F._options.autoplay}F.trigger(Galleria.PLAY);F._playing=true}if(F._firstrun){if(typeof F._options.show==="number"){F.show(F._options.show)}return}F._firstrun=true;if(Galleria.History){Galleria.History.change(function(H){if(isNaN(H)){p.history.go(-1)}else{F.show(H,d,true)}})}F.trigger(Galleria.READY);Galleria.theme.init.call(F,F._options);h.each(Galleria.ready.callbacks,function(){this.call(F,F._options)});F._options.extend.call(F,F._options);if(/^[0-9]{1,4}$/.test(r)&&Galleria.History){F.show(r,d,true)}else{if(F._data[F._options.show]){F.show(F._options.show)}}},error:function(){Galleria.raise("Stage width or height is too small to show the gallery. Traced measures: width:"+F._stageWidth+"px, height: "+F._stageHeight+"px.",true)}})},load:function(J,F,I){var H=this;this._data=[];this._thumbnails=[];this.$("thumbnails").empty();if(typeof F==="function"){I=F;F=null}J=J||this._options.dataSource;F=F||this._options.dataSelector;I=I||this._options.dataConfig;if(/^function Object/.test(J.constructor)){J=[J]}if(J.constructor===Array){if(this.validate(J)){this._data=J;this._parseData().trigger(Galleria.DATA)}else{Galleria.raise("Load failed: JSON Array not valid.")}return this}F+=",.video,.iframe";h(J).find(F).each(function(M,O){O=h(O);var P={},N=O.parent(),L=N.attr("href"),K=N.attr("rel");if(L&&(O[0].nodeName=="IMG"||O.hasClass("video"))&&a(L)){P.video=L}else{if(L&&O.hasClass("iframe")){P.iframe=L}else{P.image=P.big=L}}if(K){P.big=K}h.each("big title description link layer".split(" "),function(Q,R){if(O.data(R)){P[R]=O.data(R)}});H._data.push(h.extend({title:O.attr("title")||"",thumb:O.attr("src"),image:O.attr("src"),big:O.attr("src"),description:O.attr("alt")||"",link:O.attr("longdesc"),original:O.get(0)},P,I(O)))});if(this.getDataLength()){this._parseData().trigger(Galleria.DATA)}else{Galleria.raise("Load failed: no data found.")}return this},_parseData:function(){var F=this,H;h.each(this._data,function(J,K){H=F._data[J];if("thumb" in K===false){H.thumb=K.image}if(!"big" in K){H.big=K.image}if("video" in K){var I=a(K.video);if(I){H.iframe=n[I.provider].embed(I.id)+(function(){if(typeof F._options[I.provider]=="object"){var M="?",L=[];h.each(F._options[I.provider],function(N,O){L.push(N+"="+O)});if(I.provider=="youtube"){L=["wmode=opaque"].concat(L)}return M+L.join("&")}return""}());delete H.video;if(!("thumb" in H)||!H.thumb){H.thumb=I.provider+":"+I.id}}}});return this},destroy:function(){this.get("target").innerHTML=this._original.html;return this},splice:function(){var F=this,H=e.array(arguments);p.setTimeout(function(){k.splice.apply(F._data,H);F._parseData()._createThumbnails()},2);return F},push:function(){var F=this,H=e.array(arguments);p.setTimeout(function(){k.push.apply(F._data,H);F._parseData()._createThumbnails()},2);return F},_getActive:function(){return this._controls.getActive()},validate:function(F){return true},bind:function(H,F){H=c(H);this.$("container").bind(H,this.proxy(F));return this},unbind:function(F){F=c(F);this.$("container").unbind(F);return this},trigger:function(F){F=typeof F==="object"?h.extend(F,{scope:this}):{type:c(F),scope:this};this.$("container").trigger(F);return this},addIdleState:function(H,F){this._idle.add.apply(this._idle,e.array(arguments));return this},removeIdleState:function(F){this._idle.remove.apply(this._idle,e.array(arguments));return this},enterIdleMode:function(){this._idle.hide();return this},exitIdleMode:function(){this._idle.showAll();return this},enterFullscreen:function(F){this._fullscreen.enter.apply(this,e.array(arguments));return this},exitFullscreen:function(F){this._fullscreen.exit.apply(this,e.array(arguments));return this},toggleFullscreen:function(F){this._fullscreen[this.isFullscreen()?"exit":"enter"].apply(this,e.array(arguments));return this},bindTooltip:function(F,H){this._tooltip.bind.apply(this._tooltip,e.array(arguments));return this},defineTooltip:function(F,H){this._tooltip.define.apply(this._tooltip,e.array(arguments));return this},refreshTooltip:function(F){this._tooltip.show.apply(this._tooltip,e.array(arguments));return this},openLightbox:function(){this._lightbox.show.apply(this._lightbox,e.array(arguments));return this},closeLightbox:function(){this._lightbox.hide.apply(this._lightbox,e.array(arguments));return this},getActiveImage:function(){return this._getActive().image||d},getActiveThumb:function(){return this._thumbnails[this._active].image||d},getMousePosition:function(F){return{x:F.pageX-this.$("container").offset().left,y:F.pageY-this.$("container").offset().top}},addPan:function(M){if(this._options.imageCrop===false){return}M=h(M||this.getActiveImage());var W=this,V=M.width()/2,S=M.height()/2,U=parseInt(M.css("left"),10),T=parseInt(M.css("top"),10),I=U||0,H=T||0,R=0,Q=0,K=false,P=e.timestamp(),F=0,J=0,O=function(Z,Y,aa){if(Z>0){J=Math.round(Math.max(Z*-1,Math.min(0,Y)));if(F!==J){F=J;if(q===8){M.parent()["scroll"+aa](J*-1)}else{var X={};X[aa.toLowerCase()]=J;M.css(X)}}}},L=function(X){if(e.timestamp()-P<50){return}K=true;V=W.getMousePosition(X).x;S=W.getMousePosition(X).y},N=function(X){if(!K){return}R=M.width()-W._stageWidth;Q=M.height()-W._stageHeight;U=V/W._stageWidth*R*-1;T=S/W._stageHeight*Q*-1;I+=(U-I)/W._options.imagePanSmoothness;H+=(T-H)/W._options.imagePanSmoothness;O(Q,H,"Top");O(R,I,"Left")};if(q===8){M.parent().scrollTop(H*-1).scrollLeft(I*-1);M.css({top:0,left:0})}this.$("stage").unbind("mousemove",L).bind("mousemove",L);e.addTimer("pan"+W._id,N,50,true);return this},proxy:function(H,F){if(typeof H!=="function"){return w}F=F||this;return function(){return H.apply(F,e.array(arguments))}},removePan:function(){this.$("stage").unbind("mousemove");e.clearTimer("pan"+this._id);return this},addElement:function(H){var F=this._dom;h.each(e.array(arguments),function(J,I){F[I]=e.create("galleria-"+I)});return this},attachKeyboard:function(F){this._keyboard.attach.apply(this._keyboard,e.array(arguments));return this},detachKeyboard:function(){this._keyboard.detach.apply(this._keyboard,e.array(arguments));return this},appendChild:function(H,F){this.$(H).append(this.get(F)||F);return this},prependChild:function(H,F){this.$(H).prepend(this.get(F)||F);return this},remove:function(F){this.$(e.array(arguments).join(",")).remove();return this},append:function(I){var H,F;for(H in I){if(I.hasOwnProperty(H)){if(I[H].constructor===Array){for(F=0;I[H][F];F++){this.appendChild(H,I[H][F])}}else{this.appendChild(H,I[H])}}}return this},_scaleImage:function(K,I){K=K||this._controls.getActive();if(!K){return}var H=this,F,J=function(L){h(L.container).children(":first").css({top:Math.max(0,e.parseValue(L.image.style.top)),left:Math.max(0,e.parseValue(L.image.style.left)),width:e.parseValue(L.image.width),height:e.parseValue(L.image.height)})};I=h.extend({width:this._stageWidth,height:this._stageHeight,crop:this._options.imageCrop,max:this._options.maxScaleRatio,min:this._options.minScaleRatio,margin:this._options.imageMargin,position:this._options.imagePosition},I);if(this._options.layerFollow&&this._options.imageCrop!==true){if(typeof I.complete=="function"){F=I.complete;I.complete=function(){F.call(K,K);J(K)}}else{I.complete=J}}else{h(K.container).children(":first").css({top:0,left:0})}K.scale(I);return this},updateCarousel:function(){this._carousel.update();return this},resize:function(K,F){if(typeof K=="function"){F=K;K=d}K=h.extend({width:0,height:0},K);var I=this,L=this.$("container"),H=this._options.responsive=="aspect"&&(!K.width||!K.height),J;h.each(K,function(M,N){if(!N){L[M]("auto");K[M]=I._getWH()[M]}});if(H){J=Math.min(K.width/this._width,K.height/this._height)}h.each(K,function(M,N){L[M](J?J*I["_"+M]:N)});return this.rescale(F)},rescale:function(J,F,H){var I=this;if(typeof J==="function"){H=J;J=d}var K=function(){I._stageWidth=J||I.$("stage").width();I._stageHeight=F||I.$("stage").height();I._scaleImage();if(I._options.carousel){I.updateCarousel()}I.trigger(Galleria.RESCALE);if(typeof H==="function"){H.call(I)}};if(Galleria.WEBKIT&&!Galleria.TOUCH&&!J&&!F){e.addTimer(false,K,10)}else{K.call(I)}return this},refreshImage:function(){this._scaleImage();if(this._options.imagePan){this.addPan()}return this},show:function(H,F,I){if(H===false||(!this._options.queue&&this._queue.stalled)){return}H=Math.max(0,Math.min(parseInt(H,10),this.getDataLength()-1));F=typeof F!=="undefined"?!!F:H<this.getIndex();I=I||false;if(!I&&Galleria.History){Galleria.History.set(H.toString());return}this._active=H;k.push.call(this._queue,{index:H,rewind:F});if(!this._queue.stalled){this._show()}return this},_show:function(){var U=this,R=this._queue[0],P=this.getData(R.index);if(!P){return}var F=P.iframe||(this.isFullscreen()&&"big" in P?P.big:P.image),N=this._controls.getActive(),Q=this._controls.getNext(),L=Q.isCached(F),H=this._thumbnails[R.index],M=function(){h(Q.image).trigger("mouseup")};var J=(function(Y,X,Z,V,W){return function(){var aa;U._queue.stalled=false;e.toggleQuality(X.image,U._options.imageQuality);U._layers[U._controls.active].innerHTML="";h(Z.container).css({zIndex:0,opacity:0}).show();if(Z.isIframe){h(Z.container).find("iframe").remove()}U.$("container").toggleClass("iframe",!!Y.iframe);h(X.container).css({zIndex:1,left:0,top:0}).show();U._controls.swap();if(U._options.imagePan){U.addPan(X.image)}if(Y.link||U._options.lightbox||U._options.clicknext){h(X.image).css({cursor:"pointer"}).bind("mouseup",function(){if(U._options.clicknext&&!Galleria.TOUCH){if(U._options.pauseOnInteraction){U.pause()}U.next();return}if(Y.link){if(U._options.popupLinks){aa=p.open(Y.link,"_blank")}else{p.location.href=Y.link}return}if(U._options.lightbox){U.openLightbox()}})}k.shift.call(U._queue);if(U._queue.length){U._show()}U._playCheck();U.trigger({type:Galleria.IMAGE,index:V.index,imageTarget:X.image,thumbTarget:W.image,galleriaData:Y})}}(P,Q,N,R,H));if(this._options.carousel&&this._options.carouselFollow){this._carousel.follow(R.index)}if(this._options.preload){var I,O,K=this.getNext(),T;try{for(O=this._options.preload;O>0;O--){I=new Galleria.Picture();T=U.getData(K);I.preload(this.isFullscreen()&&"big" in T?T.big:T.image);K=U.getNext(K)}}catch(S){}}e.show(Q.container);Q.isIframe=!!P.iframe;h(U._thumbnails[R.index].container).addClass("active").siblings(".active").removeClass("active");U.trigger({type:Galleria.LOADSTART,cached:L,index:R.index,rewind:R.rewind,imageTarget:Q.image,thumbTarget:H.image,galleriaData:P});Q.load(F,function(W){var V=h(U._layers[1-U._controls.active]).html(P.layer||"").hide();U._scaleImage(W,{complete:function(X){if("image" in N){e.toggleQuality(N.image,false)}e.toggleQuality(X.image,false);U._queue.stalled=true;U.removePan();U.setInfo(R.index);U.setCounter(R.index);if(P.layer){V.show();if(P.link||U._options.lightbox||U._options.clicknext){V.css("cursor","pointer").unbind("mouseup").mouseup(M)}}U.trigger({type:Galleria.LOADFINISH,cached:L,index:R.index,rewind:R.rewind,imageTarget:X.image,thumbTarget:U._thumbnails[R.index].image,galleriaData:U.getData(R.index)});var Z=U._options.transition;h.each({initial:N.image===null,touch:Galleria.TOUCH,fullscreen:U.isFullscreen()},function(ab,aa){if(aa&&U._options[ab+"Transition"]!==d){Z=U._options[ab+"Transition"];return false}});if(Z in l===false){J()}else{var Y={prev:N.container,next:X.container,rewind:R.rewind,speed:U._options.transitionSpeed||400};l[Z].call(U,Y,J)}}})})},getNext:function(F){F=typeof F==="number"?F:this.getIndex();return F===this.getDataLength()-1?0:F+1},getPrev:function(F){F=typeof F==="number"?F:this.getIndex();return F===0?this.getDataLength()-1:F-1},next:function(){if(this.getDataLength()>1){this.show(this.getNext(),false)}return this},prev:function(){if(this.getDataLength()>1){this.show(this.getPrev(),true)}return this},get:function(F){return F in this._dom?this._dom[F]:null},getData:function(F){return F in this._data?this._data[F]:this._data[this._active]},getDataLength:function(){return this._data.length},getIndex:function(){return typeof this._active==="number"?this._active:false},getStageHeight:function(){return this._stageHeight},getStageWidth:function(){return this._stageWidth},getOptions:function(F){return typeof F==="undefined"?this._options:this._options[F]},setOptions:function(F,H){if(typeof F==="object"){h.extend(this._options,F)}else{this._options[F]=H}return this},play:function(F){this._playing=true;this._playtime=F||this._playtime;this._playCheck();this.trigger(Galleria.PLAY);return this},pause:function(){this._playing=false;this.trigger(Galleria.PAUSE);return this},playToggle:function(F){return(this._playing)?this.pause():this.play(F)},isPlaying:function(){return this._playing},isFullscreen:function(){return this._fullscreen.active},_playCheck:function(){var H=this,K=0,F=20,I=e.timestamp(),L="play"+this._id;if(this._playing){e.clearTimer(L);var J=function(){K=e.timestamp()-I;if(K>=H._playtime&&H._playing){e.clearTimer(L);H.next();return}if(H._playing){H.trigger({type:Galleria.PROGRESS,percent:Math.ceil(K/H._playtime*100),seconds:Math.floor(K/1000),milliseconds:K});e.addTimer(L,J,F)}};e.addTimer(L,J,F)}},setPlaytime:function(F){this._playtime=F;return this},setIndex:function(F){this._active=F;return this},setCounter:function(H){if(typeof H==="number"){H++}else{if(typeof H==="undefined"){H=this.getIndex()+1}}this.get("current").innerHTML=H;if(q){var I=this.$("counter"),F=I.css("opacity");if(parseInt(F,10)===1){e.removeAlpha(I[0])}else{this.$("counter").css("opacity",F)}}return this},setInfo:function(H){var F=this,I=this.getData(H);h.each(["title","description"],function(J,K){var L=F.$("info-"+K);if(!!I[K]){L[I[K].length?"show":"hide"]().html(I[K])}else{L.empty().hide()}});return this},hasInfo:function(H){var F="title description".split(" "),I;for(I=0;F[I];I++){if(!!this.getData(H)[F[I]]){return true}}return false},jQuery:function(J){var F=this,H=[];h.each(J.split(","),function(K,L){L=h.trim(L);if(F.get(L)){H.push(L)}});var I=h(F.get(H.shift()));h.each(H,function(K,L){I=I.add(F.get(L))});return I},$:function(F){return this.jQuery.apply(this,e.array(arguments))}};h.each(v,function(F,I){var H=/_/.test(I)?I.replace(/_/g,""):I;Galleria[I.toUpperCase()]="galleria."+H});h.extend(Galleria,{IE9:q===9,IE8:q===8,IE7:q===7,IE6:q===6,IE:q,WEBKIT:/webkit/.test(u),CHROME:/chrome/.test(u),SAFARI:/safari/.test(u)&&!(/chrome/.test(u)),QUIRK:(q&&G.compatMode&&G.compatMode==="BackCompat"),MAC:/mac/.test(navigator.platform.toLowerCase()),OPERA:!!p.opera,IPHONE:/iphone/.test(u),IPAD:/ipad/.test(u),ANDROID:/android/.test(u),TOUCH:("ontouchstart" in G)});Galleria.addTheme=function(I){if(!I.name){Galleria.raise("No theme name specified")}if(typeof I.defaults!=="object"){I.defaults={}}else{I.defaults=A(I.defaults)}var F=false,H;if(typeof I.css==="string"){h("link").each(function(J,K){H=new RegExp(I.css);if(H.test(K.href)){F=true;m(I);return false}});if(!F){h("script").each(function(K,J){H=new RegExp("galleria\\."+I.name.toLowerCase()+"\\.");if(H.test(J.src)){F=J.src.replace(/[^\/]*$/,"")+I.css;e.addTimer("css",function(){e.loadCSS(F,"galleria-theme",function(){m(I)})},1)}})}if(!F){Galleria.raise("No theme CSS loaded")}}else{m(I)}return I};Galleria.loadTheme=function(K,H){var F=false,J=s.length,I=p.setTimeout(function(){Galleria.raise("Theme at "+K+" could not load, check theme path.",true)},5000);Galleria.theme=d;e.loadScript(K,function(){p.clearTimeout(I);if(J){var L=[];h.each(Galleria.get(),function(N,M){var P=h.extend(M._original.options,{data_source:M._data},H);M.$("container").remove();var O=new Galleria();O._id=M._id;O.init(M._original.target,P);L.push(O)});s=L}});return Galleria};Galleria.get=function(F){if(!!z[F]){return z[F]}else{if(typeof F!=="number"){return z}else{Galleria.raise("Gallery index "+F+" not found")}}};Galleria.configure=function(F,I){var H={};if(typeof F=="string"&&I){H[F]=I;F=H}else{h.extend(H,F)}Galleria.configure.options=H;h.each(Galleria.get(),function(K,J){J.setOptions(H)});return Galleria};Galleria.configure.options={};Galleria.on=function(F,H){if(!F){return}Galleria.on.binds.push({type:F,callback:H||w});h.each(Galleria.get(),function(J,I){I.bind(F,H)});return Galleria};Galleria.on.binds=[];Galleria.run=function(F,H){h(F||"#galleria").galleria(H);return Galleria};Galleria.addTransition=function(F,H){l[F]=H;return Galleria};Galleria.utils=e;Galleria.log=(function(){if("console" in p&&"log" in p.console){return p.console.log}else{return function(){p.alert(e.array(arguments).join(", "))}}}());Galleria.ready=function(F){h.each(s,function(I,H){F.call(H,H._options)});Galleria.ready.callbacks.push(F);return Galleria};Galleria.ready.callbacks=[];Galleria.raise=function(L,K){var J=K?"Fatal error":"Error",H=this,I={color:"#fff",position:"absolute",top:0,left:0,zIndex:100000},F=function(N){var M='<div style="padding:4px;margin:0 0 2px;background:#'+(K?"811":"222")+'";>'+(K?"<strong>"+J+": </strong>":"")+N+"</div>";h.each(z,function(){var O=this.$("errors"),P=this.$("target");if(!O.length){P.css("position","relative");O=this.addElement("errors").appendChild("target","errors").$("errors").css(I)}O.append(M)});if(!z.length){h("<div>").css(h.extend(I,{position:"fixed"})).append(M).appendTo(E().body)}};if(f){F(L);if(K){throw new Error(J+": "+L)}}else{if(K){if(t){return}t=true;K=false;F("Gallery could not load.")}}};Galleria.version=D;Galleria.requires=function(F,H){H=H||"You need to upgrade Galleria to version "+F+" to use one or more components.";if(Galleria.version<F){Galleria.raise(H,true)}return Galleria};Galleria.Picture=function(F){this.id=F||null;this.image=null;this.container=e.create("galleria-image");h(this.container).css({overflow:"hidden",position:"relative"});this.original={width:0,height:0};this.ready=false;this.isIframe=false};Galleria.Picture.prototype={cache:{},show:function(){e.show(this.image)},hide:function(){e.moveOut(this.image)},clear:function(){this.image=null},isCached:function(F){return !!this.cache[F]},preload:function(F){h(new Image()).load((function(I,H){return function(){H[I]=I}}(F,this.cache))).attr("src",F)},load:function(F,P,N){if(typeof P=="function"){N=P;P=null}if(this.isIframe){var I="if"+new Date().getTime();this.image=h("<iframe>",{src:F,frameborder:0,id:I,allowfullscreen:true,css:{visibility:"hidden"}})[0];h(this.container).find("iframe,img").remove();this.container.appendChild(this.image);h("#"+I).load((function(Q,R){return function(){p.setTimeout(function(){h(Q.image).css("visibility","visible");if(typeof R=="function"){R.call(Q,Q)}},10)}}(this,N)));return this.container}this.image=new Image();var L=0,H=false,M=false,O=h(this.container),J=h(this.image),K=(function(Q,S,R){return function(){var T=function(){h(this).unbind("load");Q.original=P||{height:this.height,width:this.width};Q.container.appendChild(this);Q.cache[R]=R;if(typeof S=="function"){p.setTimeout(function(){S.call(Q,Q)},1)}};if((!this.width||!this.height)){p.setTimeout((function(U){return function(){if(U.width&&U.height){T.call(U)}else{if(!M){h(new Image()).load(K).attr("src",U.src);M=true}else{Galleria.raise("Could not extract width/height from image: "+U.src+". Traced measures: width:"+U.width+"px, height: "+U.height+"px.")}}}}(this)),2)}else{T.call(this)}}}(this,N,F));O.find("iframe,img").remove();J.css("display","block");e.hide(this.image);h.each("minWidth minHeight maxWidth maxHeight".split(" "),function(Q,R){J.css(R,(/min/.test(R)?"0":"none"))});if(this.cache[F]){J.load(K).attr("src",F);return this.container}J.load(K).error(function(){if(!H){H=true;p.setTimeout((function(Q,R){return function(){Q.attr("src",R+"?"+e.timestamp())}}(h(this),F)),50)}else{if(x){h(this).attr("src",x)}else{Galleria.raise("Image not found: "+F)}}}).attr("src",F);return this.container},scale:function(I){var H=this;I=h.extend({width:0,height:0,min:d,max:d,margin:0,complete:w,position:"center",crop:false,canvas:false},I);if(this.isIframe){h(this.image).width(I.width).height(I.height).removeAttr("width").removeAttr("height");h(this.container).width(I.width).height(I.height);I.complete.call(H,H);try{if(this.image.contentWindow){h(this.image.contentWindow).trigger("resize")}}catch(L){}return this.container}if(!this.image){return this.container}var J,F,M=h(H.container),K;e.wait({until:function(){J=I.width||M.width()||e.parseValue(M.css("width"));F=I.height||M.height()||e.parseValue(M.css("height"));return J&&F},success:function(){var P=(J-I.margin*2)/H.original.width,N=(F-I.margin*2)/H.original.height,O=Math.min(P,N),S=Math.max(P,N),W={"true":S,width:P,height:N,"false":O,landscape:H.original.width>H.original.height?S:O,portrait:H.original.width<H.original.height?S:O},Q=W[I.crop.toString()],T="";if(I.max){Q=Math.min(I.max,Q)}if(I.min){Q=Math.max(I.min,Q)}h.each(["width","height"],function(Z,Y){h(H.image)[Y](H[Y]=H.image[Y]=Math.round(H.original[Y]*Q))});h(H.container).width(J).height(F);if(I.canvas&&y){y.elem.width=H.width;y.elem.height=H.height;T=H.image.src+":"+H.width+"x"+H.height;H.image.src=y.cache[T]||(function(Y){y.context.drawImage(H.image,0,0,H.original.width*Q,H.original.height*Q);try{K=y.elem.toDataURL();y.length+=K.length;y.cache[Y]=K;return K}catch(Z){return H.image.src}}(T))}var R={},V={},U=function(ac,aa,ab){var Z=0;if(/\%/.test(ac)){var ad=parseInt(ac,10)/100,Y=H.image[aa]||h(H.image)[aa]();Z=Math.ceil(Y*-1*ad+ab*ad)}else{Z=e.parseValue(ac)}return Z},X={top:{top:0},left:{left:0},right:{left:"100%"},bottom:{top:"100%"}};h.each(I.position.toLowerCase().split(" "),function(Y,Z){if(Z==="center"){Z="50%"}R[Y?"top":"left"]=Z});h.each(R,function(Y,Z){if(X.hasOwnProperty(Z)){h.extend(V,X[Z])}});R=R.top?h.extend(R,V):V;R=h.extend({top:"50%",left:"50%"},R);h(H.image).css({position:"absolute",top:U(R.top,"height",F),left:U(R.left,"width",J)});H.show();H.ready=true;I.complete.call(H,H)},error:function(){Galleria.raise("Could not scale image: "+H.image.src)},timeout:1000});return this}};h.extend(h.easing,{galleria:function(H,I,F,K,J){if((I/=J/2)<1){return K/2*I*I*I+F}return K/2*((I-=2)*I*I+2)+F},galleriaIn:function(H,I,F,K,J){return K*(I/=J)*I+F},galleriaOut:function(H,I,F,K,J){return -K*(I/=J)*(I-2)+F}});h.fn.galleria=function(H){var F=this.selector;if(!h(this).length){h(function(){if(h(F).length){h(F).galleria(H)}else{Galleria.utils.wait({until:function(){return h(F).length},success:function(){h(F).galleria(H)},error:function(){Galleria.raise('Init failed: Galleria could not find the element "'+F+'".')},timeout:5000})}});return this}return this.each(function(){if(!h.data(this,"galleria")){h.data(this,"galleria",new Galleria().init(this,H))}})}}(jQuery));